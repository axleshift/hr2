import{r as e}from"./react-router-dom-BnDDw25P.js";import{_ as a,j as i,F as t,a as n,b as r,c as s,p as l,m as c,A as d,g as o,x as m,v as p,l as h,k as u,w as v,y as f}from"./index-CDLNWkH1.js";import{z as b}from"./zod-B0zZW6rS.js";import{u as y}from"./react-hook-form-DGCwHb0C.js";import{s as g}from"./@hookform/resolvers/zod-B5rlnuQ9.js";import{b as C}from"./index-BVfmz2P_.js";import{C as x,a as w,b as N}from"./CModalHeader-BPWZasYS.js";import{C as S}from"./CModalTitle-CsGDx1ZU.js";import{b as j,C as E,a as F}from"./CFormLabel-CMB5m-Mb.js";import{C as k,a as A}from"./CRow-Dv7ylWmi.js";import{C as I}from"./CFormInput-Cpt_AbLV.js";import{C as M}from"./CFormSelect-Bqs3nGLi.js";import{C as T}from"./CFormTextarea-B0-u4bLx.js";import{C as z}from"./CModalFooter-BHClG5Je.js";import{C as R}from"./CContainer-C8s0HPSv.js";import{C as D,a as $}from"./CCardBody-BPxuaxuA.js";import{C as V}from"./CCardHeader-NbIzM8w_.js";import{C as _,a as O,b as P,c as L,d as q,e as H}from"./CTable-DT2N_H1o.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";import"./DefaultLayout-Bslh-jLE.js";import"./index.esm-JfIxWHlD.js";import"./index.es-DOS6LnW0.js";import"./isRTL-D5ORmfro.js";var B=e.forwardRef((function(e,l){var c=e.className,d=e.label,o=a(e,["className","label"]);return i(t,{children:[d&&n(j,{htmlFor:o.id,children:d}),n("input",{...r({type:"range",className:s("form-range",c)},o,{ref:l})})]})}));B.propTypes={className:l.string,label:l.oneOfType([l.node,l.string])},B.displayName="CFormRange";var G=e.forwardRef((function(e,t){var l,c=e.className,d=e.id,o=e.invalid,m=e.label,p=e.reverse,h=e.size,u=e.type,v=void 0===u?"checkbox":u,f=e.valid,b=a(e,["className","id","invalid","label","reverse","size","type","valid"]);return i("div",{className:s("form-check form-switch",(l={"form-check-reverse":p},l["form-switch-".concat(h)]=h,l["is-invalid"]=o,l["is-valid"]=f,l),c),children:[n("input",{...r({type:v,className:s("form-check-input",{"is-invalid":o,"is-valid":f}),id:d},b,{ref:t})}),m&&n(j,{...r({customClassName:"form-check-label"},d&&{htmlFor:d}),children:m})]})}));G.propTypes={className:l.string,id:l.string,invalid:l.bool,label:l.oneOfType([l.string,l.node]),reverse:l.bool,size:l.oneOf(["lg","xl"]),type:l.oneOf(["checkbox","radio"]),valid:l.bool},G.displayName="CFormSwitch";const U=b.object({applicant:b.string().nonempty("Applicant is required"),date:b.string().nonempty("Date is required"),type:b.enum(["Phone","Video","In-Person"]),general:b.object({communication:b.number().min(1,"Must be at least 1").max(5,"Cannot exceed 5").default(1),technical:b.number().min(1,"Must be at least 1").max(5,"Cannot exceed 5").default(1),problemSolving:b.number().min(1,"Must be at least 1").max(5,"Cannot exceed 5").default(1),culturalFit:b.number().min(1,"Must be at least 1").max(5,"Cannot exceed 5").default(1),workExperienceRelevance:b.number().min(1,"Must be at least 1").max(5,"Cannot exceed 5").default(1),leadership:b.number().min(1,"Must be at least 1").max(5,"Cannot exceed 5").default(1)}),strength:b.string().optional(),weakness:b.string().optional(),recommendation:b.enum(["yes","no","need further review"]),finalComments:b.string().optional()}),W=({isVisible:a,onClose:t,isEdit:r,eventData:s,applicantData:l})=>{const{addToast:h}=e.useContext(c),{userInformation:u}=e.useContext(d),{register:v,handleSubmit:f,reset:b,setValue:C,watch:j,formState:{errors:R}}=y({resolver:g(U)});return e.useEffect((()=>{a&&s&&setTimeout((()=>{b({date:(null==s?void 0:s.date)?s.date.split("T")[0]:"",general:{communication:1,technical:1,problemSolving:1,culturalFit:1,workExperienceRelevance:1,leadership:1}})}),100)}),[a,s,b]),i(x,{visible:a,onClose:()=>{t(),b({applicant:"",date:"",type:"Phone",general:{communication:1,technical:1,problemSolving:1,culturalFit:1,workExperienceRelevance:1,leadership:1},strength:"",weakness:"",recommendation:"yes",finalComments:""})},size:"xl",children:[n(w,{children:n(S,{children:r?"Edit Interview":"Add Interview"})}),n(N,{children:i(E,{onSubmit:f((async e=>{try{const a=r?await m(`/interviews/update/${s._id}`,e):await p("/interviews/create",e);200!==a.status&&201!==a.status||(h("Success","Interview saved successfully","success"),b(),t())}catch(a){h("Error","An error occurred","danger")}})),children:[l&&i(k,{className:"mb-3",children:[n(A,{children:n(I,{label:"Firstname",value:l.firstname,readOnly:!0})}),n(A,{children:n(I,{label:"Lastname",value:l.lastname,readOnly:!0})})]}),n(k,{className:"mb-3",children:i(A,{children:[n(I,{type:"date",label:"Date",...v("date"),invalid:!!R.date,readOnly:!0}),R.date&&n(F,{invalid:!0,children:R.date.message})]})}),n(k,{className:"mb-3",children:i(A,{children:[i(M,{label:"Type",...v("type"),invalid:!!R.type,children:[n("option",{value:"Phone",children:"Phone"}),n("option",{value:"Video",children:"Video"}),n("option",{value:"In-Person",children:"In-Person"})]}),R.type&&n(F,{invalid:!0,children:R.type.message})]})}),n("h5",{children:"General Ratings"}),["communication","technical","problemSolving","culturalFit","workExperienceRelevance","leadership"].map((e=>{var a,t;return n(k,{className:"mb-3",children:i(A,{children:[i("label",{children:[e.replace(/([A-Z])/g," $1").trim()," (",j(`general.${e}`),")"]}),n(B,{min:1,max:5,step:1,default:1,...v(`general.${e}`),invalid:!!(null==(a=R.general)?void 0:a[e])}),(null==(t=R.general)?void 0:t[e])&&n(F,{invalid:!0,children:R.general[e].message})]})},e)})),n(k,{className:"mb-3",children:i(A,{children:[i(M,{label:"Recommendation",...v("recommendation"),invalid:!!R.recommendation,children:[n("option",{value:"yes",children:"Yes"}),n("option",{value:"no",children:"No"}),n("option",{value:"need further review",children:"Need Further Review"})]}),R.recommendation&&n(F,{invalid:!0,children:R.recommendation.message})]})}),n(k,{className:"mb-3",children:n(A,{children:n(T,{label:"Strength",...v("strength")})})}),n(k,{className:"mb-3",children:n(A,{children:n(T,{label:"Weakness",...v("weakness")})})}),n(k,{className:"mb-3",children:n(A,{children:n(T,{label:"Final Comments",...v("finalComments")})})}),n(z,{children:["admin","interviewer","manager"].includes(u.role)?n(o,{type:"submit",color:"primary",size:"sm",children:r?"Update":"Create"}):n(o,{color:"danger",size:"sm",disabled:!0,children:"No Permission"})})]})})]})};W.propTypes={isVisible:l.bool.isRequired,onClose:l.func.isRequired,isEdit:l.bool.isRequired,eventData:l.object,applicantData:l.object};const J=({isVisible:a,onClose:r,slot:s,state:l})=>{var z,B;const{addToast:U}=e.useContext(c),{userInformation:J}=e.useContext(d),[X,Y]=e.useState({}),[Z,K]=e.useState(!1),[Q,ee]=e.useState(!1),[ae,ie]=e.useState("view"),[te,ne]=e.useState(!0),[re,se]=e.useState(["Initial Interview","Final Interview","Other"]),[le,ce]=e.useState(!1),[de,oe]=e.useState(!1),[me,pe]=e.useState(!1),[he,ue]=e.useState([]),[ve,fe]=e.useState(!1),[be,ye]=e.useState(!1),[ge,Ce]=e.useState({}),[xe,we]=e.useState({}),Ne=async()=>{try{ee(!0);const e=await v(`/facilities/event/${s.event}`);if(200===e.status)return Y(e.data.data),ke(e.data.data),ee(!1),U("Success","Event Fetched","success")}catch(e){U("error","failed to load event data","danger")}},Se=b.object({name:b.string().min(3).max(50),description:b.string().optional(),capacity:b.number().int().positive(),type:b.enum(re,{errorMap:()=>({message:"Invalid Event Type"})}),isApproved:b.union([b.boolean(),b.object({status:b.boolean()})]).transform((e=>"boolean"==typeof e?e:e.status)).default(!1)}),{register:je,watch:Ee,handleSubmit:Fe,reset:ke,formState:{errors:Ae},setValue:Ie}=y({resolver:async(e,a,i)=>await g(Se)(e,a,i),defaultValues:(null==(z=X.isApproved)?void 0:z.status)??!1}),Me=Ee("isApproved",null==(B=X.isApproved)?void 0:B.status),Te=()=>{ke({name:"",description:"",capacity:1,type:"",isApproved:!1})};return e.useEffect((()=>{a&&K(a)}),[a]),e.useEffect((()=>{Z&&(ie(l),"view"!==l&&"edit"!==l||Ne())}),[Z,l]),e.useEffect((()=>{switch(ae){case"edit":case"create":ne(!1);break;default:ne(!0)}}),[ae]),i(R,{children:[n(k,{children:n(A,{children:i(x,{visible:Z,onClose:()=>{Te(),r(),Y({}),ie("view"),ne(!1),K(!1)},size:"xl",children:[n(w,{children:n(S,{children:"edit"===ae||"create"===ae?"Manage Event":"View Event"})}),n(N,{children:i(R,{children:[n(k,{className:"mb-3",children:i(A,{className:"d-flex flex-column",children:[i("strong",{children:[C(s.start)," - ",C(s.end)]}),i("small",{className:"text-muted",children:[" Timeslot ID: ",s._id]}),X&&i("small",{className:"text-muted",children:[" Event ID: ",X._id]}),"development"===h.env]})}),Q?n(k,{children:n(A,{children:n(u,{size:"sm"})})}):i(t,{children:[n(k,{children:n(A,{children:i(E,{onSubmit:Fe((async e=>{try{ce(!0);const a=new FormData;let i;if(a.append("name",e.name),a.append("description",e.description),a.append("capacity",e.capacity),a.append("type",e.type),a.append("isApproved",e.isApproved),"edit"===ae)i=await m(`/facilities/event/${s._id}`,e);else i=await p(`/facilities/event/${s._id}`,e);return 201===i.status?(ce(!1),r(),U("success","Event created!","success")):200===i.status?(ce(!1),r(),U("success","Event updated!","success")):(ce(!1),r(),U("Error","Failed to create event","error"))}catch(a){}})),children:[n(k,{className:"mb-3",children:i(A,{children:[n(I,{type:"text",label:"Name",placeholder:"Applicant Interview",...je("name"),readOnly:te,invalid:Ae.name}),Ae.name&&n(F,{invalid:!0,className:"text-danger",children:Ae.name.message})]})}),n(k,{className:"mb-3",children:i(A,{children:[n(T,{type:"text",label:"Description",placeholder:"Lorem ipsum...",rows:6,...je("description"),invalid:Ae.description,readOnly:te}),Ae.description&&n(F,{invalid:!0,className:"text-danger",children:Ae.description.message})]})}),n(k,{className:"mb-3",children:i(A,{children:[n(I,{type:"number",label:"Capacity",placeholder:"1",defaultValue:1,...je("capacity",{valueAsNumber:!0}),readOnly:te,invalid:Ae.capacity}),Ae.capacity&&n(F,{invalid:!0,className:"text-danger",children:Ae.capacity.message})]})}),n(k,{className:"mb-3",children:i(A,{children:[n(j,{htmlFor:"type",children:"Event Type"}),i(M,{id:"type",...je("type"),invalid:!!Ae.type,disabled:te,children:[n("option",{value:"",children:"Select an event type"}),re.map((e=>n("option",{value:e,children:e},e)))]}),Ae.type&&n(F,{invalid:!0,className:"text-danger",children:Ae.type.message})]})}),n(k,{className:"mb-3",children:i(A,{children:[i(j,{htmlFor:"isApproved",children:["Current approval status:"," ",X.isApproved?n("span",{className:"text-success",children:"Approved"}):n("span",{className:"text-danger",children:"Not approved"})]}),n(G,{id:"isApproved",label:""+(Me?"Approved":"Not Approved"),...je("isApproved",{valueAsBoolean:!0}),disabled:("admin"===J.role||"manager"===J.role)&&te})]})}),n(k,{className:"mb-3",children:n(A,{children:("edit"===ae||"create"===ae)&&i("div",{className:"d-flex justify-content-end gap-2",children:[n(o,{type:"button",color:"warning",size:"sm",onClick:()=>{const e=Math.floor(100*Math.random()),a={name:`Event ${e}`,description:`This is a mock description for event #${e}`,capacity:Math.floor(100*Math.random())+1};ke(a)},children:"Fill Mock Data"}),n(o,{color:"danger",size:"sm",onClick:()=>(async()=>{try{if(200===(await f(`/facilities/event/${s._id}`)).status)return Te(),r(),U("Success","Event deleted!","success")}catch(e){}})(),children:"Delete"}),n(o,{type:"submit",color:"primary",size:"sm",children:le?n(u,{}):"Submit"})]})})})]})})}),X.participants&&n(t,{children:n(k,{children:n(A,{children:i(D,{children:[n(V,{children:i("div",{className:"d-flex justify-content-between",children:[n("div",{children:"Participants"}),("admin"===J.role||"recruiter"===J.role)&&"edit"===ae&&X.participants.length>0&&n("div",{children:n(o,{size:"sm",color:"info",disabled:me,onClick:()=>(async()=>{try{pe(!0);const e=await p(`/facilities/events/${X._id}/send-email`);return 200===e.status?(pe(!1),ue(e.data.failedMails),U("Success",`Email sent for participant for event ${X.name}`,"success")):(pe(!1),U("Info",e.message.message,"info"))}catch(e){U("Error","An error occured","danger")}})(),children:me?i("span",{children:[n(u,{size:"sm"})," sending..."]}):X.emailSent.status?"Resend Mail to Participants":"Send Mail to Participants"})})]})}),n($,{children:i(_,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[n(O,{children:i(P,{children:[n(L,{children:"Name"}),n(L,{children:"Email"}),n(L,{children:"Phone"}),n(L,{children:"Email Sent"}),n(L,{children:"Action"})]})}),n(q,{children:X.participants.map((e=>i(P,{children:[i(H,{children:[e.applicant.lastname,", ",e.applicant.firstname]}),n(H,{children:e.applicant.email}),n(H,{children:e.applicant.phone}),n(H,{children:e.mail.sent?n("span",{className:"text-success",children:"Sent"}):n("span",{className:"text-danger",children:"Failed"})}),n(H,{children:i("div",{className:"d-flex flex-row gap-2",children:[("edit"===ae||"create"===ae)&&n(o,{size:"sm",color:"danger",onClick:()=>(async e=>{try{oe(!0),(new FormData).append("applicantId",e._id);const a=await f(`/facilities/events/${X._id}/unbook?applicantId=${e._id}`);return 200===a.status?(Ne(),oe(!1),U("Success","Applicant removed from the event","success")):(oe(!1),U("Info",a.message.message,"info"))}catch(a){U("Error","An error occured","danger")}})(e.applicant),disabled:de,children:de?n(u,{size:"sm"}):"Remove"}),("admin"===J.role||"interviewer"===J.role||"manager"===J.role)&&"view"===ae&&n(o,{size:"sm",color:"info",onClick:()=>{fe(!0),ye(!1),K(!1),we(e.applicant),Ce({_id:X._id,name:X.name,date:X.date})},children:"Interview"})]})})]},e.applicant._id)))})]})})]})})})})]})]})})]})})}),n(k,{children:n(A,{children:n(W,{isVisible:ve,onClose:()=>{ye(!1),fe(!1),K(!0)},isEdit:be,eventData:ge,applicantData:xe})})})]})};J.propTypes={isVisible:l.bool,onClose:l.func,state:l.string,slot:l.object};export{J as default};
