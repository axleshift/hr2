import{r as e}from"./react-router-dom-BnDDw25P.js";import{_ as a,j as i,a as n,c as t,b as r,p as s,m as l,A as c,l as o,g as d,k as m,w as p,x as h,v as u,F as v,y as f}from"./index-D3tAU7AY.js";import{z as y}from"./zod-B0zZW6rS.js";import{u as b,b as g}from"./react-hook-form-DB8hWBdy.js";import{s as w}from"./@hookform/resolvers/zod-1wp20Skh.js";import{f as C,b as N}from"./index-DCO1bnrX.js";import{A as x}from"./AppPagination-DqYd43Cv.js";import{C as S,a as j,b as k}from"./CModalHeader-B7MHNovK.js";import{C as E}from"./CModalTitle-hcPyglLB.js";import{C as A,a as F,b as I,c as q}from"./CTabList-hCOZ6P49.js";import{a as T}from"./DefaultLayout-I7g3Xi84.js";import{b as $,C as z,a as R}from"./CFormLabel-Dokt-hw2.js";import{C as P,a as D}from"./CRow-BNYOpc2u.js";import{C as _}from"./CFormInput-8wEkUehS.js";import{C as M}from"./CFormSelect-DnZCZSEx.js";import{C as V}from"./CFormRange-CPhK_iVa.js";import{C as O}from"./CFormTextarea-CSUq8iIt.js";import{C as K}from"./CContainer-BR4ie7fq.js";import{C as L,a as Y}from"./CCardBody-DiGo_jhZ.js";import{C as H,a as Q,c as U,d as B,b as G,e as W}from"./CTable-BVtvZRLu.js";import"./ConfirmationDialog-CxLJJG5E.js";import{C as J}from"./CCardHeader-BImc97nz.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";import"./index.es-C3trJVa-.js";import"./CTooltip-DWX4KEIk.js";import"./isRTL-D5ORmfro.js";import"./index.esm-D05r2ZOM.js";var X=e.forwardRef((function(e,s){var l,c=e.className,o=e.id,d=e.invalid,m=e.label,p=e.reverse,h=e.size,u=e.type,v=void 0===u?"checkbox":u,f=e.valid,y=a(e,["className","id","invalid","label","reverse","size","type","valid"]);return i("div",{className:t("form-check form-switch",(l={"form-check-reverse":p},l["form-switch-".concat(h)]=h,l["is-invalid"]=d,l["is-valid"]=f,l),c),children:[n("input",{...r({type:v,className:t("form-check-input",{"is-invalid":d,"is-valid":f}),id:o},y,{ref:s})}),m&&n($,{...r({customClassName:"form-check-label"},o&&{htmlFor:o}),children:m})]})}));X.propTypes={className:s.string,id:s.string,invalid:s.bool,label:s.oneOfType([s.string,s.node]),reverse:s.bool,size:s.oneOf(["lg","xl"]),type:s.oneOf(["checkbox","radio"]),valid:s.bool},X.displayName="CFormSwitch";const Z=y.object({date:y.string().nonempty("Date is required"),type:y.enum(["Phone","Video","In-Person"]),general:y.object({communication:y.number().min(1).max(5).default(1),technical:y.number().min(1).max(5).default(1),problemSolving:y.number().min(1).max(5).default(1),culturalFit:y.number().min(1).max(5).default(1),workExperienceRelevance:y.number().min(1).max(5).default(1),leadership:y.number().min(1).max(5).default(1)}),questions:y.array(y.object({question:y.string().min(1,{message:"A question is required."}),remark:y.string().optional()})).optional(),strength:y.string().optional(),weakness:y.string().optional(),recommendation:y.enum(["yes","no","need further review"]),finalComments:y.string().optional()}),ee=({isVisible:a,onClose:t,isEdit:r,eventData:s,applicantData:v})=>{const{addToast:f}=e.useContext(l),{userInformation:y}=e.useContext(c),[N,$]=e.useState([]),[J,X]=e.useState(!1),[ee,ae]=e.useState(""),[ie,ne]=e.useState(1),[te,re]=e.useState(9),[se,le]=e.useState(0),[ce,oe]=e.useState(0),{control:de,register:me,handleSubmit:pe,reset:he,setValue:ue,watch:ve,formState:{errors:fe}}=b({resolver:w(Z)}),{fields:ye,append:be,remove:ge}=g({control:de,name:"questions"});return e.useEffect((()=>{a&&s&&setTimeout((()=>{he({date:(null==s?void 0:s.date)?s.date.split("T")[0]:"",general:{communication:1,technical:1,problemSolving:1,culturalFit:1,workExperienceRelevance:1,leadership:1}})}),100)}),[a,s,he]),e.useEffect((()=>{a&&(async()=>{try{X(!0);const e=ee?await p(`/applicant/interview/all/${v._id}?query=${ee}&page=${ie}&limit=${te}&sort=desc`):await p(`/applicant/interview/all/${v._id}?page=${ie}&limit=${te}&sort=desc`);200===e.status?($(e.data.data),oe(e.data.totalItems),le(e.data.totalPages),ne(e.data.currentPage)):($([]),oe(0),le(0),ne(1)),X(!1)}catch(e){X(!1)}})()}),[a]),i(S,{visible:a,onClose:()=>{t(),he({applicant:"",date:"",type:"Phone",general:{communication:1,technical:1,problemSolving:1,culturalFit:1,workExperienceRelevance:1,leadership:1},strength:"",weakness:"",recommendation:"yes",finalComments:""})},size:"xl",children:[n(j,{children:n(E,{children:r?"Edit Interview":"Interview Form"})}),n(k,{children:i(A,{activeItemKey:"form",children:[i(F,{variant:"tabs",children:[n(I,{itemKey:"form",children:"Form"}),n(I,{itemKey:"history",children:"History"})]}),i(T,{children:[n(q,{itemKey:"form",children:i(z,{onSubmit:pe((async e=>{try{const a=r?await h(`/interviews/update/${s._id}`,e):await u("/interviews/create",e);200!==a.status&&201!==a.status||(f("Success","Interview saved successfully","success"),he(),t())}catch(a){f("Error","An error occurred","danger")}})),className:"mt-3",children:["development"===o.env,v&&i(P,{className:"mb-3",children:[n(D,{children:n(_,{label:"Firstname",value:v.firstname,readOnly:!0})}),n(D,{children:n(_,{label:"Lastname",value:v.lastname,readOnly:!0})})]}),n(P,{className:"mb-3",children:i(D,{children:[n(_,{type:"date",label:"Date",...me("date"),invalid:!!fe.date,readOnly:!0}),fe.date&&n(R,{invalid:!0,children:fe.date.message})]})}),i(P,{className:"mb-3",children:[i(D,{children:[i(M,{label:"Interview Type",...me("type"),invalid:!!fe.type,children:[n("option",{value:"Phone",children:"Phone"}),n("option",{value:"Video",children:"Video"}),n("option",{value:"In-Person",children:"In-Person"})]}),fe.type&&n(R,{invalid:!0,children:fe.type.message})]}),n(D,{children:n(_,{label:"Event Type",value:s.type,readOnly:!0})})]}),n("h5",{children:"General Ratings"}),["communication","technical","problemSolving","culturalFit","workExperienceRelevance","leadership"].map((e=>{var a,t;return n(P,{className:"mb-3",children:i(D,{children:[i("label",{children:[e.replace(/([A-Z])/g," $1").trim()," (",ve(`general.${e}`),")"]}),n(V,{min:1,max:5,step:1,default:1,...me(`general.${e}`),invalid:!!(null==(a=fe.general)?void 0:a[e])}),(null==(t=fe.general)?void 0:t[e])&&n(R,{invalid:!0,children:fe.general[e].message})]})},e)})),n(P,{children:n(D,{className:"d-flex justify-content-end",children:n(d,{type:"button",color:"info",size:"sm",onClick:()=>be({question:"",remark:""}),children:"Add Question"})})}),n(P,{children:n(D,{children:ye.map(((e,a)=>{var t,r,s,l;return n(P,{className:"mb-3",children:i(D,{children:[n(P,{className:"mb-3",children:i(D,{children:[n(_,{label:`Question ${a+1}`,autoComplete:"question",...me(`questions.${a}.question`),invalid:!!(null==(r=null==(t=fe.questions)?void 0:t[a])?void 0:r.question)}),(null==(l=null==(s=fe.questions)?void 0:s[a])?void 0:l.question)&&n(R,{invalid:!0,children:fe.questions[a].question.message})]})}),n(P,{className:"mb-2",children:n(D,{children:n(O,{label:"Remarks",autoComplete:"remark",...me(`questions.${a}.remark`)})})}),n(P,{className:"mb-2",children:n(D,{children:n(D,{children:n("div",{className:"d-flex justify-content-end",children:n(d,{type:"button",color:"danger",size:"sm",onClick:()=>ge(a),children:"Remove"})})})})})]})},e.id)}))})}),n(P,{className:"mb-3",children:i(D,{children:[i(M,{label:"Recommendation",...me("recommendation"),invalid:!!fe.recommendation,children:[n("option",{value:"yes",children:"Yes"}),n("option",{value:"no",children:"No"}),n("option",{value:"need further review",children:"Need Further Review"})]}),fe.recommendation&&n(R,{invalid:!0,children:fe.recommendation.message})]})}),n(P,{className:"mb-3",children:n(D,{children:n(O,{label:"Strength",...me("strength")})})}),n(P,{className:"mb-3",children:n(D,{children:n(O,{label:"Weakness",...me("weakness")})})}),n(P,{className:"mb-3",children:n(D,{children:n(O,{label:"Final Comments",...me("finalComments")})})}),n(P,{children:n(D,{className:"d-flex justify-content-end",children:["admin","interviewer","manager"].includes(y.role)?n(d,{type:"submit",color:"primary",size:"sm",children:r?"Update":"Create"}):n(d,{color:"danger",size:"sm",disabled:!0,children:"No Permission"})})})]})}),n(q,{itemKey:"history",children:i(K,{className:"mt-3",children:[n(P,{className:"mb-3",children:n(D,{children:n(L,{children:n(Y,{children:i(H,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[i(Q,{children:[n(U,{children:"Interviewer"}),n(U,{children:"Type"}),n(U,{children:"Event Type"}),n(U,{children:"Recommendation"}),n(U,{children:"Created"}),n(U,{children:"Actions"})]}),n(B,{children:J?n(G,{children:n(W,{colSpan:"12",children:n("div",{className:"pt-3 text-center",children:n(m,{color:"primary",variant:"grow"})})})}):0===N.length?n(G,{children:n(W,{colSpan:"12",children:n("div",{className:"text-center",children:"No Interviews History Found"})})}):N.map((e=>{var a;return i(G,{children:[n(W,{children:i("div",{children:[e.interviewer.lastname,", ",e.interviewer.firstname]})}),n(W,{children:e.type}),n(W,{children:null==(a=null==e?void 0:e.event)?void 0:a.type}),n(W,{className:"text-capitalize",children:e.recommendation}),n(W,{children:C(e.date,"MMM DD YYYY h:mm A")}),n(W,{children:n(d,{color:"primary",size:"sm",onClick:()=>(e=>{var a,i,n,t,r,s,l;he({date:e.date?e.date.split("T")[0]:"",type:e.type||"Phone",general:{communication:(null==(a=e.general)?void 0:a.communication)||1,technical:(null==(i=e.general)?void 0:i.technical)||1,problemSolving:(null==(n=e.general)?void 0:n.problemSolving)||1,culturalFit:(null==(t=e.general)?void 0:t.culturalFit)||1,workExperienceRelevance:(null==(r=e.general)?void 0:r.workExperienceRelevance)||1,leadership:(null==(s=e.general)?void 0:s.leadership)||1},questions:(null==(l=e.questions)?void 0:l.length)?e.questions:[{question:"",remark:""}],strength:e.strength||"",weakness:e.weakness||"",recommendation:e.recommendation||"yes",finalComments:e.finalComments||""})})(e),children:"View"})})]},e._id)}))})]})})})})}),n(P,{children:n(D,{children:n("div",{className:"d-flex flex-row gap-2 justify-content-center align-items-center",children:n(x,{currentPage:ie,totalPages:se,onPageChange:ne})})})})]})})]})]})})]})};ee.propTypes={isVisible:s.bool.isRequired,onClose:s.func.isRequired,isEdit:s.bool.isRequired,eventData:s.object,applicantData:s.object};const ae=({isVisible:a,onClose:t,slot:r,state:s})=>{var g,C;const{addToast:x}=e.useContext(l),{userInformation:A}=e.useContext(c),[F,I]=e.useState({}),[q,T]=e.useState(!1),[V,Z]=e.useState(!1),[ae,ie]=e.useState("view"),[ne,te]=e.useState(!0),[re,se]=e.useState(["Initial Interview","Final Interview","Other"]),[le,ce]=e.useState(!1),[oe,de]=e.useState(!1),[me,pe]=e.useState(!1),[he,ue]=e.useState([]),[ve,fe]=e.useState(!1),[ye,be]=e.useState(!1),[ge,we]=e.useState({}),[Ce,Ne]=e.useState({}),[xe,Se]=e.useState([]),[je,ke]=e.useState(!1),[Ee,Ae]=e.useState(""),[Fe,Ie]=e.useState(1),[qe,Te]=e.useState(9),[$e,ze]=e.useState(0),[Re,Pe]=e.useState(0),De=async()=>{try{Z(!0);const e=await p(`/facilities/event/${r.event}`);if(200===e.status)return I(e.data.data),Ke(e.data.data),Z(!1),x("Success","Event Fetched","success")}catch(e){x("error","failed to load event data","danger")}},_e=y.object({name:y.string().min(3).max(50),description:y.string().optional(),capacity:y.number().int().positive(),type:y.enum(re,{errorMap:()=>({message:"Invalid Event Type"})}),isApproved:y.union([y.boolean(),y.object({status:y.boolean()})]).transform((e=>"boolean"==typeof e?e:e.status)).default(!1)}),{register:Me,watch:Ve,handleSubmit:Oe,reset:Ke,formState:{errors:Le},setValue:Ye}=b({resolver:async(e,a,i)=>await w(_e)(e,a,i),defaultValues:(null==(g=F.isApproved)?void 0:g.status)??!1}),He=Ve("isApproved",null==(C=F.isApproved)?void 0:C.status),Qe=()=>{Ke({name:"",description:"",capacity:1,type:"",isApproved:!1})};return e.useEffect((()=>{a&&T(a)}),[a]),e.useEffect((()=>{q&&(ie(s),"view"!==s&&"edit"!==s||De())}),[q,s]),e.useEffect((()=>{switch(ae){case"edit":case"create":te(!1);break;default:te(!0)}}),[ae]),i(K,{children:[n(P,{children:n(D,{children:i(S,{visible:q,onClose:()=>{Qe(),t(),I({}),ie("view"),te(!1),T(!1)},size:"xl",children:[n(j,{children:n(E,{children:"edit"===ae||"create"===ae?"Manage Event":"View Event"})}),n(k,{children:i(K,{children:[n(P,{className:"mb-3",children:i(D,{className:"d-flex flex-column",children:[i("strong",{children:[N(r.start)," - ",N(r.end)]}),i("small",{className:"text-muted",children:[" Timeslot ID: ",r._id]}),F&&i("small",{className:"text-muted",children:[" Event ID: ",F._id]}),"development"===o.env]})}),V?n(P,{children:n(D,{children:n(m,{size:"sm"})})}):i(v,{children:[n(P,{children:n(D,{children:i(z,{onSubmit:Oe((async e=>{try{ce(!0);const a=new FormData;let i;if(a.append("name",e.name),a.append("description",e.description),a.append("capacity",e.capacity),a.append("type",e.type),a.append("isApproved",e.isApproved),"edit"===ae)i=await h(`/facilities/event/${r._id}`,e);else i=await u(`/facilities/event/${r._id}`,e);const n=i.data.data;switch(i.status){case 201:x("success","Event created!","success"),I(n),ie("edit");break;case 200:x("success","Event updated!","success"),I(n);break;default:x("Error","Failed to create event","danger")}ce(!1)}catch(a){ce(!1),x("Error","An unexpected error occurred","danger")}})),children:[n(P,{className:"mb-3",children:i(D,{children:[n(_,{type:"text",label:"Name",placeholder:"Applicant Interview",...Me("name"),readOnly:ne,invalid:Le.name}),Le.name&&n(R,{invalid:!0,className:"text-danger",children:Le.name.message})]})}),n(P,{className:"mb-3",children:i(D,{children:[n(O,{type:"text",label:"Description",placeholder:"Lorem ipsum...",rows:6,...Me("description"),invalid:Le.description,readOnly:ne}),Le.description&&n(R,{invalid:!0,className:"text-danger",children:Le.description.message})]})}),n(P,{className:"mb-3",children:i(D,{children:[n(_,{type:"number",label:"Capacity",placeholder:"1",defaultValue:1,...Me("capacity",{valueAsNumber:!0}),readOnly:ne,invalid:Le.capacity}),Le.capacity&&n(R,{invalid:!0,className:"text-danger",children:Le.capacity.message})]})}),n(P,{className:"mb-3",children:i(D,{children:[n($,{htmlFor:"type",children:"Event Type"}),i(M,{id:"type",...Me("type"),invalid:!!Le.type,disabled:ne,children:[n("option",{value:"",children:"Select an event type"}),re.map((e=>n("option",{value:e,children:e},e)))]}),Le.type&&n(R,{invalid:!0,className:"text-danger",children:Le.type.message})]})}),n(P,{className:"mb-3",children:i(D,{children:[i($,{htmlFor:"isApproved",children:["Current approval status:"," ",F.isApproved?n("span",{className:"text-success",children:"Approved"}):n("span",{className:"text-danger",children:"Not approved"})]}),n(X,{id:"isApproved",label:""+(He?"Approved":"Not Approved"),...Me("isApproved",{valueAsBoolean:!0}),disabled:("admin"===A.role||"manager"===A.role)&&ne})]})}),n(P,{className:"mb-3",children:n(D,{children:("edit"===ae||"create"===ae)&&i("div",{className:"d-flex justify-content-end gap-2",children:[n(d,{type:"button",color:"warning",size:"sm",onClick:()=>{const e=Math.floor(100*Math.random()),a={name:`Event ${e}`,description:`This is a mock description for event #${e}`,capacity:Math.floor(100*Math.random())+1};Ke(a)},children:"Fill Mock Data"}),"edit"===ae&&n(d,{color:"danger",size:"sm",onClick:()=>(async()=>{try{if(!confirm("Are you sure you want to delete this event?"))return;if(200===(await f(`/facilities/event/${r._id}`)).status)return Qe(),t(),T(!1),x("Success","Event deleted!","success")}catch(e){x("Error",e,"danger")}})(),children:"Delete"}),n(d,{type:"submit",color:"primary",size:"sm",children:le?n(m,{size:"sm"}):"edit"===ae?"Update":"Create"})]})})})]})})}),F.participants&&n(v,{children:n(P,{children:n(D,{children:i(L,{children:[n(J,{children:i("div",{className:"d-flex justify-content-between",children:[n("div",{children:"Participants"}),("admin"===A.role||"recruiter"===A.role)&&"edit"===ae&&F.participants.length>0&&n("div",{children:n(d,{size:"sm",color:"info",disabled:me,onClick:()=>(async()=>{try{if(!confirm("Are you sure you want to send email?"))return;pe(!0);const e=await u(`/facilities/events/${F._id}/send-email`);return 200===e.status?(pe(!1),ue(e.data.failedMails),x("Success",`Email sent for participant for event ${F.name}`,"success")):(pe(!1),x("Info",e.message.message,"info"))}catch(e){x("Error","An error occured","danger")}})(),children:me?i("span",{children:[n(m,{size:"sm"})," sending..."]}):F.emailSent.status?"Resend Mail to Participants":"Send Mail to Participants"})})]})}),n(Y,{children:i(H,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[n(Q,{children:i(G,{children:[n(U,{children:"Name"}),n(U,{children:"Email"}),n(U,{children:"Phone"}),n(U,{children:"Email Sent"}),n(U,{children:"Action"})]})}),n(B,{children:F.participants.map((e=>i(G,{children:[i(W,{children:[e.applicant.lastname,", ",e.applicant.firstname]}),n(W,{children:e.applicant.email}),n(W,{children:e.applicant.phone}),n(W,{children:e.mail.sent?n("span",{className:"text-success",children:"Sent"}):n("span",{className:"text-danger",children:"Failed"})}),n(W,{children:i("div",{className:"d-flex flex-row gap-2",children:[("edit"===ae||"create"===ae)&&n(d,{size:"sm",color:"danger",onClick:()=>(async e=>{try{if(!confirm("Are you sure you want to delete this applicant?"))return;de(!0),(new FormData).append("applicantId",e._id);const a=await f(`/facilities/events/${F._id}/unbook?applicantId=${e._id}`);return 200===a.status?(De(),de(!1),x("Success","Applicant removed from the event","success")):(de(!1),x("Info",a.message.message,"info"))}catch(a){x("Error","An error occured","danger")}})(e.applicant),disabled:oe,children:oe?n(m,{size:"sm"}):"Remove"}),("admin"===A.role||"interviewer"===A.role||"manager"===A.role)&&"view"===ae&&n(d,{size:"sm",color:"info",onClick:()=>{fe(!0),be(!1),T(!1),Ne(e.applicant),we({_id:F._id,name:F.name,date:F.date,type:F.type})},children:"Interview"})]})})]},e.applicant._id)))})]})})]})})})})]})]})})]})})}),n(P,{children:n(D,{children:n(ee,{isVisible:ve,onClose:()=>{be(!1),fe(!1),T(!0)},isEdit:ye,eventData:ge,applicantData:Ce})})})]})};ae.propTypes={isVisible:s.bool,onClose:s.func,state:s.string,slot:s.object};export{ae as default};
