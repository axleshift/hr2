import{A as e}from"./AppPagination-CSyCrsOS.js";import{F as t,f as a,W as i,V as s,M as n,Q as r,X as l,Y as c,A as d,Z as o,H as m,_ as h}from"./index.es-C9xc5k3x.js";import{C as u}from"./Calendar-tq1_XGhn.js";import{R as p,r as f}from"./react-router-dom-BnDDw25P.js";import{j as g,a as b,g as v,k as y,p as C,m as S,F as w,w as N,y as x,v as D,x as j}from"./index-C7WNuMe9.js";import{u as T}from"./react-hook-form-DB8hWBdy.js";import{s as I}from"./@hookform/resolvers/zod-1wp20Skh.js";import{z as k}from"./zod-B0zZW6rS.js";import{C as E,a as A,b as q}from"./CModalHeader-X8QRMJLj.js";import{C as F}from"./CModalTitle-CMgZ0nio.js";import{C as R,a as V,b as L}from"./CFormLabel-6blIxd0G.js";import{C as M,a as $}from"./CRow-DxwjKGiI.js";import{C as _}from"./CInputGroup-Q0F8Lruh.js";import{C as Y}from"./CInputGroupText-D9NdCwyD.js";import{C as O}from"./CFormInput-CbIypAAs.js";import{C as P}from"./CModalFooter-DIrQKmul.js";import{U as z,c as G,f as H,t as U}from"./index-DCO1bnrX.js";import{C as B,b as Q,c as W,d as X,e as Z}from"./DefaultLayout-DtOVfR-z.js";import{C as J}from"./CTooltip-DJZmqRTA.js";import{C as K}from"./CFormTextarea-7eKMLv5H.js";import{C as ee}from"./CFormCheck-DARogK4Q.js";import{C as te}from"./CContainer-BWEGv1Mm.js";import{C as ae,a as ie}from"./CCardBody-Gy5jeeF2.js";import{C as se,a as ne,b as re,c as le,d as ce,e as de}from"./CTable-Banea2CJ.js";import{C as oe}from"./CButtonGroup-BgZmitB1.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";import"./index.esm-dQqYqC5Z.js";import"./isRTL-D5ORmfro.js";const me=({isVisible:e,onClose:t,handleTimeSubmit:a,isLoading:i})=>{const[s,n]=p.useState(!1),[r,l]=p.useState(!1),c=k.object({start:k.string().min(1,{message:"Start time is required"}),end:k.string().min(1,{message:"End time is required"})}),{register:d,handleSubmit:o,formState:{errors:m}}=T({resolver:I(c)});return f.useEffect((()=>{n(e),l(i)}),[e,i]),g(E,{visible:e,onClose:()=>{t(),n(!1)},size:"sm",children:[b(A,{children:b(F,{children:"Add Timeslot"})}),b(q,{children:g(R,{onSubmit:o(a),children:[b(M,{children:b($,{children:g(_,{className:"mb-3",children:[b(Y,{children:"Start Time"}),b(O,{type:"time",...d("start"),invalid:!!m.start}),m.start&&b(V,{invalid:!0,children:m.start.message})]})})}),b(M,{children:b($,{children:g(_,{className:"mb-3",children:[b(Y,{children:"End Time"}),b(O,{type:"time",...d("end"),invalid:!!m.end}),m.end&&b(V,{invalid:!0,children:m.end.message})]})})}),g(P,{children:[b(v,{type:"submit",className:"btn btn-primary",children:r?b(y,{color:"primary"}):"Add Time"}),b(v,{color:"secondary",onClick:t,children:"Cancel"})]})]})})]})};me.propTypes={isVisible:C.bool.isRequired,onClose:C.func.isRequired,handleTimeSubmit:C.func.isRequired,isLoading:C.bool.isRequired};const he=({isVisible:e,onClose:d,isDarkMode:o,interviewData:m})=>{const h=new Date((new Date).setDate((new Date).getDate()-1)),{addToast:p}=f.useContext(S),[y,C]=f.useState(z(new Date)),[U,te]=f.useState(!1),[ae,ie]=f.useState(!1),[se,ne]=f.useState({}),[re,le]=f.useState({}),[ce,de]=f.useState(""),[oe,he]=f.useState([]),[ue,pe]=f.useState([]),[fe,ge]=f.useState(!1),[be,ve]=f.useState(null),[ye,Ce]=f.useState(!1),[Se,we]=f.useState([new Date(2024,10,15),new Date(2024,10,20)]),[Ne,xe]=f.useState([new Date(2024,10,1),new Date(2024,10,5)]),[De,je]=f.useState(1),[Te,Ie]=f.useState(9),[ke,Ee]=f.useState(1),Ae=k.object({title:k.string().min(1,{message:"Title is required"}),date:k.preprocess((e=>new Date(e)),k.date().min(h,{message:"Date should be today or later"})),timeslotId:k.string().optional(),start:k.string().min(1,{message:"Start time is required"}),end:k.string().min(1,{message:"End time is required"}),location:k.string().optional(),capacity:k.preprocess((e=>parseInt(e)),k.number().min(1,{message:"Capacity should be at least 1"})),additionalInfo:k.string().optional()}),{register:qe,handleSubmit:Fe,reset:Re,formState:{errors:Ve}}=T({resolver:async(e,t,a)=>await I(Ae)(e,t,a)}),Le=k.object({start:k.string().min(1,{message:"Start time is required"}),end:k.string().min(1,{message:"End time is required"})}).refine((async e=>{const[t,a]=e.start.split(":").map(Number),[i,s]=e.end.split(":").map(Number);return 60*t+a<60*i+s}),{message:"Start time should be before end time",path:["start"]}),{register:Me,handleSubmit:$e,formState:{errors:_e}}=T({resolver:async(e,t,a)=>await I(Le)(e,t,a)}),Ye=async e=>{try{const t=await N(`/interview/slots?date=${e}`);if(200===t.status){const e=t.data;he(e.data);const a=e.data.filter((e=>e.isAvailable));pe(a)}else p("Error","Failed to fetch time slots","danger")}catch(t){he([]),pe([])}},Oe=()=>{Re({applicantId:"",applicantName:"",date:new Date,start:null,end:null}),d()};return f.useEffect((()=>{Ye(z(y))}),[y]),f.useEffect((()=>{m&&(ie(!0),C(new Date(m.date)),Re({title:m.title,timeslotId:m.timeslot._id,start:G(m.timeslot.start),end:G(m.timeslot.end),location:m.location,additionalInfo:m.additionalInfo}))}),[m]),g(w,{children:[g(E,{visible:e,onClose:Oe,size:"lg",children:[b(A,{children:b(F,{children:ae?"Edit Interview":"Schedule Interview"})}),g(q,{children:[b("div",{className:"mb-5",children:b(u,{onChange:e=>{C(new Date(e))},defaultValue:y,className:o?"calendar dark-mode":"calendar",tileClassName:({date:e,view:t})=>"month"===t&&Se.find((t=>t.getDate()===e.getDate()))?"not-available":Ne.find((t=>t.getDate()===e.getDate()))?"has-events":""})}),g(R,{onSubmit:Fe((async e=>{try{const t={date:y,title:e.title,timeslotRef_id:e.timeslotId,additionalInfo:e.additionalInfo,location:e.location,capacity:e.capacity},a=ae?await j(`/interview/schedule/${m._id}`,t):await D("/interview/schedule",t);200===a.status||201===a.status?(p("Success","Interview scheduled successfully","success"),Oe()):p("Calendar | Schedule Form",a.message.message,"danger")}catch(t){p("Error","Failed to schedule interview","danger")}})),children:[b(M,{children:g($,{children:[g(_,{className:"mb-3",children:[b(Y,{children:b(t,{icon:a})}),b(O,{type:"text",placeholder:"Title",...qe("title"),invalid:!!Ve.title})]}),Ve.title&&b(V,{invalid:!0,children:Ve.title.message})]})}),oe&&0!==oe.length?g(w,{children:[b(M,{children:b($,{children:b(L,{children:"Time Slots"})})}),b(M,{children:b($,{className:"d-flex flex-wrap gap-2 justify-content-start",children:oe.map(((e,a)=>b("div",{className:"mb-3",children:g(B,{color:e.isAvailable?"success":"danger",children:[G(e.start)," -"," ",G(e.end)," ",b(J,{content:e.isAvailable?"Available":"Not Available",placement:"top",children:b(t,{icon:e.isAvailable?i:s})}),b(J,{content:"Delete Time Slot",placement:"top",children:b(v,{onClick:()=>(async e=>{try{200===(await x(`/interview/slot/${e}`)).status?(p("Success","Time slot deleted successfully","success"),Ye(y)):p("Error","Something went wrong. Unable to delete time slot.","danger")}catch(t){}})(e._id),className:"btn",children:b(t,{icon:n})})})]})},a)))})})]}):b(M,{className:"text-danger",children:b($,{children:b(L,{children:"Click a Date to view its timeslot, if none.. add one."})})}),b(M,{children:b($,{className:"d-flex justify-content-end align-items-center",children:b(J,{content:"Add Time Slot",placement:"top",children:b(v,{onClick:()=>ge(!0),className:"btn btn-success mb-3",children:b(t,{icon:r})})})})}),g(M,{children:[b($,{md:4,children:g(_,{className:"mb-3",children:[b(Y,{children:"Date"}),b(O,{type:"text",...qe("date"),invalid:!!Ve.date,value:H(y),readOnly:!0,className:"visually-hidden"}),b(O,{type:"text",invalid:!!Ve.date,value:H(y),readOnly:!0}),Ve.date&&b(V,{invalid:!0,children:Ve.date.message})]})}),b($,{md:8,children:g(_,{className:"mb-3",children:[b(Y,{children:b(t,{icon:l})}),b(O,{type:"text",placeholder:"Start Time",readOnly:!0,...qe("start"),invalid:!!Ve.start}),Ve.start&&b(V,{invalid:!0,children:Ve.start.message}),b(O,{type:"text",placeholder:"End Time",readOnly:!0,...qe("end"),invalid:!!Ve.end}),Ve.end&&b(V,{invalid:!0,children:Ve.end.message}),b(J,{content:"Set Time Slot",placement:"top",children:g(Q,{children:[b(W,{color:"primary",children:"Time"}),b(X,{children:ue.map(((e,t)=>g(Z,{onClick:()=>{ve(e),Re({timeslotId:e._id,start:G(e.start),end:G(e.end)})},disabled:0===ue.length,children:[G(e.start)," -"," ",G(e.end)]},t)))})]})})]})})]}),b(M,{children:b($,{children:g(_,{className:"mb-3",children:[b(Y,{children:"Location"}),b(O,{type:"text",placeholder:"Location",...qe("location"),invalid:!!Ve.location}),Ve.location&&b(V,{invalid:!0,children:Ve.location.message})]})})}),b(M,{children:b($,{children:g(_,{className:"mb-3",children:[b(Y,{children:"Capacity"}),b(O,{type:"number",placeholder:"capacity ",...qe("capacity"),invalid:!!Ve.capacity,defaultValue:1}),Ve.capacity&&b(V,{invalid:!0,children:Ve.capacity.message})]})})}),b(M,{children:b($,{children:g(_,{className:"mb-3",children:[b(Y,{children:b(t,{icon:c})}),b(K,{type:"text",placeholder:"Additional Information",...qe("additionalInfo"),invalid:!!Ve.additionalInfo}),Ve.additionalInfo&&b(V,{invalid:!0,children:Ve.additionalInfo.message})]})})}),b(M,{children:g($,{className:"d-flex justify-content-end",children:[b(ee,{type:"checkbox",id:"invalidCheck",label:"I confirm everything is correct.",checked:U,onChange:()=>te(!U)}),b(V,{invalid:!0,children:"You must agree before submitting."})]})}),g(P,{children:[b(v,{type:"submit",disabled:!U,className:"btn btn-primary",children:ae?"Update":"Schedule"}),b(v,{color:"secondary",onClick:Oe,children:"Cancel"})]})]})]})]}),b(me,{isVisible:fe,onClose:()=>{ge(!1)},handleTimeSubmit:async e=>{Ce(!0);try{const t={date:y,timeslot:{start:e.start,end:e.end}},a=await D("/interview/slots/",t);200===a.status||201===a.status?(p("Success","Time slot added successfully","success"),Ye(y),Ce(!1)):p("Calendar | Timeslots",a.message.message,"danger")}catch(t){Ce(!1)}},isLoading:ye})]})};he.propTypes={isVisible:C.bool.isRequired,onClose:C.func.isRequired,isDarkMode:C.bool.isRequired,interviewData:C.object};const ue=({theme:a})=>{const i="dark"===a,{addToast:s}=f.useContext(S),[l,c]=f.useState(!1),[p,C]=f.useState([new Date,new Date]),[D,j]=f.useState(z(new Date)),[T,I]=f.useState(new Date),[k,E]=f.useState([]),[A,q]=f.useState(!1),[F,V]=f.useState([new Date(2024,10,15),new Date(2024,10,20)]),[L,Y]=f.useState([new Date(2024,10,1),new Date(2024,10,5)]),[P,Q]=f.useState(!1),[W,X]=f.useState(1),[Z,K]=f.useState(9),[ee,me]=f.useState(1),[ue,pe]=f.useState([]),[fe,ge]=f.useState(null),[be,ve]=f.useState([{color:"danger",text:"Not Available"},{color:"warning",text:"Has Events"},{color:"primary",text:"Selected Date"}]),ye=async e=>{q(!0);try{const t=await N(`/interview/all?date=${e}&page=${W}&limit=${Z}`);200===t.status||201===t.status?(pe(t.data.data),E(t.data.slots),me(t.data.totalPages),q(!1)):(q(!1),pe([]),E([]),s("Calendar | Schedules",t.message.message,"danger"))}catch(t){const a=`Failed to fetch interview schedules for ${H(e)}`;s("Error",a,"error"),q(!1)}};return f.useEffect((()=>{const e=setTimeout((()=>{ye(D)}),1e3);return()=>clearTimeout(e)}),[D]),f.useEffect((()=>{P&&fe&&Q(!1)}),[W]),b(w,{children:g(te,{className:"d-flex flex-column gap-3",children:[b(M,{children:g($,{children:[b("h2",{children:"Schedules"}),b("small",{children:"In this page, you can create and edit schedules for interviews, task, or any other events."})]})}),b(M,{children:b(te,{children:b(ae,{children:g(ie,{children:[b("div",{children:be.map(((e,t)=>b(B,{color:e.color,className:"me-2",children:e.text},t)))}),b("div",{children:b(u,{onChange:e=>{e.length>1?C(e):j(e)},selectRange:l,className:i?"calendar dark-mode":"calendar",tileClassName:({date:e,view:t})=>"month"===t&&F.find((t=>t.getDate()===e.getDate()))?"not-available":L.find((t=>t.getDate()===e.getDate()))?"has-events":"",defaultValue:l?[new Date(p[0]),new Date(p[1])]:new Date(D)})}),b("br",{}),b("div",{children:g(_,{children:[b(O,{type:"text",placeholder:"start",value:H(D),readOnly:!0}),b(J,{content:"Create interview",placement:"top",children:b(v,{onClick:()=>Q(!0),className:"btn btn-primary",children:b(t,{icon:r})})})]})})]})})})}),b(M,{children:b($,{children:b(R,{children:g(_,{children:[b(O,{type:"text",placeholder:"Search"}),b(v,{color:"primary",children:b(t,{icon:d})})]})})})}),b(M,{children:b($,{children:b(ae,{children:b(ie,{children:g(se,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[b(ne,{children:g(re,{children:[b(le,{className:"text-center",children:b(t,{icon:o})}),b(le,{className:"text-center",children:"Date"}),b(le,{className:"text-center",children:"Time"}),b(le,{className:"text-center",children:"Location"}),b(le,{className:"text-center",children:"Capacity"}),b(le,{className:"text-center",children:"Action"})]})}),b(ce,{children:A?b(re,{children:b(de,{colSpan:"6",className:"text-center",children:b(y,{color:"primary",variant:"grow"})})}):0===ue.length?b(re,{children:g(de,{colSpan:"6",className:"text-center",children:["No data available for"," ",b("span",{className:"text-info",children:H(D,"MMM d, YYYY")})]})}):ue.map(((e,a)=>g(re,{children:[b(de,{className:"text-center",children:e.title}),b(de,{className:"text-center",children:H(e.date)}),g(de,{className:"text-center",children:[G(e.timeslot.start)," -"," ",G(e.timeslot.end)]}),b(de,{className:"text-center",children:e.location?U(e.location,20):"N/A"}),b(de,{className:"text-center",children:e.capacity?U(e.capacity,20):"N/A"}),b(de,{className:"text-center",children:g(oe,{children:[g(v,{onClick:()=>{ge(e),Q(!0)},className:"btn btn-primary",children:[b(J,{content:"Edit",placement:"top",children:b(t,{icon:m})})," "]}),g(v,{onClick:()=>(async e=>{try{200===(await x(`/interview/schedule/${e}`)).status?(s("Success","Successfully deleted interview schedule","success"),ye(D)):s("Error","Failed to delete interview schedule","error")}catch(t){s("Error","Failed to delete interview schedule","error")}})(e._id),className:"btn btn-danger",children:[b(J,{content:"Delete",placement:"top",children:b(t,{icon:n})})," "]}),b(v,{className:"btn btn-warning",children:b(J,{content:"Cancel",placement:"top",children:b(t,{icon:h})})})]})})]},a)))})]})})})})}),b(M,{children:b($,{children:b("div",{className:"d-flex justify-content-center align-items-center",children:b(e,{currentPage:W,totalPages:ee,onPageChange:X})})})}),b(M,{children:b(he,{isVisible:P,onClose:()=>Q(!1),isDarkMode:i,interviewData:fe})})]})})};ue.propTypes={theme:C.string};export{ue as default};
