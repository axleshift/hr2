import{r as e}from"./react-router-dom-BnDDw25P.js";import{_ as a,j as i,a as t,c as n,b as r,p as s,m as l,A as c,l as o,g as d,k as m,w as p,x as u,v as h,F as v,y as f}from"./index-DVAAnj-9.js";import{z as b}from"./zod-B0zZW6rS.js";import{u as y,b as g}from"./react-hook-form-DB8hWBdy.js";import{s as w}from"./@hookform/resolvers/zod-1wp20Skh.js";import{f as x,b as C}from"./index-DCO1bnrX.js";import{A as N}from"./AppPagination-D5Gejofw.js";import{C as S,a as j,b as A}from"./CModalHeader-D3Pijq-f.js";import{C as E}from"./CModalTitle-DWg7cv10.js";import{C as k,a as F,b as I,c as $}from"./CTabList-TQKtZhPO.js";import{a as q}from"./DefaultLayout-BQRtu9S-.js";import{b as z,C as T,a as P}from"./CFormLabel-C3ZNjviW.js";import{C as R,a as D}from"./CRow-Dujfgc-X.js";import{C as _}from"./CFormInput-DlNfdHmF.js";import{C as M}from"./CFormSelect-CvPrxnA6.js";import{C as V}from"./CFormRange-CbTDvK5e.js";import{C as O}from"./CFormTextarea-R1STRuei.js";import{C as L}from"./CContainer-C-7WEMUq.js";import{C as K,a as Y}from"./CCardBody-D-rMfn6F.js";import{C as H,a as J,c as Q,d as U,b as B,e as G}from"./CTable-PTB9eoDi.js";import"./ConfirmationDialog-DoBgyNKl.js";import{C as W}from"./CCardHeader-P4bzxz2C.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";import"./index.es-DNrzUf6T.js";import"./CTooltip-BemHtZwS.js";import"./isRTL-D5ORmfro.js";import"./index.esm-CRpYSObv.js";var Z=e.forwardRef((function(e,s){var l,c=e.className,o=e.id,d=e.invalid,m=e.label,p=e.reverse,u=e.size,h=e.type,v=void 0===h?"checkbox":h,f=e.valid,b=a(e,["className","id","invalid","label","reverse","size","type","valid"]);return i("div",{className:n("form-check form-switch",(l={"form-check-reverse":p},l["form-switch-".concat(u)]=u,l["is-invalid"]=d,l["is-valid"]=f,l),c),children:[t("input",{...r({type:v,className:n("form-check-input",{"is-invalid":d,"is-valid":f}),id:o},b,{ref:s})}),m&&t(z,{...r({customClassName:"form-check-label"},o&&{htmlFor:o}),children:m})]})}));Z.propTypes={className:s.string,id:s.string,invalid:s.bool,label:s.oneOfType([s.string,s.node]),reverse:s.bool,size:s.oneOf(["lg","xl"]),type:s.oneOf(["checkbox","radio"]),valid:s.bool},Z.displayName="CFormSwitch";const X=b.object({date:b.string().nonempty("Date is required"),job:b.string().min(1,{message:"Job is required"}),type:b.enum(["Phone","Video","In-Person"]),general:b.object({communication:b.coerce.number().min(1).max(5).default(1),technical:b.coerce.number().min(1).max(5).default(1),problemSolving:b.coerce.number().min(1).max(5).default(1),culturalFit:b.coerce.number().min(1).max(5).default(1),workExperienceRelevance:b.coerce.number().min(1).max(5).default(1),leadership:b.coerce.number().min(1).max(5).default(1)}),questions:b.array(b.object({question:b.string().min(1,{message:"A question is required."}),remark:b.string().optional()})).optional(),salaryExpectation:b.coerce.number().min(1).default(1),strength:b.string().optional(),weakness:b.string().optional(),recommendation:b.enum(["yes","no","need further review"]),finalComments:b.string().optional()}),ee=({isVisible:a,onClose:n,state:r,eventData:s,applicantData:v})=>{const{addToast:f}=e.useContext(l),{userInformation:b}=e.useContext(c),[C,z]=e.useState([]),[W,Z]=e.useState([]),[ee,ae]=e.useState(!1),[ie,te]=e.useState(""),[ne,re]=e.useState("view"),[se,le]=e.useState(1),[ce,oe]=e.useState(9),[de,me]=e.useState(0),[pe,ue]=e.useState(0),{control:he,register:ve,handleSubmit:fe,reset:be,setValue:ye,watch:ge,formState:{errors:we}}=y({resolver:async(e,a,i)=>await w(X)(e,a,i)}),{fields:xe,append:Ce,remove:Ne}=g({control:he,name:"questions"});return e.useEffect((()=>{a&&s&&setTimeout((()=>{be({date:(null==s?void 0:s.date)?s.date.split("T")[0]:"",general:{communication:1,technical:1,problemSolving:1,culturalFit:1,workExperienceRelevance:1,leadership:1}})}),100)}),[a,s,be]),e.useEffect((()=>{a&&(re(r),(async()=>{try{ae(!0);const e=ie?await p(`/applicant/interview/all/${v._id}?query=${ie}&page=${se}&limit=${ce}&sort=desc`):await p(`/applicant/interview/all/${v._id}?page=${se}&limit=${ce}&sort=desc`);200===e.status?(z(e.data.data),ue(e.data.totalItems),me(e.data.totalPages),le(e.data.currentPage)):(z([]),ue(0),me(0),le(1)),ae(!1)}catch(e){ae(!1)}})())}),[a,r]),i(S,{visible:a,onClose:()=>{n(),be({applicant:"",job:"",date:"",type:"Phone",general:{communication:1,technical:1,problemSolving:1,culturalFit:1,workExperienceRelevance:1,leadership:1},salaryExpectation:1,strength:"",weakness:"",recommendation:"yes",finalComments:""})},size:"xl",children:[t(j,{children:t(E,{children:"edit"===ne?"Edit Interview":"Interview Form"})}),t(A,{children:i(k,{activeItemKey:"form",children:[i(F,{variant:"tabs",children:[t(I,{itemKey:"form",children:"Form"}),t(I,{itemKey:"history",children:"History"})]}),i(q,{children:[t($,{itemKey:"form",children:i(T,{onSubmit:fe((async e=>{try{const a="edit"===ne?await u(`/applicant/interview/${W._id}`,e):await h(`/applicant/interview/${v._id}/${s._id}`,e);200!==a.status&&201!==a.status||(f("Success","Interview saved successfully","success"),be(),n())}catch(a){f("Error","An error occurred","danger")}})),className:"mt-3",children:["development"===o.env,v&&i(R,{className:"mb-3",children:[t(D,{children:t(_,{label:"Firstname",value:v.firstname,readOnly:!0})}),t(D,{children:t(_,{label:"Lastname",value:v.lastname,readOnly:!0})})]}),t(R,{className:"mb-3",children:i(D,{children:[t(_,{type:"date",label:"Date",...ve("date"),invalid:!!we.date,readOnly:!0}),we.date&&t(P,{invalid:!0,children:we.date.message})]})}),i(R,{className:"mb-3",children:[i(D,{children:[i(M,{label:"Interview Type",...ve("type"),invalid:!!we.type,children:[t("option",{value:"Phone",children:"Phone"}),t("option",{value:"Video",children:"Video"}),t("option",{value:"In-Person",children:"In-Person"})]}),we.type&&t(P,{invalid:!0,children:we.type.message})]}),t(D,{children:t(_,{label:"Event Type",value:s.type,readOnly:!0})})]}),t("h5",{children:"General Ratings"}),["communication","technical","problemSolving","culturalFit","workExperienceRelevance","leadership"].map((e=>{var a,n;return t(R,{className:"mb-3",children:i(D,{children:[i("label",{children:[e.replace(/([A-Z])/g," $1").trim()," (",ge(`general.${e}`),")"]}),t(V,{min:1,max:5,step:1,default:1,...ve(`general.${e}`,{valueAsNumber:!0}),invalid:!!(null==(a=we.general)?void 0:a[e])}),(null==(n=we.general)?void 0:n[e])&&t(P,{invalid:!0,children:we.general[e].message})]})},e)})),t(R,{children:t(D,{className:"d-flex justify-content-end",children:t(d,{type:"button",color:"info",size:"sm",onClick:()=>Ce({question:"",remark:""}),children:"Add Question"})})}),t(R,{children:t(D,{children:xe.map(((e,a)=>{var n,r,s,l;return t(R,{className:"mb-3",children:i(D,{children:[t(R,{className:"mb-3",children:i(D,{children:[t(_,{label:`Question ${a+1}`,autoComplete:"question",...ve(`questions.${a}.question`),invalid:!!(null==(r=null==(n=we.questions)?void 0:n[a])?void 0:r.question)}),(null==(l=null==(s=we.questions)?void 0:s[a])?void 0:l.question)&&t(P,{invalid:!0,children:we.questions[a].question.message})]})}),t(R,{className:"mb-2",children:t(D,{children:t(O,{label:"Remarks",autoComplete:"remark",...ve(`questions.${a}.remark`)})})}),t(R,{className:"mb-2",children:t(D,{children:t(D,{children:t("div",{className:"d-flex justify-content-end",children:t(d,{type:"button",color:"danger",size:"sm",onClick:()=>Ne(a),children:"Remove"})})})})})]})},e.id)}))})}),i(R,{className:"mb-3",children:[i(D,{children:[t(_,{label:"Job / Position Applied For",...ve("job"),invalid:!!we.job}),we.job&&t(P,{invalid:!0,children:we.job.message})]}),i(D,{children:[t(_,{type:"number",label:"Salary Expectations",...ve("salaryExpectation",{valueAsNumber:!0}),invalid:!!we.salaryExpectation}),we.salaryExpectation&&t(P,{invalid:!0,children:we.salaryExpectation.message})]})]}),t(R,{className:"mb-3",children:i(D,{children:[i(M,{label:"Recommendation",...ve("recommendation"),invalid:!!we.recommendation,children:[t("option",{value:"yes",children:"Yes"}),t("option",{value:"no",children:"No"}),t("option",{value:"need further review",children:"Need Further Review"})]}),we.recommendation&&t(P,{invalid:!0,children:we.recommendation.message})]})}),t(R,{className:"mb-3",children:t(D,{children:t(O,{label:"Strength",...ve("strength")})})}),t(R,{className:"mb-3",children:t(D,{children:t(O,{label:"Weakness",...ve("weakness")})})}),t(R,{className:"mb-3",children:t(D,{children:t(O,{label:"Final Comments",...ve("finalComments")})})}),t(R,{children:t(D,{className:"d-flex justify-content-end",children:["admin","interviewer","manager"].includes(b.role)?t(d,{type:"submit",color:"primary",size:"sm",children:"edit"===ne?"Update":"Create"}):t(d,{color:"danger",size:"sm",disabled:!0,children:"No Permission"})})})]})}),t($,{itemKey:"history",children:i(L,{className:"mt-3",children:[t(R,{className:"mb-3",children:t(D,{children:t(K,{children:t(Y,{children:i(H,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[i(J,{children:[t(Q,{children:"Interviewer"}),t(Q,{children:"Type"}),t(Q,{children:"Event Type"}),t(Q,{children:"Job"}),t(Q,{children:"Recommendation"}),t(Q,{children:"Created"}),t(Q,{children:"Actions"})]}),t(U,{children:ee?t(B,{children:t(G,{colSpan:"12",children:t("div",{className:"pt-3 text-center",children:t(m,{color:"primary",variant:"grow"})})})}):0===C.length?t(B,{children:t(G,{colSpan:"12",children:t("div",{className:"text-center",children:"No Interviews History Found"})})}):C.map((e=>{var a;return i(B,{children:[t(G,{children:i("div",{children:[e.interviewer.lastname,", ",e.interviewer.firstname]})}),t(G,{children:e.type}),t(G,{children:null==(a=null==e?void 0:e.event)?void 0:a.type}),t(G,{children:null==e?void 0:e.job}),t(G,{className:"text-capitalize",children:e.recommendation}),t(G,{children:x(e.date,"MMM DD YYYY h:mm A")}),t(G,{children:t(d,{color:"primary",size:"sm",onClick:()=>{(e=>{var a,i,t,n,r,s,l;re("edit"),be({date:e.date?e.date.split("T")[0]:"",job:e.job?e.job:"",type:e.type||"Phone",general:{communication:(null==(a=e.general)?void 0:a.communication)||1,technical:(null==(i=e.general)?void 0:i.technical)||1,problemSolving:(null==(t=e.general)?void 0:t.problemSolving)||1,culturalFit:(null==(n=e.general)?void 0:n.culturalFit)||1,workExperienceRelevance:(null==(r=e.general)?void 0:r.workExperienceRelevance)||1,leadership:(null==(s=e.general)?void 0:s.leadership)||1},questions:(null==(l=e.questions)?void 0:l.length)?e.questions:[{question:"",remark:""}],salaryExpectation:e.salaryExpectation||1,strength:e.strength||"",weakness:e.weakness||"",recommendation:e.recommendation||"yes",finalComments:e.finalComments||""}),f("Success","Interview fetched. Please change to forms tab.","success")})(e),Z(e)},children:"View"})})]},e._id)}))})]})})})})}),t(R,{children:t(D,{children:t("div",{className:"d-flex flex-row gap-2 justify-content-center align-items-center",children:t(N,{currentPage:se,totalPages:de,onPageChange:le})})})})]})})]})]})})]})};ee.propTypes={isVisible:s.bool.isRequired,onClose:s.func.isRequired,state:s.string,eventData:s.object,applicantData:s.object};const ae=({isVisible:a,onClose:n,slot:r,state:s})=>{var g,x,N;const{addToast:k}=e.useContext(l),{userInformation:F}=e.useContext(c),[I,$]=e.useState({}),[q,V]=e.useState(!1),[X,ae]=e.useState(!1),[ie,te]=e.useState("view"),[ne,re]=e.useState(!0),[se,le]=e.useState(["Initial Interview","Final Interview","Other"]),[ce,oe]=e.useState(!1),[de,me]=e.useState(!1),[pe,ue]=e.useState(!1),[he,ve]=e.useState([]),[fe,be]=e.useState(!1),[ye,ge]=e.useState(!1),[we,xe]=e.useState("view"),[Ce,Ne]=e.useState({}),[Se,je]=e.useState({}),[Ae,Ee]=e.useState([]),[ke,Fe]=e.useState(!1),[Ie,$e]=e.useState(""),[qe,ze]=e.useState(1),[Te,Pe]=e.useState(9),[Re,De]=e.useState(0),[_e,Me]=e.useState(0),Ve=async()=>{var e;try{ae(!0);const a=await p(`/facilities/event/${r.event}`);if(200===a.status)return $(a.data.data),He({...a.data.data,isApproved:null==(e=a.data.data.isApproved)?void 0:e.status}),ae(!1),k("Success","Event Fetched","success")}catch(a){k("error","failed to load event data","danger")}},Oe=b.object({name:b.string().min(3).max(50),description:b.string().optional(),capacity:b.number().int().positive(),type:b.enum(se,{errorMap:()=>({message:"Invalid Event Type"})}),isApproved:b.union([b.boolean(),b.object({status:b.boolean()})]).transform((e=>"boolean"==typeof e?e:e.status)).default(!1)}),{register:Le,watch:Ke,handleSubmit:Ye,reset:He,formState:{errors:Je},setValue:Qe}=y({resolver:async(e,a,i)=>await w(Oe)(e,a,i),defaultValues:(null==(g=I.isApproved)?void 0:g.status)??!1}),Ue=Ke("isApproved",null==(x=I.isApproved)?void 0:x.status),Be=()=>{He({name:"",description:"",capacity:1,type:"",isApproved:!1})};return e.useEffect((()=>{a&&V(a)}),[a]),e.useEffect((()=>{q&&(te(s),"view"!==s&&"edit"!==s||Ve())}),[q,s]),e.useEffect((()=>{switch(ie){case"edit":case"create":re(!1);break;default:re(!0)}}),[ie]),i(L,{children:[t(R,{children:t(D,{children:i(S,{visible:q,onClose:()=>{Be(),n(),$({}),te("view"),re(!1),V(!1)},size:"xl",children:[t(j,{children:t(E,{children:"edit"===ie||"create"===ie?"Manage Event":"View Event"})}),t(A,{children:i(L,{children:[t(R,{className:"mb-3",children:i(D,{className:"d-flex flex-column",children:[i("strong",{children:[C(r.start)," - ",C(r.end)]}),i("small",{className:"text-muted",children:[" Timeslot ID: ",r._id]}),I&&i("small",{className:"text-muted",children:[" Event ID: ",I._id]}),"development"===o.env]})}),X?t(R,{children:t(D,{children:t(m,{size:"sm"})})}):i(v,{children:[t(R,{children:t(D,{children:i(T,{onSubmit:Ye((async e=>{try{oe(!0);const a=new FormData;let i;if(a.append("name",e.name),a.append("description",e.description),a.append("capacity",e.capacity),a.append("type",e.type),a.append("isApproved",e.isApproved),"edit"===ie)i=await u(`/facilities/event/${r._id}`,e);else i=await h(`/facilities/event/${r._id}`,e);const t=i.data.data;switch(i.status){case 201:k("success","Event created!","success"),$(t),te("edit");break;case 200:k("success","Event updated!","success"),$(t);break;default:k("Error","Failed to create event","danger")}oe(!1)}catch(a){oe(!1),k("Error","An unexpected error occurred","danger")}})),children:[t(R,{className:"mb-3",children:i(D,{children:[t(_,{type:"text",label:"Name",placeholder:"Applicant Interview",...Le("name"),readOnly:ne,invalid:Je.name}),Je.name&&t(P,{invalid:!0,className:"text-danger",children:Je.name.message})]})}),t(R,{className:"mb-3",children:i(D,{children:[t(O,{type:"text",label:"Description",placeholder:"Lorem ipsum...",rows:6,...Le("description"),invalid:Je.description,readOnly:ne}),Je.description&&t(P,{invalid:!0,className:"text-danger",children:Je.description.message})]})}),t(R,{className:"mb-3",children:i(D,{children:[t(_,{type:"number",label:"Capacity",placeholder:"1",defaultValue:1,...Le("capacity",{valueAsNumber:!0}),readOnly:ne,invalid:Je.capacity}),Je.capacity&&t(P,{invalid:!0,className:"text-danger",children:Je.capacity.message})]})}),t(R,{className:"mb-3",children:i(D,{children:[t(z,{htmlFor:"type",children:"Event Type"}),i(M,{id:"type",...Le("type"),invalid:!!Je.type,disabled:ne,children:[t("option",{value:"",children:"Select an event type"}),se.map((e=>t("option",{value:e,children:e},e)))]}),Je.type&&t(P,{invalid:!0,className:"text-danger",children:Je.type.message})]})}),t(R,{className:"mb-3",children:i(D,{children:[i(z,{htmlFor:"isApproved",children:["Current approval status:"," ",(null==(N=I.isApproved)?void 0:N.status)?t("span",{className:"text-success",children:"Approved"}):t("span",{className:"text-danger",children:"Not approved"})]}),t(Z,{id:"isApproved",label:""+(Ue?"Approved":"Not Approved"),...Le("isApproved",{valueAsBoolean:!0}),disabled:("admin"===F.role||"manager"===F.role)&&ne})]})}),t(R,{className:"mb-3",children:t(D,{children:("edit"===ie||"create"===ie)&&i("div",{className:"d-flex justify-content-end gap-2",children:[t(d,{type:"button",color:"warning",size:"sm",onClick:()=>{const e=Math.floor(100*Math.random()),a={name:`Event ${e}`,description:`This is a mock description for event #${e}`,capacity:Math.floor(100*Math.random())+1};He(a)},children:"Fill Mock Data"}),"edit"===ie&&t(d,{color:"danger",size:"sm",onClick:()=>(async()=>{try{if(!confirm("Are you sure you want to delete this event?"))return;if(200===(await f(`/facilities/event/${r._id}`)).status)return Be(),n(),V(!1),k("Success","Event deleted!","success")}catch(e){k("Error",e,"danger")}})(),children:"Delete"}),t(d,{type:"submit",color:"primary",size:"sm",children:ce?t(m,{size:"sm"}):"edit"===ie?"Update":"Create"})]})})})]})})}),I.participants&&t(v,{children:t(R,{children:t(D,{children:i(K,{children:[t(W,{children:i("div",{className:"d-flex justify-content-between",children:[t("div",{children:"Participants"}),["admin","recruiter"].includes(F.role)&&"edit"===ie&&I.participants.length>0&&(I.isApproved.status?t("div",{children:t(d,{size:"sm",color:"info",disabled:pe,onClick:()=>(async()=>{try{if(!confirm("Are you sure you want to send email?"))return;ue(!0);const e=await h(`/facilities/events/${I._id}/send-email`);return 200===e.status?(ue(!1),ve(e.data.failedMails),k("Success",`Email sent for participant for event ${I.name}`,"success")):(ue(!1),k("Info",e.message.message,"info"))}catch(e){k("Error","An error occured","danger")}})(),children:pe?i("span",{children:[t(m,{size:"sm"})," sending..."]}):I.emailSent.status?"Resend Mail to Participants":"Send Mail to Participants"})}):t(d,{size:"sm",color:"info",disabled:!0,children:"Needs Approval"}))]})}),t(Y,{children:i(H,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[t(J,{children:i(B,{children:[t(Q,{children:"Name"}),t(Q,{children:"Email"}),t(Q,{children:"Phone"}),t(Q,{children:"Email Sent"}),t(Q,{children:"Action"})]})}),t(U,{children:I.participants.map((e=>i(B,{children:[i(G,{children:[e.applicant.lastname,", ",e.applicant.firstname]}),t(G,{children:e.applicant.email}),t(G,{children:e.applicant.phone}),t(G,{children:e.mail.sent?t("span",{className:"text-success",children:"Sent"}):t("span",{className:"text-danger",children:"Failed"})}),t(G,{children:i("div",{className:"d-flex flex-row gap-2",children:[("edit"===ie||"create"===ie)&&t(d,{size:"sm",color:"danger",onClick:()=>(async e=>{try{if(!confirm("Are you sure you want to delete this applicant?"))return;me(!0),(new FormData).append("applicantId",e._id);const a=await f(`/facilities/events/${I._id}/unbook?applicantId=${e._id}`);return 200===a.status?(Ve(),me(!1),k("Success","Applicant removed from the event","success")):(me(!1),k("Info",a.message.message,"info"))}catch(a){k("Error","An error occured","danger")}})(e.applicant),disabled:de,children:de?t(m,{size:"sm"}):"Remove"}),["admin","manager","recruiter"].includes(F.role)&&["Initial Interview","Final Interview"].includes(I.type)&&I.isApproved.status&&t(d,{color:"info",size:"sm",onClick:()=>{be(!0),te("edit"),V(!1),je(e.applicant),Ne({_id:I._id,name:I.name,date:I.date,type:I.type})},children:"Interview"})]})})]},e.applicant._id)))})]})})]})})})})]})]})})]})})}),t(R,{children:t(D,{children:t(ee,{isVisible:fe,onClose:()=>{te("view"),be(!1),V(!0)},state:we,eventData:Ce,applicantData:Se})})})]})};ae.propTypes={isVisible:s.bool,onClose:s.func,state:s.string,slot:s.object};export{ae as default};
