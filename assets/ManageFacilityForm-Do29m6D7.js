const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CANlPsSl.js","./Calendar-Boc9hzhP.js","./index-DiLnYbjC.js","./react-router-dom-BnDDw25P.js","./react-BF1r7_8g.js","./react-dom-DgB6LS8R.js","./index-C5oYSpm-.css","./clsx-BeLtu-UY.js","./EventForm--1G_bsNu.js","./zod-B0zZW6rS.js","./react-hook-form-DB8hWBdy.js","./@hookform/resolvers/zod-1wp20Skh.js","./index-BOi-5bX2.js","./AppPagination-CAajZQ_e.js","./index.es-BUpMRE3D.js","./CModalHeader-BDpLr51j.js","./DefaultLayout-Cau2R5kl.js","./CContainer-DzOuZpEx.js","./index.esm-Dwb_M0UQ.js","./isRTL-D5ORmfro.js","./DefaultLayout-C111EtUu.css","./CModalTitle-Cp-5Mm7J.js","./CTabList-CMUdfq-k.js","./CTooltip-Dv1PmkHW.js","./CFormLabel-DwEY-V3u.js","./CRow-BNc0QFWW.js","./CFormInput-uT5SP9Ht.js","./CFormSelect-C1vm9vYc.js","./CFormRange-CUaN4TSW.js","./CFormTextarea-D1VEMpzQ.js","./CCardBody-BlNAuiwx.js","./CTable-Bp7z3h6O.js","./ConfirmationDialog-DKnIDZMn.js","./CCardHeader-RwHMwrzp.js"])))=>i.map(i=>d[i]);
import{m as e,j as t,a as s,l as a,k as r,g as i,x as n,i as d,w as l,z as o,p as c}from"./index-DiLnYbjC.js";import{r as m,R as h}from"./react-router-dom-BnDDw25P.js";import{z as u}from"./zod-B0zZW6rS.js";import{u as f}from"./react-hook-form-DB8hWBdy.js";import{s as p}from"./@hookform/resolvers/zod-1wp20Skh.js";import{f as g,t as C}from"./index-BOi-5bX2.js";import"./index.es-BUpMRE3D.js";import"./ConfirmationDialog-DKnIDZMn.js";import{C as y}from"./CContainer-DzOuZpEx.js";import{C as b,a as S}from"./CRow-BNc0QFWW.js";import{C as v,a as j,b as x}from"./CModalHeader-BDpLr51j.js";import{C as w}from"./CModalTitle-Cp-5Mm7J.js";import{C as N,a as _,b as T,c as D}from"./CTabList-CMUdfq-k.js";import{b as A}from"./DefaultLayout-Cau2R5kl.js";import{C as E}from"./CFormLabel-DwEY-V3u.js";import{C as k}from"./CFormInput-uT5SP9Ht.js";import{C as z,a as M}from"./CCardBody-BlNAuiwx.js";import{C as I}from"./CCardHeader-RwHMwrzp.js";import{C as $,a as R,b as L,c as H,d as K,e as V}from"./CTable-Bp7z3h6O.js";import{C as F}from"./CTooltip-Dv1PmkHW.js";import"./react-dom-DgB6LS8R.js";import"./react-BF1r7_8g.js";import"./index.esm-Dwb_M0UQ.js";import"./isRTL-D5ORmfro.js";const O=h.lazy((()=>d((()=>import("./index-CANlPsSl.js")),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url))),P=h.lazy((()=>d((()=>import("./EventForm--1G_bsNu.js")),__vite__mapDeps([8,3,4,5,2,6,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]),import.meta.url))),q=({isVisible:d,onClose:c,facility:h={}})=>{const{addToast:q}=m.useContext(e),[B,J]=m.useState({}),[Z,W]=m.useState(!1),[X,Y]=m.useState(!1),[G,Q]=m.useState(!1),[U,ee]=m.useState(new Date),[te,se]=m.useState(!1),[ae,re]=m.useState([]),[ie,ne]=m.useState([]),[de,le]=m.useState(!1),[oe,ce]=m.useState(!1),[me,he]=m.useState(!1),[ue,fe]=m.useState({}),[pe,ge]=m.useState([]),[Ce,ye]=m.useState(!1),[be,Se]=m.useState(!1),[ve,je]=m.useState(!1),[xe,we]=m.useState({}),[Ne,_e]=m.useState(!1),[Te,De]=m.useState("edit"),[Ae,Ee]=m.useState(!1),[ke,ze]=m.useState(5e3),[Me,Ie]=m.useState(0),$e=(e,t="12h")=>{const[s,a]=e.split(":");return`${s%12||12}:${a} ${s<12?"AM":"PM"}`},Re=()=>{if(B.timeslots){const e=B.timeslots.map((e=>new Date(e.date))).map((e=>new Date(e)));re(e)}},Le=async()=>{try{W(!0);const e=await n(`/facilities/${B._id}`);200===e.status&&(J(e.data.data),Re(),W(!1))}catch(e){q("Error","Failed to reload facility data","danger")}},He=async()=>{try{le(!0);const e=await n(`/facilities/timeslot/${B._id}/${new Date(U)}`);if(200===e.status)return le(!1),ne(e.data.data);if(404===e.status)return le(!1),ne([])}catch(e){le(!1),q("error","An error occurred while fetching timeslots","danger")}},Ke=u.object({start:u.string().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,"Invalid time format, must be HH:MM"),end:u.string().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,"Invalid time format, must be HH:MM")}).superRefine(((e,t)=>{e.start>=e.end&&t.addIssue({code:u.ZodIssueCode.custom,message:"Start time must be before end time",path:["start"]});ie.find((t=>e.start<t.end&&e.end>t.start))&&t.addIssue({code:u.ZodIssueCode.custom,message:"Timeslot overlaps with an existing one",path:["start"]})})),{register:Ve,handleSubmit:Fe,reset:Oe,formState:{errors:Pe}}=f({resolver:p(Ke)});return m.useEffect((()=>{X&&(Re(),He())}),[U,X]),m.useEffect((()=>{h&&h._id&&(J(h),Le())}),[h]),m.useEffect((()=>{d&&Y(d)}),[d]),t(y,{children:[s(b,{children:s(S,{children:t(v,{visible:X,onClose:()=>{Y(!1),re([]),c(),Oe()},size:"lg",backdrop:"static",children:[s(j,{children:t(w,{children:["Manage ",B.name||"Facility"]})}),s(x,{children:t(N,{activeItemKey:0,children:[t(_,{variant:"underline-border",children:[s(T,{itemKey:0,children:"Timeslots"}),s(T,{itemKey:1,children:"Events"})]}),t(A,{children:[s(D,{itemKey:0,children:t(y,{children:[s(b,{className:"mb-3",children:t(S,{children:["development"===a.env,Z?s("div",{className:"d-flex justify-content-center",children:t("span",{children:[s(r,{size:"sm"})," Loading Calendar..."]})}):s(O,{onChange:e=>{const t=new Date(e.getTime()-6e4*e.getTimezoneOffset());ee(t)},className:G?"calendar dark-mode":"calendar",defaultValue:U,tileClassName:({date:e})=>{if(ae.find((t=>t.toDateString()===e.toDateString())))return"has-timeslots"}})]})}),s(b,{className:"mb-3",children:t(S,{children:["Manage timeslots for"," ",s("span",{className:"text-info",children:g(U)})]})}),s(b,{className:"mb-3",children:s(S,{children:s(E,{onSubmit:Fe((async e=>{try{ce(!0);const t={date:new Date(U),start:e.start,end:e.end},s=await l(`/facilities/timeslot/create/${B._id}`,t);return 404===s.status||400===s.status?(ce(!1),Le(),q("error",JSON.stringify(s.message.message),"danger")):(Le(),He(),ce(!1),q("success","Timeslot added successfully","success"))}catch(t){ce(!1),q("error","An error occurred while adding timeslot","danger")}})),children:t(b,{className:"d-flex gap-2",children:[t(S,{children:[s(k,{type:"time",...Ve("start"),placeholder:"Start time",invalid:!!Pe.start}),Pe.start&&s("div",{className:"invalid-feedback",children:Pe.start.message})]}),t(S,{children:[s(k,{type:"time",...Ve("end"),placeholder:"End time",invalid:!!Pe.end}),Pe.end&&s("div",{className:"invalid-feedback",children:Pe.end.message})]}),s(S,{children:t("div",{className:"d-flex justify-content-end gap-2",children:[oe?t(i,{color:"primary",disabled:!0,children:[s("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),"Â Adding..."]}):s(i,{color:"primary",type:"submit",children:"Add"}),s(i,{color:"primary",onClick:()=>Le(),children:"Refresh"})]})})]})})})}),s(b,{children:s(S,{children:t(z,{children:[s(I,{children:"Timeslots"}),s(M,{children:t($,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[s(R,{children:t(L,{children:[s(H,{children:"#"}),s(H,{children:"Date"}),s(H,{children:"Start"}),s(H,{children:"End"}),s(H,{children:"Availability"}),s(H,{children:"Action"})]})}),s(K,{children:0===ie.length?s(L,{children:t(V,{colSpan:"6",className:"text-center",children:["No timeslots found for ",g(U)]})}):ie.map((e=>t(L,{children:[s(V,{children:s(F,{content:e._id,placement:"top",children:s("span",{className:"text-muted",children:C(e._id,10)})})}),s(V,{children:g(new Date(e.date))}),s(V,{children:$e(e.start,"12h")}),s(V,{children:$e(e.end,"12h")}),s(V,{children:e.isAvailable?s("span",{className:"text-success",children:"Available"}):s("span",{className:"text-danger",children:"Booked"})}),s(V,{children:t("div",{className:"d-flex flex-wrap gap-2",children:[s(i,{color:"danger",size:"sm",onClick:()=>(async e=>{try{if(!confirm("Are you sure you want to delete this timeslot?"))return;he(!0);const t=await o(`/facilities/timeslot/delete/${e._id}`);return 200===t.status?(he(!1),He(),q("success","Timeslot removed successfully","success")):(he(!1),He(),q("error",t.data.message,"danger"))}catch(t){q("error","An error occurred while removing timeslot","danger")}})(e),children:me?s(r,{size:"sm"}):"Delete"}),e.isAvailable?s(i,{color:"info",size:"sm",onClick:()=>{fe(e),Se(!0),Y(!1),De("create")},children:"Set Event"}):s(i,{color:"info",size:"sm",onClick:()=>{fe(e),Se(!0),Y(!1),De("edit")},children:"Manage Event"})]})})]},e._id)))})]})})]})})})]})}),s(D,{itemKey:1,children:"events"})]})]})})]})})}),s(b,{children:s(S,{children:s(P,{isVisible:be,onClose:()=>{Se(!1),Y(!0),Le(),Re()},state:Te,slot:ue})})})]})};q.propTypes={isVisible:c.bool.isRequired,onClose:c.func.isRequired,facility:c.object};export{q as default};
