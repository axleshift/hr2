import{p as P,r as a,j as e,B as me,z as ae,E as Se,y as ve}from"./index-CfTEwqGC.js";import{A as De}from"./AppPagination-DxAZLhyL.js";import{F as u,j as le,C as Te,A as we,l as Ie,v as ue,D as Ne,E as Me,G as ke,z as Ae,H as Fe,s as Ee}from"./index.es-Bw4uGRRB.js";import{C as he,T as Pe}from"./TimeForm-BhY_IvN8.js";import{z as o,u as ne,t as ie}from"./zod-Q_HhyeD9.js";import{d as p,C as G,f as Re,a as ee,t as re}from"./index-CpgclVUB.js";import{C as He,a as qe,b as Ve,c as Be,d as Le}from"./CModalTitle-BgEAbDmi.js";import{C as xe,a as g,c as C,b as oe}from"./CFormInput-YRLE8Xc-.js";import{C as c,a as m}from"./CRow-B8erYBcl.js";import{C as b}from"./CInputGroup-0GWwUP0J.js";import{C as I}from"./CInputGroupText-ChKjNVeW.js";import{a as Oe,b as $e,c as _e,d as ze,e as Ge}from"./DefaultLayout-nRAcS4In.js";import{a as D}from"./CButton-DbpnflGB.js";import{C as Ue}from"./CFormTextarea-Dpmp1bUN.js";import{C as Xe}from"./CFormCheck-CF1vtGfW.js";import{C as W}from"./CContainer-DavDhxmw.js";import{C as ce,a as de}from"./CCardBody-I5BQLfex.js";import{C as Ye,a as Je,b as Z,c as N,d as Ke,e as v}from"./CTable-6ZrYDWQR.js";import"./clsx-B-dksMZM.js";import"./index.esm-B7Ye19Pf.js";const je=({isVisible:U,onClose:R,isDarkMode:H,interviewData:d})=>{const q=new Date(new Date().setDate(new Date().getDate()-1)),[h,y]=a.useState(new Date),[M,se]=a.useState(!1),[k,te]=a.useState(!1);a.useState({}),a.useState({}),a.useState("");const[f,A]=a.useState([]),[S,T]=a.useState([]),[X,V]=a.useState(!1),[pe,Y]=a.useState(null);a.useState(1),a.useState(9),a.useState(1);const J=o.object({title:o.string().min(1,{message:"Title is required"}),date:o.preprocess(s=>new Date(s),o.date().min(q,{message:"Date should be today or later"})),timeslotId:o.string().optional(),start:o.string().min(1,{message:"Start time is required"}),end:o.string().min(1,{message:"End time is required"}),location:o.string().optional(),capacity:o.preprocess(s=>parseInt(s),o.number().min(1,{message:"Capacity should be at least 1"})),additionalInfo:o.string().optional()}),{register:j,handleSubmit:B,reset:w,formState:{errors:l}}=ne({resolver:async(s,t,r)=>{const i=await ie(J)(s,t,r);return console.log("Validation result:",i),i}}),K=o.object({start:o.string().min(1,{message:"Start time is required"}),end:o.string().min(1,{message:"End time is required"})}).refine(async s=>{const[t,r]=s.start.split(":").map(Number),[i,E]=s.end.split(":").map(Number),L=t*60+r,O=i*60+E;return f.map($=>{const[_,z]=$.start.split(":").map(Number),[be,ye]=$.end.split(":").map(Number);return{start:_*60+z,end:be*60+ye}}).every($=>{const{start:_,end:z}=$;return!(L>=_&&L<z||O>_&&O<=z)})},{message:"Time is not available",path:["start"]}).refine(async s=>{const[t,r]=s.start.split(":").map(Number),[i,E]=s.end.split(":").map(Number),L=t*60+r,O=i*60+E;return L<O},{message:"Start time should be before end time",path:["start"]});ne({resolver:async(s,t,r)=>{const i=await ie(K)(s,t,r);return console.log("Validation result:",i),i}});const F=async s=>{try{console.log(s);const t=await me(`/interview/slots?date=${s}`);if(t.status===200){const r=t.data;A(r.data);const i=r.data.filter(E=>E.isAvailable);T(i)}else alert(t.data.message)}catch(t){console.error(t),A([]),T([])}},n=async s=>{try{const t=h;console.log(t,s);const r={date:t,timeslot:{start:s.start,end:s.end}},i=await ae("/interview/slots/",r);console.log("res",i),i.status===200||i.status===201?(alert("Time slot added successfully"),F(h)):alert(i.data.message)}catch(t){console.error(t)}},x=async s=>{try{const t=await Se(`/interview/slots/${s}`);t.status===200?(alert("Time slot deleted successfully"),F(h)):alert(t.data.message)}catch(t){console.error(t)}},fe=s=>{try{const t={date:h,title:s.title,timeslotRef_id:s.timeslotId,additionalInfo:s.additionalInfo,location:s.location,capacity:s.capacity};console.log(t);const r=k?ve(`/interview/schedule/${d._id}`,t):ae("/interview/schedule",t);r.status===200&&(console.log(r.data),alert("Interview scheduled successfully"),Q())}catch(t){console.error(t)}},ge=s=>{y(new Date(s))},Q=()=>{w({applicantId:"",applicantName:"",date:new Date,start:null,end:null}),R()},Ce=()=>{V(!1)};return a.useEffect(()=>{F(new Date(h))},[h]),a.useEffect(()=>{d&&(console.log("Scheduled Interview",d),te(!0),y(new Date(d.date)),w({title:d.title,timeslotId:d.timeslot._id,start:p(d.timeslot.start),end:p(d.timeslot.end),location:d.location,additionalInfo:d.additionalInfo}))},[d]),e.jsxs(e.Fragment,{children:[e.jsxs(He,{visible:U,onClose:Q,size:"lg",children:[e.jsx(qe,{children:e.jsx(Ve,{children:k?"Edit Interview":"Schedule Interview"})}),e.jsxs(Be,{children:[e.jsx("div",{className:"mb-5",children:e.jsx(he,{onChange:ge,defaultValue:h,className:H?"calendar dark-mode":"calendar"})}),e.jsxs(xe,{onSubmit:B(fe),children:[e.jsx(c,{children:e.jsxs(m,{children:[e.jsxs(b,{className:"mb-3",children:[e.jsx(I,{children:e.jsx(u,{icon:le})}),e.jsx(g,{type:"text",placeholder:"Title",...j("title"),invalid:!!l.title})]}),l.title&&e.jsx(C,{invalid:!0,children:l.title.message})]})}),!f||f.length===0?e.jsx(c,{className:"text-danger",children:e.jsx(m,{children:e.jsx(oe,{children:"Click a Date to view its timeslot, if none.. add one."})})}):e.jsxs(e.Fragment,{children:[e.jsx(c,{children:e.jsx(m,{children:e.jsx(oe,{children:"Time Slots"})})}),e.jsx(c,{children:e.jsx(m,{className:"d-flex flex-wrap gap-2 justify-content-start",children:f.map((s,t)=>e.jsx("div",{className:"mb-3",children:e.jsxs(Oe,{color:s.isAvailable?"success":"danger",children:[p(s.start)," -"," ",p(s.end)," ",e.jsx(G,{content:s.isAvailable?"Available":"Not Available",placement:"top",children:e.jsx(u,{icon:s.isAvailable?Te:we})}),e.jsx(D,{onClick:()=>x(item._id),className:"btn",children:e.jsx(u,{icon:Ie})})]})},t))})})]}),e.jsx(c,{children:e.jsx(m,{className:"d-flex justify-content-end align-items-center",children:e.jsx(G,{content:"Add Time Slot",placement:"top",children:e.jsx(D,{onClick:()=>V(!0),className:"btn btn-success mb-3",children:e.jsx(u,{icon:ue})})})})}),e.jsxs(c,{children:[e.jsx(m,{md:4,children:e.jsxs(b,{className:"mb-3",children:[e.jsx(I,{children:"Date"}),e.jsx(g,{type:"text",...j("date"),invalid:!!l.date,value:Re(h),readOnly:!0,className:"visually-hidden"}),e.jsx(g,{type:"text",invalid:!!l.date,value:ee(h),readOnly:!0}),l.date&&e.jsx(C,{invalid:!0,children:l.date.message})]})}),e.jsx(m,{md:8,children:e.jsxs(b,{className:"mb-3",children:[e.jsx(I,{children:e.jsx(u,{icon:Ne})}),e.jsx(g,{type:"text",placeholder:"Time",readOnly:!0,...j("start"),invalid:!!l.start}),l.start&&e.jsx(C,{invalid:!0,children:l.start.message}),e.jsx(g,{type:"text",placeholder:"Time",readOnly:!0,...j("end"),invalid:!!l.end}),l.end&&e.jsx(C,{invalid:!0,children:l.end.message}),e.jsx(G,{content:"Set Time Slot",placement:"top",children:e.jsxs($e,{children:[e.jsx(_e,{color:"primary",children:"Time"}),e.jsx(ze,{children:S.map((s,t)=>e.jsxs(Ge,{onClick:()=>{Y(s),w({timeslotId:s._id,start:p(s.start),end:p(s.end)})},disabled:S.length===0,children:[p(s.start)," -"," ",p(s.end)]},t))})]})})]})})]}),e.jsx(c,{children:e.jsx(m,{children:e.jsxs(b,{className:"mb-3",children:[e.jsx(I,{children:e.jsx(u,{icon:le})}),e.jsx(g,{type:"text",placeholder:"Location",...j("location"),invalid:!!l.location}),l.location&&e.jsx(C,{invalid:!0,children:l.location.message})]})})}),e.jsx(c,{children:e.jsx(m,{children:e.jsxs(b,{className:"mb-3",children:[e.jsx(I,{children:e.jsx(u,{icon:Me})}),e.jsx(g,{type:"number",placeholder:"capacity",...j("capacity"),invalid:!!l.capacity,defaultValue:1}),l.capacity&&e.jsx(C,{invalid:!0,children:l.capacity.message})]})})}),e.jsx(c,{children:e.jsx(m,{children:e.jsxs(b,{className:"mb-3",children:[e.jsx(I,{children:e.jsx(u,{icon:ke})}),e.jsx(Ue,{type:"text",placeholder:"Additional Information",...j("additionalInfo"),invalid:!!l.additionalInfo}),l.additionalInfo&&e.jsx(C,{invalid:!0,children:l.additionalInfo.message})]})})}),e.jsx(c,{children:e.jsxs(m,{className:"d-flex justify-content-end",children:[e.jsx(Xe,{type:"checkbox",id:"invalidCheck",label:"I confirm everything is correct.",checked:M,onChange:()=>se(!M)}),e.jsx(C,{invalid:!0,children:"You must agree before submitting."})]})}),e.jsxs(Le,{children:[e.jsx(D,{type:"submit",disabled:!M,className:"btn btn-primary",children:k?"Update":"Schedule"}),e.jsx(D,{color:"secondary",onClick:Q,children:"Cancel"})]})]})]})]}),e.jsx(Pe,{isVisible:X,onClose:Ce,handleTimeSubmit:n})]})};je.propTypes={isVisible:P.bool.isRequired,onClose:P.func.isRequired,isDarkMode:P.bool.isRequired,interviewData:P.object};const Qe=({theme:U})=>{const R=U==="dark",[H,d]=a.useState(!1),[q,h]=a.useState([new Date,new Date]),[y,M]=a.useState(new Date);a.useState(new Date);const[se,k]=a.useState([]),[te,f]=a.useState(!1),[A,S]=a.useState(!1),[T,X]=a.useState(1),[V,pe]=a.useState(9),[Y,J]=a.useState(1),[j,B]=a.useState([]),[w,l]=a.useState(null),K=n=>{n.length>1?h(n):M(n)},F=a.useCallback(async n=>{f(!0);try{const x=await me(`/interview/all?date=${n}&page=${T}&limit=${V}`);if(x.status===404){B([]),f(!1);return}console.log(x.data),B(x.data.data),k(x.data.slots),J(x.data.totalPages),f(!1)}catch(x){console.error(x),f(!1)}});return a.useEffect(()=>{const n=setTimeout(()=>{F(y)},1e3);return()=>clearTimeout(n)},[y]),a.useEffect(()=>{A&&w&&S(!1)},[T]),e.jsx(e.Fragment,{children:e.jsxs(W,{className:"d-flex flex-column gap-3",children:[e.jsx(c,{children:e.jsx(W,{children:e.jsx(ce,{children:e.jsxs(de,{children:[e.jsx("div",{children:e.jsx(he,{onChange:K,selectRange:H,className:R?"calendar dark-mode":"calendar",defaultValue:H?[new Date(q[0]),new Date(q[1])]:new Date(y)})}),e.jsx("br",{}),e.jsx("div",{children:e.jsxs(b,{children:[e.jsx(g,{type:"text",placeholder:"start",value:ee(y),readOnly:!0}),e.jsx(G,{content:"Create interview",placement:"top",children:e.jsx(D,{onClick:()=>S(!0),className:"btn btn-primary",children:e.jsx(u,{icon:ue})})})]})})]})})})}),e.jsx(c,{children:e.jsx(W,{children:e.jsx(ce,{children:e.jsxs(de,{children:[e.jsx(xe,{children:e.jsxs(b,{children:[e.jsx(g,{type:"text",placeholder:"Search"}),e.jsx(D,{color:"primary",children:e.jsx(u,{icon:Ae})})]})}),e.jsxs(Ye,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[e.jsx(Je,{children:e.jsxs(Z,{children:[e.jsx(N,{children:e.jsx(u,{icon:Fe})}),e.jsx(N,{children:"Date"}),e.jsx(N,{children:"Time"}),e.jsx(N,{children:"Location"}),e.jsx(N,{children:"Capacity"}),e.jsx(N,{children:"Action"})]})}),e.jsx(Ke,{children:j.length===0?e.jsx(Z,{children:e.jsx(v,{colSpan:"5",className:"text-center",children:"No data available"})}):j.map((n,x)=>e.jsxs(Z,{children:[e.jsx(v,{children:n.title}),e.jsx(v,{children:ee(n.date)}),e.jsxs(v,{children:[p(n.timeslot.start)," -"," ",p(n.timeslot.end)]}),e.jsx(v,{children:n.location?re(n.location,20):"N/A"}),e.jsx(v,{children:n.capacity?re(n.capacity,20):"N/A"}),e.jsx(v,{children:e.jsx(D,{onClick:()=>{console.log("Interview Data:",n),l(n),S(!0)},className:"btn btn-primary",children:e.jsx(u,{icon:Ee})})})]},x))})]})]})})})}),e.jsx(c,{children:e.jsx(m,{children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(De,{currentPage:T,totalPages:Y,onPageChange:X})})})}),e.jsx(c,{children:e.jsx(je,{isVisible:A,onClose:()=>S(!1),isDarkMode:R,interviewData:w})})]})})};Qe.propTypes={theme:P.string};export{Qe as default};
