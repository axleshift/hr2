import{p as q,r as t,o as de,k as e,g as b,G as me,F as te,I as xe,E as Se,l as ve}from"./index-DrjcOHzu.js";import{A as De}from"./AppPagination-UhOljCQo.js";import{F as d,f as ae,W as we,V as Ne,N as he,R as ue,X as Te,Y as Ie,Z as Fe,E as ke,_ as Ee,K as Ae,z as Me}from"./index.es-xVlOGKl_.js";import{C as je,T as Pe}from"./TimeForm-B6zg141B.js";import{z as o,u as ne,t as le}from"./zod-BHPmFnPI.js";import{U as Q,c as f,f as P,t as re}from"./index-wJw5MR4V.js";import{C as Re,a as Ve,b as qe,c as $e}from"./CModalTitle-BHLWSaHQ.js";import{C as pe,a as C,c as S,b as ie}from"./CFormInput-03SL98tc.js";import{C as r,a as x}from"./CRow-cwBv8WMd.js";import{C as D}from"./CInputGroup-BDi0pL70.js";import{C as A}from"./CInputGroupText-D9C8fu8-.js";import{a as Be,b as _e,c as He,d as Le,e as Oe}from"./DefaultLayout-CXtOpFYs.js";import{C as w}from"./CTooltip-8Xx3ukpY.js";import{C as Ue}from"./CFormTextarea-Xv_Dscm8.js";import{C as Ge}from"./CFormCheck-Bj_szLI7.js";import{C as ze}from"./CModalFooter-B6sJXc_i.js";import{C as J}from"./CContainer-U-6RkYr-.js";import{C as ce,a as oe}from"./CCardBody-B4c-rfPr.js";import{C as Xe,a as Ye,b as H,c as M,d as Ke,e as v}from"./CTable-DKmfm88j.js";import{C as We}from"./CButtonGroup-BzGVwqQh.js";import"./clsx-B-dksMZM.js";import"./index.esm-yebAidTW.js";const fe=({isVisible:L,onClose:$,isDarkMode:T,interviewData:i})=>{const ee=new Date(new Date().setDate(new Date().getDate()-1)),{addToast:h}=t.useContext(de),[u,g]=t.useState(Q(new Date)),[R,se]=t.useState(!1),[I,O]=t.useState(!1);t.useState({}),t.useState({}),t.useState("");const[y,V]=t.useState([]),[N,F]=t.useState([]),[U,B]=t.useState(!1),[ge,G]=t.useState(null);t.useState(1),t.useState(9),t.useState(1);const z=o.object({title:o.string().min(1,{message:"Title is required"}),date:o.preprocess(s=>new Date(s),o.date().min(ee,{message:"Date should be today or later"})),timeslotId:o.string().optional(),start:o.string().min(1,{message:"Start time is required"}),end:o.string().min(1,{message:"End time is required"}),location:o.string().optional(),capacity:o.preprocess(s=>parseInt(s),o.number().min(1,{message:"Capacity should be at least 1"})),additionalInfo:o.string().optional()}),{register:p,handleSubmit:_,reset:k,formState:{errors:n}}=ne({resolver:async(s,a,j)=>{const c=await le(z)(s,a,j);return console.log("Validation result:",c),c}}),X=o.object({start:o.string().min(1,{message:"Start time is required"}),end:o.string().min(1,{message:"End time is required"})}).refine(async s=>{const[a,j]=s.start.split(":").map(Number),[c,Z]=s.end.split(":").map(Number),be=a*60+j,ye=c*60+Z;return be<ye},{message:"Start time should be before end time",path:["start"]});ne({resolver:async(s,a,j)=>{const c=await le(X)(s,a,j);return console.log("Validation result:",c),c}});const E=async s=>{try{const a=await me(`/interview/slots?date=${s}`);if(a.status===200){const j=a.data;V(j.data);const c=j.data.filter(Z=>Z.isAvailable);F(c)}else h("Error","Failed to fetch time slots","danger")}catch(a){console.error(a),V([]),F([])}},Y=async s=>{try{const a=u;console.log(a,s);const j={date:a,timeslot:{start:s.start,end:s.end}},c=await te("/interview/slots/",j);console.log("res",c),c.status===200||c.status===201?(h("Success","Time slot added successfully","success"),E(u)):h("Error",c.message.message,"danger")}catch(a){console.error(a)}},l=async s=>{try{const a=await xe(`/interview/slot/${s}`);console.log("handleDeleteTimeslot -> Result",a),a.status===200?(h("Success","Time slot deleted successfully","success"),E(u)):h("Error","Something went wrong. Unable to delete time slot.","danger")}catch(a){console.error(a)}},m=s=>{try{const a={date:u,title:s.title,timeslotRef_id:s.timeslotId,additionalInfo:s.additionalInfo,location:s.location,capacity:s.capacity};console.log(a),(I?Se(`/interview/schedule/${i._id}`,a):te("/interview/schedule",a)).status===200?(h("Success","Interview scheduled successfully","success"),W()):h("Error","Failed to schedule interview","danger")}catch(a){h("Error","Failed to schedule interview","danger"),console.error(a)}},K=s=>{g(new Date(s))},W=()=>{k({applicantId:"",applicantName:"",date:new Date,start:null,end:null}),$()},Ce=()=>{B(!1)};return t.useEffect(()=>{E(Q(u))},[u]),t.useEffect(()=>{i&&(console.log("Scheduled Interview",i),O(!0),g(new Date(i.date)),k({title:i.title,timeslotId:i.timeslot._id,start:f(i.timeslot.start),end:f(i.timeslot.end),location:i.location,additionalInfo:i.additionalInfo}))},[i]),e.jsxs(e.Fragment,{children:[e.jsxs(Re,{visible:L,onClose:W,size:"lg",children:[e.jsx(Ve,{children:e.jsx(qe,{children:I?"Edit Interview":"Schedule Interview"})}),e.jsxs($e,{children:[e.jsx("div",{className:"mb-5",children:e.jsx(je,{onChange:K,defaultValue:u,className:T?"calendar dark-mode":"calendar"})}),e.jsxs(pe,{onSubmit:_(m),children:[e.jsx(r,{children:e.jsxs(x,{children:[e.jsxs(D,{className:"mb-3",children:[e.jsx(A,{children:e.jsx(d,{icon:ae})}),e.jsx(C,{type:"text",placeholder:"Title",...p("title"),invalid:!!n.title})]}),n.title&&e.jsx(S,{invalid:!0,children:n.title.message})]})}),!y||y.length===0?e.jsx(r,{className:"text-danger",children:e.jsx(x,{children:e.jsx(ie,{children:"Click a Date to view its timeslot, if none.. add one."})})}):e.jsxs(e.Fragment,{children:[e.jsx(r,{children:e.jsx(x,{children:e.jsx(ie,{children:"Time Slots"})})}),e.jsx(r,{children:e.jsx(x,{className:"d-flex flex-wrap gap-2 justify-content-start",children:y.map((s,a)=>e.jsx("div",{className:"mb-3",children:e.jsxs(Be,{color:s.isAvailable?"success":"danger",children:[f(s.start)," -"," ",f(s.end)," ",e.jsx(w,{content:s.isAvailable?"Available":"Not Available",placement:"top",children:e.jsx(d,{icon:s.isAvailable?we:Ne})}),e.jsx(w,{content:"Delete Time Slot",placement:"top",children:e.jsx(b,{onClick:()=>l(s._id),className:"btn",children:e.jsx(d,{icon:he})})})]})},a))})})]}),e.jsx(r,{children:e.jsx(x,{className:"d-flex justify-content-end align-items-center",children:e.jsx(w,{content:"Add Time Slot",placement:"top",children:e.jsx(b,{onClick:()=>B(!0),className:"btn btn-success mb-3",children:e.jsx(d,{icon:ue})})})})}),e.jsxs(r,{children:[e.jsx(x,{md:4,children:e.jsxs(D,{className:"mb-3",children:[e.jsx(A,{children:"Date"}),e.jsx(C,{type:"text",...p("date"),invalid:!!n.date,value:P(u),readOnly:!0,className:"visually-hidden"}),e.jsx(C,{type:"text",invalid:!!n.date,value:P(u),readOnly:!0}),n.date&&e.jsx(S,{invalid:!0,children:n.date.message})]})}),e.jsx(x,{md:8,children:e.jsxs(D,{className:"mb-3",children:[e.jsx(A,{children:e.jsx(d,{icon:Te})}),e.jsx(C,{type:"text",placeholder:"Time",readOnly:!0,...p("start"),invalid:!!n.start}),n.start&&e.jsx(S,{invalid:!0,children:n.start.message}),e.jsx(C,{type:"text",placeholder:"Time",readOnly:!0,...p("end"),invalid:!!n.end}),n.end&&e.jsx(S,{invalid:!0,children:n.end.message}),e.jsx(w,{content:"Set Time Slot",placement:"top",children:e.jsxs(_e,{children:[e.jsx(He,{color:"primary",children:"Time"}),e.jsx(Le,{children:N.map((s,a)=>e.jsxs(Oe,{onClick:()=>{G(s),k({timeslotId:s._id,start:f(s.start),end:f(s.end)})},disabled:N.length===0,children:[f(s.start)," -"," ",f(s.end)]},a))})]})})]})})]}),e.jsx(r,{children:e.jsx(x,{children:e.jsxs(D,{className:"mb-3",children:[e.jsx(A,{children:e.jsx(d,{icon:ae})}),e.jsx(C,{type:"text",placeholder:"Location",...p("location"),invalid:!!n.location}),n.location&&e.jsx(S,{invalid:!0,children:n.location.message})]})})}),e.jsx(r,{children:e.jsx(x,{children:e.jsxs(D,{className:"mb-3",children:[e.jsx(A,{children:e.jsx(d,{icon:Ie})}),e.jsx(C,{type:"number",placeholder:"capacity",...p("capacity"),invalid:!!n.capacity,defaultValue:1}),n.capacity&&e.jsx(S,{invalid:!0,children:n.capacity.message})]})})}),e.jsx(r,{children:e.jsx(x,{children:e.jsxs(D,{className:"mb-3",children:[e.jsx(A,{children:e.jsx(d,{icon:Fe})}),e.jsx(Ue,{type:"text",placeholder:"Additional Information",...p("additionalInfo"),invalid:!!n.additionalInfo}),n.additionalInfo&&e.jsx(S,{invalid:!0,children:n.additionalInfo.message})]})})}),e.jsx(r,{children:e.jsxs(x,{className:"d-flex justify-content-end",children:[e.jsx(Ge,{type:"checkbox",id:"invalidCheck",label:"I confirm everything is correct.",checked:R,onChange:()=>se(!R)}),e.jsx(S,{invalid:!0,children:"You must agree before submitting."})]})}),e.jsxs(ze,{children:[e.jsx(b,{type:"submit",disabled:!R,className:"btn btn-primary",children:I?"Update":"Schedule"}),e.jsx(b,{color:"secondary",onClick:W,children:"Cancel"})]})]})]})]}),e.jsx(Pe,{isVisible:U,onClose:Ce,handleTimeSubmit:Y})]})};fe.propTypes={isVisible:q.bool.isRequired,onClose:q.func.isRequired,isDarkMode:q.bool.isRequired,interviewData:q.object};const Ze=({theme:L})=>{const $=L==="dark",{addToast:T}=t.useContext(de),[i,ee]=t.useState(!1),[h,u]=t.useState([new Date,new Date]),[g,R]=t.useState(Q(new Date));t.useState(new Date);const[se,I]=t.useState([]),[O,y]=t.useState(!1),[V,N]=t.useState(!1),[F,U]=t.useState(1),[B,ge]=t.useState(9),[G,z]=t.useState(1),[p,_]=t.useState([]),[k,n]=t.useState(null),X=l=>{l.length>1?u(l):R(l)},E=t.useCallback(async l=>{y(!0);try{const m=await me(`/interview/all?date=${l}&page=${F}&limit=${B}`);m.status===200?(_(m.data.data),I(m.data.slots),z(m.data.totalPages),y(!1)):(y(!1),_([]),I([]))}catch(m){const K=`Failed to fetch interview schedules for ${P(l)}`;T("Error",K,"error"),console.error(m),y(!1)}}),Y=async l=>{try{(await xe(`/interview/schedule/${l}`)).status===200?(T("Success","Successfully deleted interview schedule","success"),E(g)):T("Error","Failed to delete interview schedule","error")}catch(m){console.error(m),T("Error","Failed to delete interview schedule","error")}};return t.useEffect(()=>{const l=setTimeout(()=>{E(g)},1e3);return()=>clearTimeout(l)},[g]),t.useEffect(()=>{V&&k&&N(!1)},[F]),e.jsx(e.Fragment,{children:e.jsxs(J,{className:"d-flex flex-column gap-3",children:[e.jsx(r,{children:e.jsxs(x,{children:[e.jsx("h2",{children:"Schedules"}),e.jsx("small",{children:"In this page, you can create and edit schedules for interviews, task, or any other events."})]})}),e.jsx(r,{children:e.jsx(J,{children:e.jsx(ce,{children:e.jsxs(oe,{children:[e.jsx("div",{children:e.jsx(je,{onChange:X,selectRange:i,className:$?"calendar dark-mode":"calendar",defaultValue:i?[new Date(h[0]),new Date(h[1])]:new Date(g)})}),e.jsx("br",{}),e.jsx("div",{children:e.jsxs(D,{children:[e.jsx(C,{type:"text",placeholder:"start",value:P(g),readOnly:!0}),e.jsx(w,{content:"Create interview",placement:"top",children:e.jsx(b,{onClick:()=>N(!0),className:"btn btn-primary",children:e.jsx(d,{icon:ue})})})]})})]})})})}),e.jsx(r,{children:e.jsx(J,{children:e.jsx(ce,{children:e.jsxs(oe,{children:[e.jsx(pe,{children:e.jsxs(D,{children:[e.jsx(C,{type:"text",placeholder:"Search"}),e.jsx(b,{color:"primary",children:e.jsx(d,{icon:ke})})]})}),e.jsxs(Xe,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[e.jsx(Ye,{children:e.jsxs(H,{children:[e.jsx(M,{className:"text-center",children:e.jsx(d,{icon:Ee})}),e.jsx(M,{className:"text-center",children:"Date"}),e.jsx(M,{className:"text-center",children:"Time"}),e.jsx(M,{className:"text-center",children:"Location"}),e.jsx(M,{className:"text-center",children:"Capacity"}),e.jsx(M,{className:"text-center",children:"Action"})]})}),e.jsx(Ke,{children:O?e.jsx(H,{children:e.jsx(v,{colSpan:"6",className:"text-center",children:e.jsx(ve,{color:"primary",variant:"grow"})})}):p.length===0?e.jsx(H,{children:e.jsxs(v,{colSpan:"6",className:"text-center",children:["No data available for"," ",e.jsx("span",{className:"text-info",children:P(g)})]})}):p.map((l,m)=>e.jsxs(H,{children:[e.jsx(v,{className:"text-center",children:l.title}),e.jsx(v,{className:"text-center",children:P(l.date)}),e.jsxs(v,{className:"text-center",children:[f(l.timeslot.start)," -"," ",f(l.timeslot.end)]}),e.jsx(v,{className:"text-center",children:l.location?re(l.location,20):"N/A"}),e.jsx(v,{className:"text-center",children:l.capacity?re(l.capacity,20):"N/A"}),e.jsx(v,{className:"text-center",children:e.jsxs(We,{children:[e.jsxs(b,{onClick:()=>{console.log("Interview Data:",l),n(l),N(!0)},className:"btn btn-primary",children:[e.jsx(w,{content:"Edit",placement:"top",children:e.jsx(d,{icon:Ae})})," "]}),e.jsxs(b,{onClick:()=>Y(l._id),className:"btn btn-danger",children:[e.jsx(w,{content:"Delete",placement:"top",children:e.jsx(d,{icon:he})})," "]}),e.jsx(b,{className:"btn btn-warning",children:e.jsx(w,{content:"Cancel",placement:"top",children:e.jsx(d,{icon:Me})})})]})})]},m))})]})]})})})}),e.jsx(r,{children:e.jsx(x,{children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(De,{currentPage:F,totalPages:G,onPageChange:U})})})}),e.jsx(r,{children:e.jsx(fe,{isVisible:V,onClose:()=>N(!1),isDarkMode:$,interviewData:k})})]})})};Ze.propTypes={theme:q.string};export{Ze as default};
