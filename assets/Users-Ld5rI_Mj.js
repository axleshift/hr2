import{R as e}from"./react-router-dom-BnDDw25P.js";import{F as r,A as s,B as a,T as i,Z as t}from"./index.es-DOS6LnW0.js";import{f as l,t as n}from"./index-BVfmz2P_.js";import{A as c}from"./AppPagination-DHwVwpgj.js";import{m as d,a as o,F as m,j as h,g as u,k as p,w as f,x as y,v as g}from"./index-CDLNWkH1.js";import{z as b}from"./zod-B0zZW6rS.js";import{u as N}from"./react-hook-form-DGCwHb0C.js";import{s as C}from"./@hookform/resolvers/zod-B5rlnuQ9.js";import{C as v}from"./CContainer-C8s0HPSv.js";import{C as j,a as S}from"./CRow-Dv7ylWmi.js";import{C as x,b as A}from"./CFormLabel-CMB5m-Mb.js";import{C as w}from"./CInputGroup-C27gicSC.js";import{C as V}from"./CFormInput-Cpt_AbLV.js";import{C as U,a as _}from"./CCardBody-BPxuaxuA.js";import{C as Y,a as E,b as k,c as M,d as D,e as P}from"./CTable-DT2N_H1o.js";import{C as F}from"./CButtonGroup-BamaSsju.js";import{C as I}from"./CTooltip-SIOmR3yQ.js";import{C as R,a as T,b as z}from"./CModalHeader-BPWZasYS.js";import{C as L}from"./CInputGroupText-DDvQEynS.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";import"./isRTL-D5ORmfro.js";import"./DefaultLayout-Bslh-jLE.js";import"./index.esm-JfIxWHlD.js";const $=()=>{const{addToast:$}=e.useContext(d),[G,O]=e.useState([]),[B,q]=e.useState(null),[H,J]=e.useState(!1),[Q,Z]=e.useState([]),[K,W]=e.useState(!1),[X,ee]=e.useState(!1),[re,se]=e.useState(!1),[ae,ie]=e.useState(!1),[te,le]=e.useState(""),[ne,ce]=e.useState(!1),[de,oe]=e.useState(!1),[me,he]=e.useState(!1),[ue,pe]=e.useState(!1),[fe,ye]=e.useState(1),[ge,be]=e.useState(9),[Ne,Ce]=e.useState(0),[ve,je]=e.useState(0),Se=b.object({_id:b.string().optional(),firstname:b.string().min(3,{message:"Firstname must be at least 3 characters"}),lastname:b.string().min(3,{message:"Lastname must be at least 3 characters"}),email:b.string().email("Invalid email address"),username:b.string().min(3,{message:"Username must be at least 3 characters"}),password:b.string().min(8,{message:"Password must be at least 8 characters"}),role:b.string().min(3,{message:"Role must be at least 3 characters"}),status:b.string().optional(),emailVerifiedAt:b.string().optional().transform((e=>{if(e)return"not verified";const r=new Date(e);return l(r,"MMM DD, YYYY")}))}),{register:xe,reset:Ae,handleSubmit:we,formState:{errors:Ve}}=N({resolver:C(Se)}),Ue=async(e="",r,s)=>{try{const e=await f(`/account/all?page=${r}&limit=${s}`);200===e.status?(O(e.data.data),Z((()=>{const r={};return e.data.data.forEach((e=>{r[e._id]=!1})),r})),je(e.data.totalItems),Ce(e.data.totalPages),ye(e.data.currentPage),J(!1)):$("Accounts | Users",e.message.message,"danger")}catch(a){$("Error","An error occurred","error")}};return e.useEffect((()=>{Ue("",fe,ge)}),[fe,ge]),o(m,{children:h(v,{children:[o(j,{className:"mb-3",children:h(S,{children:[o("h2",{children:"Users"}),o("small",{children:"In this page, you can view all the users in the system. You can also add, edit users, and as well as verify their accounts."})]})}),o(j,{className:"mb-3",children:o(S,{children:o("div",{className:"d-flex justify-content-end",children:o(u,{color:"primary",onClick:()=>{Ae({_id:"",firstname:"",lastname:"",email:"",username:"",password:"",role:"",status:"inactive",emailVerifiedAt:null}),q(null),ie(!1),W(!0)},children:"Create"})})})}),o(j,{className:"mb-3",children:o(S,{children:o(x,{children:h(w,{children:[o(V,{type:"search",placeholder:"Search...","aria-label":"Search"}),o(u,{type:"button",color:"primary",children:o(r,{icon:s})}),o(u,{type:"button",color:"primary",children:o(r,{icon:a,onClick:Ue})})]})})})}),o(j,{className:"mb-3",children:o(S,{children:o(U,{children:o(_,{children:h(Y,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[o(E,{children:h(k,{children:[o(M,{children:"#"}),o(M,{children:"Firstname"}),o(M,{children:"Lastname"}),o(M,{children:"Email"}),o(M,{children:"Username"}),o(M,{children:"Role"}),o(M,{children:"Verified"}),o(M,{children:"View"})]})}),o(D,{children:H?o(k,{children:o(P,{colSpan:"8",className:"text-center",children:o(p,{})})}):0===G.length?o(k,{children:o(P,{colSpan:"8",className:"text-center",children:"No users found."})}):G.map(((e,r)=>h(k,{children:[o(P,{children:n(e._id,10)}),o(P,{children:n(e.firstname,25)}),o(P,{children:n(e.lastname,25)}),o(P,{children:e.email}),o(P,{children:e.username}),o(P,{children:e.role}),o(P,{children:e.emailVerifiedAt?l(e.emailVerifiedAt,"MMM DD, YYYY"):o("span",{className:"text-danger",children:"Not verified"})}),o(P,{children:o(F,{children:o(I,{content:"View",children:o(u,{color:"info",size:"sm",onClick:()=>{(async e=>{Z((r=>({...r,[e._id]:!0})));try{const r=await f(`/account/${e._id}`);200===r.status?(q(r.data.data),Ae({...r.data.data,password:""}),ie(!0),W(!0),$("Success","User fetched successfully","success"),Z((r=>({...r,[e._id]:!1})))):($("Error","An error occurred","error"),Z((r=>({...r,[e._id]:!1}))))}catch(r){$("Error","An error occurred","error"),Z((r=>({...r,[e._id]:!1})))}})(e)},disabled:Q[e._id],children:Q[e._id]?o(p,{color:"white",size:"sm"}):"View"})})})})]},e._id)))})]})})})})}),!H&&o(j,{children:o(S,{className:"d-flex justify-content-center",children:o(c,{currentPage:fe,totalPages:Ne,onPageChange:e=>ye(e)})})}),o(j,{children:o(S,{children:h(R,{visible:K,backdrop:"static",onClose:()=>{W(!1),he(!1)},size:"lg",children:[o(T,{children:h("strong",{children:[ae?"Edit":"Create"," User"]})}),o(z,{children:h(x,{onSubmit:we((async e=>{try{const r=ae?await y(`/account/${e._id}`,e):await g("/account",e);200===r.status||201===r.status?($("Success",ae?"User updated successfully":"User created successfully","success"),W(!1)):$("Error",r.message.message,"error")}catch(r){$("Error","An error occurred"," error")}})),children:[o(j,{className:"mb-3 visually-hidden",children:h(S,{children:[o(A,{children:"Id"}),o(V,{type:"text",...xe("_id"),readOnly:!0})]})}),h(j,{className:"mb-3",xs:{cols:1,gutter:2},md:{cols:2,gutter:2},children:[h(S,{children:[o(A,{children:"Firstname"}),o(V,{type:"text",...xe("firstname")})]}),h(S,{children:[o(A,{children:"Lastname"}),o(V,{type:"text",...xe("lastname")})]})]}),h(j,{className:"mb-3",xs:{cols:1,gutter:2},md:{cols:3,gutter:2},children:[h(S,{children:[o(A,{children:"Email"}),o(V,{type:"email",...xe("email")})]}),h(S,{children:[o(A,{children:"Username"}),o(V,{type:"text",...xe("username")})]}),h(S,{children:[o(A,{children:"Password"}),o(w,{children:o(V,{type:"text",...xe("password")})})]})]}),ae&&h(j,{className:"mb-3",children:[h(S,{children:[o(A,{children:"Role"}),o(V,{type:"text",...xe("role")})]}),h(S,{children:[o(A,{children:"Account Status"}),o("br",{}),o(V,{type:"text",...xe("status"),readOnly:!0})]}),h(S,{children:[o(A,{children:"Email Verified At"}),h(w,{children:[o(V,{type:"text",defaultValue:(null==B?void 0:B.emailVerifiedAt)?l(null==B?void 0:B.emailVerifiedAt,"MMM DD, YYYY"):"Not verified",readOnly:!0}),o(L,{children:(null==B?void 0:B.emailVerifiedAt)?o(r,{icon:i,color:"green"}):o(I,{content:"Verify?",children:o(r,{icon:t,color:"red"})})})]})]})]}),o(j,{className:"mb-3",children:o(S,{children:o("div",{className:"d-flex justify-content-end",children:ae?h(m,{children:[o(u,{type:"submit",color:"primary",className:"me-2",children:"Update"}),"active"===(null==B?void 0:B.status)?o(u,{color:"danger",className:"me-2",onClick:()=>{ee(!0),W(!1)},children:"Suspend"}):o(u,{color:"success",className:"me-2",onClick:()=>{se(!0),W(!1)},disabled:!(null==B?void 0:B.emailVerifiedAt),children:"Activate"})]}):o(u,{type:"submit",color:"primary",className:"me-2",children:ne?o(p,{color:"white",size:"sm"}):"Add"})})})}),!(null==B?void 0:B.emailVerifiedAt)&&o(j,{className:"mb-3",children:h(S,{children:[o("div",{className:"d-flex justify-content-end",children:o(u,{color:"success",className:"me-2",onClick:()=>{oe(!0),setTimeout((()=>{he(!0),oe(!1)}),2e3)},disabled:me||de,children:de?o(p,{color:"white",size:"sm"}):me?h("span",{children:["Verification Sent",o(r,{icon:i,className:"ms-2"})]}):"Send Verification"})}),!(null==B?void 0:B.emailVerifiedAt)&&o("div",{className:"d-flex justify-content-end mt-3",children:h("small",{children:[o("span",{className:"text-danger",children:"Note"}),": User cannot be activated until email is verified."]})})]})})]})})]})})}),o(j,{children:o(S,{children:h(R,{visible:X,backdrop:"static",onClose:()=>{ee(!1),W(!0)},children:[o(T,{children:o("strong",{children:"Suspend / Deactivate User"})}),o(z,{children:h(x,{children:[o(j,{className:"mb-3",children:h(S,{children:[o(A,{children:"Reason (required)"}),o(V,{type:"text"})]})}),o(j,{className:"mb-3",children:o(S,{children:o("div",{className:"d-flex justify-content-end",children:o(u,{color:"primary",className:"me-2",children:"Suspend"})})})})]})})]})})}),o(j,{children:o(S,{children:h(R,{visible:re,onClose:()=>{se(!1),W(!0)},children:[o(T,{children:o("strong",{children:"Activate User"})}),o(z,{children:h(x,{children:[o(j,{className:"mb-3",children:h(S,{children:[o(A,{children:"Reason (required)"}),o(V,{type:"text"})]})}),o(j,{className:"mb-3",children:o(S,{children:o("div",{className:"d-flex justify-content-end",children:o(u,{color:"primary",className:"me-2",children:"Activate"})})})})]})})]})})})]})})};export{$ as default};
