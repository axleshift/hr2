import{r as e}from"./react-router-dom-BnDDw25P.js";import{_ as a,j as i,a as t,c as n,b as r,p as s,m as l,A as c,l as o,g as d,k as m,x as p,y as u,w as h,F as v,z as f}from"./index-qHb5tAdx.js";import{z as b}from"./zod-B0zZW6rS.js";import{u as y,b as g}from"./react-hook-form-DB8hWBdy.js";import{s as w}from"./@hookform/resolvers/zod-1wp20Skh.js";import{f as x,b as C}from"./index-BOi-5bX2.js";import{A as N}from"./AppPagination-B2VO-T6n.js";import{C as S,a as j,b as E}from"./CModalHeader-beeSvsCt.js";import{C as k}from"./CModalTitle-IUT3VrW5.js";import{C as A,a as I,b as F,c as q}from"./CTabList-CiKyPkfH.js";import{b as T}from"./DefaultLayout-CPc9-BYb.js";import{b as $,C as z,a as R}from"./CFormLabel-UDpH3Qx3.js";import{C as P,a as _}from"./CRow-DYavEpjv.js";import{C as D}from"./CFormInput-DF5LQCIp.js";import{C as M}from"./CFormSelect-4-wAhThw.js";import{C as V}from"./CFormRange-Dw3bxmhy.js";import{C as O}from"./CFormTextarea-DP8Q6-6q.js";import{C as L}from"./CContainer-B1Ovw4vN.js";import{C as K,a as Y}from"./CCardBody-gL1p66qB.js";import{C as H,a as J,c as B,d as Q,b as U,e as W}from"./CTable-JBToS8d6.js";import"./ConfirmationDialog-CxEMdj2-.js";import{C as Z}from"./CCardHeader-CtHSwThG.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";import"./index.es-DYre-5ez.js";import"./CTooltip-CljDTM0A.js";import"./isRTL-D5ORmfro.js";import"./index.esm-GVz-2sp-.js";var G=e.forwardRef((function(e,s){var l,c=e.className,o=e.id,d=e.invalid,m=e.label,p=e.reverse,u=e.size,h=e.type,v=void 0===h?"checkbox":h,f=e.valid,b=a(e,["className","id","invalid","label","reverse","size","type","valid"]);return i("div",{className:n("form-check form-switch",(l={"form-check-reverse":p},l["form-switch-".concat(u)]=u,l["is-invalid"]=d,l["is-valid"]=f,l),c),children:[t("input",{...r({type:v,className:n("form-check-input",{"is-invalid":d,"is-valid":f}),id:o},b,{ref:s})}),m&&t($,{...r({customClassName:"form-check-label"},o&&{htmlFor:o}),children:m})]})}));G.propTypes={className:s.string,id:s.string,invalid:s.bool,label:s.oneOfType([s.string,s.node]),reverse:s.bool,size:s.oneOf(["lg","xl"]),type:s.oneOf(["checkbox","radio"]),valid:s.bool},G.displayName="CFormSwitch";const X=b.object({date:b.string().nonempty("Date is required"),job:b.string().min(1,{message:"Job is required"}),type:b.enum(["Phone","Video","In-Person"]),interviewType:b.string().optional(),general:b.object({communication:b.coerce.number().min(1).max(5).default(1),technical:b.coerce.number().min(1).max(5).default(1),problemSolving:b.coerce.number().min(1).max(5).default(1),culturalFit:b.coerce.number().min(1).max(5).default(1),workExperienceRelevance:b.coerce.number().min(1).max(5).default(1),leadership:b.coerce.number().min(1).max(5).default(1)}),questions:b.array(b.object({question:b.string().min(1,{message:"A question is required."}),remark:b.string().optional()})).optional(),salaryExpectation:b.coerce.number().min(1).default(1),strength:b.string().optional(),weakness:b.string().optional(),recommendation:b.enum(["yes","no","need further review"]),finalComments:b.string().optional()}),ee=({isVisible:a,onClose:n,state:r,eventData:s,applicantData:v})=>{const{addToast:f}=e.useContext(l),{userInformation:b}=e.useContext(c),[C,$]=e.useState([]),[Z,G]=e.useState([]),[ee,ae]=e.useState(!1),[ie,te]=e.useState(""),[ne,re]=e.useState("view"),[se,le]=e.useState(1),[ce,oe]=e.useState(9),[de,me]=e.useState(0),[pe,ue]=e.useState(0),{control:he,register:ve,handleSubmit:fe,reset:be,setValue:ye,watch:ge,formState:{errors:we}}=y({resolver:async(e,a,i)=>await w(X)(e,a,i)}),{fields:xe,append:Ce,remove:Ne}=g({control:he,name:"questions"});return e.useEffect((()=>{a&&s&&setTimeout((()=>{be({date:(null==s?void 0:s.date)?s.date.split("T")[0]:"",general:{communication:1,technical:1,problemSolving:1,culturalFit:1,workExperienceRelevance:1,leadership:1}})}),100)}),[a,s,be]),e.useEffect((()=>{a&&(re(r),(async()=>{try{ae(!0);const e=ie?await p(`/applicant/interview/all/${v._id}?query=${ie}&page=${se}&limit=${ce}&sort=desc`):await p(`/applicant/interview/all/${v._id}?page=${se}&limit=${ce}&sort=desc`);200===e.status?($(e.data.data),ue(e.data.totalItems),me(e.data.totalPages),le(e.data.currentPage)):($([]),ue(0),me(0),le(1)),ae(!1)}catch(e){ae(!1)}})())}),[a,r]),i(S,{visible:a,onClose:()=>{n(),be({applicant:"",job:"",date:"",type:"Phone",interviewType:"initialInterview",general:{communication:1,technical:1,problemSolving:1,culturalFit:1,workExperienceRelevance:1,leadership:1},salaryExpectation:1,strength:"",weakness:"",recommendation:"yes",finalComments:""})},size:"xl",children:[t(j,{children:t(k,{children:"edit"===ne?"Edit Interview":"Interview Form"})}),t(E,{children:i(A,{activeItemKey:"form",children:[i(I,{variant:"tabs",children:[t(F,{itemKey:"form",children:"Form"}),t(F,{itemKey:"history",children:"History"})]}),i(T,{children:[t(q,{itemKey:"form",children:i(z,{onSubmit:fe((async e=>{try{const a={date:e.date,job:e.job,type:e.type,interviewType:s.type,general:{communication:e.general.communication,technical:e.general.technical,problemSolving:e.general.problemSolving,culturalFit:e.general.culturalFit,workExperienceRelevance:e.general.workExperienceRelevance,leadership:e.general.leadership},questions:e.questions||[],salaryExpectation:e.salaryExpectation,strength:e.strength,weakness:e.weakness,recommendation:e.recommendation,finalComments:e.finalComments},i="edit"===ne?await u(`/applicant/interview/${Z._id}`,a):await h(`/applicant/interview/${v._id}/${s._id}`,a);200!==i.status&&201!==i.status||(f("Success","Interview saved successfully","success"),be(),n())}catch(a){f("Error","An error occurred","danger")}})),className:"mt-3",children:["development"===o.env,v&&i(P,{className:"mb-3",children:[t(_,{children:t(D,{label:"Firstname",value:v.firstname,readOnly:!0})}),t(_,{children:t(D,{label:"Lastname",value:v.lastname,readOnly:!0})})]}),t(P,{className:"mb-3",children:i(_,{children:[t(D,{type:"date",label:"Date",...ve("date"),invalid:!!we.date,readOnly:!0}),we.date&&t(R,{invalid:!0,children:we.date.message})]})}),i(P,{className:"mb-3",children:[i(_,{children:[i(M,{label:"Interview Type",...ve("type"),invalid:!!we.type,children:[t("option",{value:"Phone",children:"Phone"}),t("option",{value:"Video",children:"Video"}),t("option",{value:"In-Person",children:"In-Person"})]}),we.type&&t(R,{invalid:!0,children:we.type.message})]}),t(_,{children:t(D,{label:"Event Type",value:s.type,readOnly:!0})})]}),t("h5",{children:"General Ratings"}),["communication","technical","problemSolving","culturalFit","workExperienceRelevance","leadership"].map((e=>{var a,n;return t(P,{className:"mb-3",children:i(_,{children:[i("label",{children:[e.replace(/([A-Z])/g," $1").trim()," (",ge(`general.${e}`),")"]}),t(V,{min:1,max:5,step:1,default:1,...ve(`general.${e}`,{valueAsNumber:!0}),invalid:!!(null==(a=we.general)?void 0:a[e])}),(null==(n=we.general)?void 0:n[e])&&t(R,{invalid:!0,children:we.general[e].message})]})},e)})),t(P,{children:t(_,{className:"d-flex justify-content-end",children:t(d,{type:"button",color:"info",size:"sm",onClick:()=>Ce({question:"",remark:""}),children:"Add Question"})})}),t(P,{children:t(_,{children:xe.map(((e,a)=>{var n,r,s,l;return t(P,{className:"mb-3",children:i(_,{children:[t(P,{className:"mb-3",children:i(_,{children:[t(D,{label:`Question ${a+1}`,autoComplete:"question",...ve(`questions.${a}.question`),invalid:!!(null==(r=null==(n=we.questions)?void 0:n[a])?void 0:r.question)}),(null==(l=null==(s=we.questions)?void 0:s[a])?void 0:l.question)&&t(R,{invalid:!0,children:we.questions[a].question.message})]})}),t(P,{className:"mb-2",children:t(_,{children:t(O,{label:"Remarks",autoComplete:"remark",...ve(`questions.${a}.remark`)})})}),t(P,{className:"mb-2",children:t(_,{children:t(_,{children:t("div",{className:"d-flex justify-content-end",children:t(d,{type:"button",color:"danger",size:"sm",onClick:()=>Ne(a),children:"Remove"})})})})})]})},e.id)}))})}),i(P,{className:"mb-3",children:[i(_,{children:[t(D,{label:"Job / Position Applied For",...ve("job"),invalid:!!we.job}),we.job&&t(R,{invalid:!0,children:we.job.message})]}),i(_,{children:[t(D,{type:"number",label:"Salary Expectations",...ve("salaryExpectation",{valueAsNumber:!0}),invalid:!!we.salaryExpectation}),we.salaryExpectation&&t(R,{invalid:!0,children:we.salaryExpectation.message})]})]}),t(P,{className:"mb-3",children:i(_,{children:[i(M,{label:"Recommendation",...ve("recommendation"),invalid:!!we.recommendation,children:[t("option",{value:"yes",children:"Yes"}),t("option",{value:"no",children:"No"}),t("option",{value:"need further review",children:"Need Further Review"})]}),we.recommendation&&t(R,{invalid:!0,children:we.recommendation.message})]})}),t(P,{className:"mb-3",children:t(_,{children:t(O,{label:"Strength",...ve("strength")})})}),t(P,{className:"mb-3",children:t(_,{children:t(O,{label:"Weakness",...ve("weakness")})})}),t(P,{className:"mb-3",children:t(_,{children:t(O,{label:"Final Comments",...ve("finalComments")})})}),t(P,{children:t(_,{className:"d-flex justify-content-end",children:["admin","interviewer","manager"].includes(b.role)?t(d,{type:"submit",color:"primary",size:"sm",children:"edit"===ne?"Update":"Create"}):t(d,{color:"danger",size:"sm",disabled:!0,children:"No Permission"})})})]})}),t(q,{itemKey:"history",children:i(L,{className:"mt-3",children:[t(P,{className:"mb-3",children:t(_,{children:t(K,{children:t(Y,{children:i(H,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[i(J,{children:[t(B,{children:"Interviewer"}),t(B,{children:"Type"}),t(B,{children:"Event Type"}),t(B,{children:"Job"}),t(B,{children:"Recommendation"}),t(B,{children:"Created"}),t(B,{children:"Actions"})]}),t(Q,{children:ee?t(U,{children:t(W,{colSpan:"12",children:t("div",{className:"pt-3 text-center",children:t(m,{color:"primary",variant:"grow"})})})}):0===C.length?t(U,{children:t(W,{colSpan:"12",children:t("div",{className:"text-center",children:"No Interviews History Found"})})}):C.map((e=>{var a;return i(U,{children:[t(W,{children:i("div",{children:[e.interviewer.lastname,", ",e.interviewer.firstname]})}),t(W,{children:e.type}),t(W,{children:null==(a=null==e?void 0:e.event)?void 0:a.type}),t(W,{children:null==e?void 0:e.job}),t(W,{className:"text-capitalize",children:e.recommendation}),t(W,{children:x(e.date,"MMM DD YYYY h:mm A")}),t(W,{children:t(d,{color:"primary",size:"sm",onClick:()=>{(e=>{var a,i,t,n,r,l,c;re("edit"),be({date:e.date?e.date.split("T")[0]:"",job:e.job?e.job:"",type:e.type||"Phone",interviewType:null==s?void 0:s.type,general:{communication:(null==(a=e.general)?void 0:a.communication)||1,technical:(null==(i=e.general)?void 0:i.technical)||1,problemSolving:(null==(t=e.general)?void 0:t.problemSolving)||1,culturalFit:(null==(n=e.general)?void 0:n.culturalFit)||1,workExperienceRelevance:(null==(r=e.general)?void 0:r.workExperienceRelevance)||1,leadership:(null==(l=e.general)?void 0:l.leadership)||1},questions:(null==(c=e.questions)?void 0:c.length)?e.questions:[{question:"",remark:""}],salaryExpectation:e.salaryExpectation||1,strength:e.strength||"",weakness:e.weakness||"",recommendation:e.recommendation||"yes",finalComments:e.finalComments||""}),f("Success","Interview fetched. Please change to forms tab.","success")})(e),G(e)},children:"View"})})]},e._id)}))})]})})})})}),t(P,{children:t(_,{children:t("div",{className:"d-flex flex-row gap-2 justify-content-center align-items-center",children:t(N,{currentPage:se,totalPages:de,onPageChange:le})})})})]})})]})]})})]})};ee.propTypes={isVisible:s.bool.isRequired,onClose:s.func.isRequired,state:s.string,eventData:s.object,applicantData:s.object};const ae=["Initial Interview","Final Interview","Technical Interview","Panel Interview","Behavioral Interview","Orientation","Other"],ie=b.object({name:b.string().min(3).max(50),description:b.string().optional(),capacity:b.number().int().positive(),type:b.enum(ae,{errorMap:()=>({message:"Invalid Event Type"})}),isApproved:b.union([b.boolean(),b.object({status:b.boolean()})]).transform((e=>"boolean"==typeof e?e:e.status)).default(!1)}),te=({isVisible:a,onClose:n,slot:r,state:s})=>{var b,g,x;const{addToast:N}=e.useContext(l),{userInformation:A}=e.useContext(c),[I,F]=e.useState({}),[q,T]=e.useState(!1),[V,X]=e.useState(!1),[te,ne]=e.useState("view"),[re,se]=e.useState(!0),[le,ce]=e.useState(!1),[oe,de]=e.useState(!1),[me,pe]=e.useState(!1),[ue,he]=e.useState([]),[ve,fe]=e.useState(!1),[be,ye]=e.useState(!1),[ge,we]=e.useState("view"),[xe,Ce]=e.useState({}),[Ne,Se]=e.useState({}),[je,Ee]=e.useState([]),[ke,Ae]=e.useState(!1),[Ie,Fe]=e.useState(""),[qe,Te]=e.useState(1),[$e,ze]=e.useState(9),[Re,Pe]=e.useState(0),[_e,De]=e.useState(0),Me=async()=>{var e;try{X(!0);const a=await p(`/facilities/event/${r.event}`);if(200===a.status)return F(a.data.data),Ye({...a.data.data,isApproved:null==(e=a.data.data.isApproved)?void 0:e.status}),X(!1),N("Success","Event Fetched","success")}catch(a){N("error","failed to load event data","danger")}},{register:Ve,control:Oe,watch:Le,handleSubmit:Ke,reset:Ye,formState:{errors:He},setValue:Je}=y({resolver:async(e,a,i)=>await w(ie)(e,a,i),defaultValues:(null==(b=I.isApproved)?void 0:b.status)??!1}),Be=Le("isApproved",null==(g=I.isApproved)?void 0:g.status),Qe=()=>{Ye({name:"",description:"",capacity:1,type:"",isApproved:!1})};return e.useEffect((()=>{a&&T(a)}),[a]),e.useEffect((()=>{q&&(ne(s),"view"!==s&&"edit"!==s||Me())}),[q,s]),e.useEffect((()=>{switch(te){case"edit":case"create":se(!1);break;default:se(!0)}}),[te]),i(L,{children:[t(P,{children:t(_,{children:i(S,{visible:q,onClose:()=>{Qe(),n(),F({}),ne("view"),se(!1),T(!1)},size:"xl",children:[t(j,{children:t(k,{children:"edit"===te||"create"===te?"Manage Event":"View Event"})}),t(E,{children:i(L,{children:[t(P,{className:"mb-3",children:i(_,{className:"d-flex flex-column",children:[i("strong",{children:[C(r.start)," - ",C(r.end)]}),i("small",{className:"text-muted",children:[" Timeslot ID: ",r._id]}),I&&i("small",{className:"text-muted",children:[" Event ID: ",I._id]}),"development"===o.env]})}),V?t(P,{children:t(_,{children:t(m,{size:"sm"})})}):i(v,{children:[t(P,{children:t(_,{children:i(z,{onSubmit:Ke((async e=>{try{ce(!0);e.name,e.description,e.requirements,e.capacity,e.type,e.isApproved;let a;if("edit"===te)a=await u(`/facilities/event/${r._id}`,e);else a=await h(`/facilities/event/${r._id}`,e);const i=a.data.data;switch(a.status){case 201:N("success","Event created!","success"),F(i),ne("edit");break;case 200:N("success","Event updated!","success"),F(i);break;default:N("Error","Failed to create event","danger")}ce(!1)}catch(a){ce(!1),N("Error","An unexpected error occurred","danger")}})),children:[t(P,{className:"mb-3",children:i(_,{children:[t(D,{type:"text",label:"Name",placeholder:"Applicant Interview",...Ve("name"),readOnly:re,invalid:He.name}),He.name&&t(R,{invalid:!0,className:"text-danger",children:He.name.message})]})}),t(P,{className:"mb-3",children:i(_,{children:[t(O,{type:"text",label:"Description",placeholder:"Lorem ipsum...",rows:6,...Ve("description"),invalid:He.description,readOnly:re}),He.description&&t(R,{invalid:!0,className:"text-danger",children:He.description.message})]})}),t(P,{className:"mb-3",children:i(_,{children:[t(D,{type:"number",label:"Capacity",placeholder:"1",defaultValue:1,...Ve("capacity",{valueAsNumber:!0}),readOnly:re,invalid:He.capacity}),He.capacity&&t(R,{invalid:!0,className:"text-danger",children:He.capacity.message})]})}),t(P,{className:"mb-3",children:i(_,{children:[t($,{htmlFor:"type",children:"Event Type"}),i(M,{id:"type",...Ve("type"),invalid:!!He.type,disabled:re,children:[t("option",{value:"",children:"Select an event type"}),ae.map((e=>t("option",{value:e,children:e},e)))]}),He.type&&t(R,{invalid:!0,className:"text-danger",children:He.type.message})]})}),t(P,{className:"mb-3",children:i(_,{children:[i($,{htmlFor:"isApproved",children:["Current approval status:"," ",(null==(x=I.isApproved)?void 0:x.status)?t("span",{className:"text-success",children:"Approved"}):t("span",{className:"text-danger",children:"Not approved"})]}),t(G,{id:"isApproved",label:""+(Be?"Approved":"Not Approved"),...Ve("isApproved",{valueAsBoolean:!0}),disabled:("admin"===A.role||"manager"===A.role)&&re})]})}),t(P,{className:"mb-3",children:t(_,{children:("edit"===te||"create"===te)&&i("div",{className:"d-flex justify-content-end gap-2",children:[t(d,{type:"button",color:"warning",size:"sm",onClick:()=>{const e=Math.floor(100*Math.random()),a={name:`Event ${e}`,description:`This is a mock description for event #${e}`,capacity:Math.floor(100*Math.random())+1};Ye(a)},children:"Fill Mock Data"}),"edit"===te&&t(d,{color:"danger",size:"sm",onClick:()=>(async()=>{try{if(!confirm("Are you sure you want to delete this event?"))return;if(200===(await f(`/facilities/event/${r._id}`)).status)return Qe(),n(),T(!1),N("Success","Event deleted!","success")}catch(e){N("Error",e,"danger")}})(),children:"Delete"}),t(d,{type:"submit",color:"primary",size:"sm",children:le?t(m,{size:"sm"}):"edit"===te?"Update":"Create"})]})})})]})})}),I.participants&&t(v,{children:t(P,{children:t(_,{children:i(K,{children:[t(Z,{children:i("div",{className:"d-flex justify-content-between",children:[t("div",{children:"Participants"}),["admin","recruiter"].includes(A.role)&&"edit"===te&&I.participants.length>0&&(I.isApproved.status?t("div",{children:t(d,{size:"sm",color:"info",disabled:me,onClick:()=>(async()=>{try{if(!confirm("Are you sure you want to send email?"))return;pe(!0);const e=await h(`/facilities/events/${I._id}/send-email`);return 200===e.status?(pe(!1),he(e.data.failedMails),N("Success",`Email sent for participant for event ${I.name}`,"success")):(pe(!1),N("Info",e.message.message,"info"))}catch(e){N("Error","An error occured","danger")}})(),children:me?i("span",{children:[t(m,{size:"sm"})," sending..."]}):I.emailSent.status?"Resend Mail to Participants":"Send Mail to Participants"})}):t(d,{size:"sm",color:"info",disabled:!0,children:"Needs Approval"}))]})}),t(Y,{children:i(H,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[t(J,{children:i(U,{children:[t(B,{children:"Name"}),t(B,{children:"Email"}),t(B,{children:"Phone"}),t(B,{children:"Email Sent"}),t(B,{children:"Action"})]})}),t(Q,{children:I.participants.map((e=>i(U,{children:[i(W,{children:[e.applicant.lastname,", ",e.applicant.firstname]}),t(W,{children:e.applicant.email}),t(W,{children:e.applicant.phone}),t(W,{children:e.mail.sent?t("span",{className:"text-success",children:"Sent"}):t("span",{className:"text-danger",children:"Failed"})}),t(W,{children:i("div",{className:"d-flex flex-row gap-2",children:[("edit"===te||"create"===te)&&t(d,{size:"sm",color:"danger",onClick:()=>(async e=>{try{if(!confirm("Are you sure you want to delete this applicant?"))return;de(!0),(new FormData).append("applicantId",e._id);const a=await f(`/facilities/events/${I._id}/unbook?applicantId=${e._id}`);return 200===a.status?(Me(),de(!1),N("Success","Applicant removed from the event","success")):(de(!1),N("Info",a.message.message,"info"))}catch(a){N("Error","An error occured","danger")}})(e.applicant),disabled:oe,children:oe?t(m,{size:"sm"}):"Remove"}),["admin","manager","recruiter"].includes(A.role)&&["Initial Interview","Final Interview"].includes(I.type)&&I.isApproved.status&&t(d,{color:"info",size:"sm",onClick:()=>{fe(!0),ne("edit"),T(!1),Se(e.applicant),Ce({_id:I._id,name:I.name,date:I.date,type:I.type})},children:"Interview"})]})})]},e.applicant._id)))})]})})]})})})})]})]})})]})})}),t(P,{children:t(_,{children:t(ee,{isVisible:ve,onClose:()=>{ne("view"),fe(!1),T(!0)},state:ge,eventData:xe,applicantData:Ne})})})]})};te.propTypes={isVisible:s.bool,onClose:s.func,state:s.string,slot:s.object};export{te as default};
