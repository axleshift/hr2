import{p as $,r as t,o as de,k as e,g as D,G as me,F as te,I as he,E as Se,l as ve}from"./index-Y8bT9YIF.js";import{A as De}from"./AppPagination-B5xkHdq8.js";import{F as m,f as ae,J as Te,H as we,y as ue,C as xe,K as Ie,L as Ne,M as Fe,s as ke,N as Ee,x as Me}from"./index.es-BKBfSUB_.js";import{C as je,T as Ae}from"./TimeForm-B1w2PBKs.js";import{z as o,u as le,t as ne,C as q}from"./zod-BJraJSyw.js";import{U as Z,d as f,f as Pe,a as V,t as re}from"./index-CnJf_8Or.js";import{C as Re,a as $e,b as qe,c as Ve,d as Be}from"./CModalTitle-Niw4gm6L.js";import{C as pe,a as g,c as y,b as ie}from"./CFormInput-CFTt_XHx.js";import{C as c,a as h}from"./CRow-tWCNx-Et.js";import{C as v}from"./CInputGroup-B0nFGWpm.js";import{C as E}from"./CInputGroupText-CUVpgJhI.js";import{a as He,b as Le,c as Oe,d as _e,e as Ue}from"./DefaultLayout-ClzfN8Gp.js";import{C as Ge}from"./CFormTextarea-BDdAooEv.js";import{C as ze}from"./CFormCheck-LPWO6X9O.js";import{C as W}from"./CContainer-DiNrJ1HC.js";import{C as oe,a as ce}from"./CCardBody-Cxpbvdcj.js";import{C as Je,a as Ke,b as O,c as M,d as Xe,e as S}from"./CTable-Uu0Niwvz.js";import{C as Ye}from"./CButtonGroup-xKp9TwiU.js";import"./clsx-B-dksMZM.js";import"./index.esm-q13uM3Np.js";const fe=({isVisible:_,onClose:B,isDarkMode:T,interviewData:r})=>{const ee=new Date(new Date().setDate(new Date().getDate()-1)),{addToast:u}=t.useContext(de),[x,C]=t.useState(Z(new Date)),[A,se]=t.useState(!1),[I,U]=t.useState(!1);t.useState({}),t.useState({}),t.useState("");const[b,P]=t.useState([]),[w,N]=t.useState([]),[G,H]=t.useState(!1),[ge,z]=t.useState(null);t.useState(1),t.useState(9),t.useState(1);const J=o.object({title:o.string().min(1,{message:"Title is required"}),date:o.preprocess(s=>new Date(s),o.date().min(ee,{message:"Date should be today or later"})),timeslotId:o.string().optional(),start:o.string().min(1,{message:"Start time is required"}),end:o.string().min(1,{message:"End time is required"}),location:o.string().optional(),capacity:o.preprocess(s=>parseInt(s),o.number().min(1,{message:"Capacity should be at least 1"})),additionalInfo:o.string().optional()}),{register:p,handleSubmit:L,reset:F,formState:{errors:n}}=le({resolver:async(s,a,j)=>{const i=await ne(J)(s,a,j);return console.log("Validation result:",i),i}}),K=o.object({start:o.string().min(1,{message:"Start time is required"}),end:o.string().min(1,{message:"End time is required"})}).refine(async s=>{const[a,j]=s.start.split(":").map(Number),[i,Q]=s.end.split(":").map(Number),be=a*60+j,ye=i*60+Q;return be<ye},{message:"Start time should be before end time",path:["start"]});le({resolver:async(s,a,j)=>{const i=await ne(K)(s,a,j);return console.log("Validation result:",i),i}});const k=async s=>{try{const a=await me(`/interview/slots?date=${s}`);if(a.status===200){const j=a.data;P(j.data);const i=j.data.filter(Q=>Q.isAvailable);N(i)}else u("Error","Failed to fetch time slots","danger")}catch(a){console.error(a),P([]),N([])}},X=async s=>{try{const a=x;console.log(a,s);const j={date:a,timeslot:{start:s.start,end:s.end}},i=await te("/interview/slots/",j);console.log("res",i),i.status===200||i.status===201?(u("Success","Time slot added successfully","success"),k(x)):u("Error",i.message.message,"danger")}catch(a){console.error(a)}},l=async s=>{try{const a=await he(`/interview/slot/${s}`);console.log("handleDeleteTimeslot -> Result",a),a.status===200?(u("Success","Time slot deleted successfully","success"),k(x)):u("Error","Something went wrong. Unable to delete time slot.","danger")}catch(a){console.error(a)}},d=s=>{try{const a={date:x,title:s.title,timeslotRef_id:s.timeslotId,additionalInfo:s.additionalInfo,location:s.location,capacity:s.capacity};console.log(a),(I?Se(`/interview/schedule/${r._id}`,a):te("/interview/schedule",a)).status===200?(u("Success","Interview scheduled successfully","success"),Y()):u("Error","Failed to schedule interview","danger")}catch(a){u("Error","Failed to schedule interview","danger"),console.error(a)}},R=s=>{C(new Date(s))},Y=()=>{F({applicantId:"",applicantName:"",date:new Date,start:null,end:null}),B()},Ce=()=>{H(!1)};return t.useEffect(()=>{k(Z(x))},[x]),t.useEffect(()=>{r&&(console.log("Scheduled Interview",r),U(!0),C(new Date(r.date)),F({title:r.title,timeslotId:r.timeslot._id,start:f(r.timeslot.start),end:f(r.timeslot.end),location:r.location,additionalInfo:r.additionalInfo}))},[r]),e.jsxs(e.Fragment,{children:[e.jsxs(Re,{visible:_,onClose:Y,size:"lg",children:[e.jsx($e,{children:e.jsx(qe,{children:I?"Edit Interview":"Schedule Interview"})}),e.jsxs(Ve,{children:[e.jsx("div",{className:"mb-5",children:e.jsx(je,{onChange:R,defaultValue:x,className:T?"calendar dark-mode":"calendar"})}),e.jsxs(pe,{onSubmit:L(d),children:[e.jsx(c,{children:e.jsxs(h,{children:[e.jsxs(v,{className:"mb-3",children:[e.jsx(E,{children:e.jsx(m,{icon:ae})}),e.jsx(g,{type:"text",placeholder:"Title",...p("title"),invalid:!!n.title})]}),n.title&&e.jsx(y,{invalid:!0,children:n.title.message})]})}),!b||b.length===0?e.jsx(c,{className:"text-danger",children:e.jsx(h,{children:e.jsx(ie,{children:"Click a Date to view its timeslot, if none.. add one."})})}):e.jsxs(e.Fragment,{children:[e.jsx(c,{children:e.jsx(h,{children:e.jsx(ie,{children:"Time Slots"})})}),e.jsx(c,{children:e.jsx(h,{className:"d-flex flex-wrap gap-2 justify-content-start",children:b.map((s,a)=>e.jsx("div",{className:"mb-3",children:e.jsxs(He,{color:s.isAvailable?"success":"danger",children:[f(s.start)," -"," ",f(s.end)," ",e.jsx(q,{content:s.isAvailable?"Available":"Not Available",placement:"top",children:e.jsx(m,{icon:s.isAvailable?Te:we})}),e.jsx(q,{content:"Delete Time Slot",placement:"top",children:e.jsx(D,{onClick:()=>l(s._id),className:"btn",children:e.jsx(m,{icon:ue})})})]})},a))})})]}),e.jsx(c,{children:e.jsx(h,{className:"d-flex justify-content-end align-items-center",children:e.jsx(q,{content:"Add Time Slot",placement:"top",children:e.jsx(D,{onClick:()=>H(!0),className:"btn btn-success mb-3",children:e.jsx(m,{icon:xe})})})})}),e.jsxs(c,{children:[e.jsx(h,{md:4,children:e.jsxs(v,{className:"mb-3",children:[e.jsx(E,{children:"Date"}),e.jsx(g,{type:"text",...p("date"),invalid:!!n.date,value:Pe(x),readOnly:!0,className:"visually-hidden"}),e.jsx(g,{type:"text",invalid:!!n.date,value:V(x),readOnly:!0}),n.date&&e.jsx(y,{invalid:!0,children:n.date.message})]})}),e.jsx(h,{md:8,children:e.jsxs(v,{className:"mb-3",children:[e.jsx(E,{children:e.jsx(m,{icon:Ie})}),e.jsx(g,{type:"text",placeholder:"Time",readOnly:!0,...p("start"),invalid:!!n.start}),n.start&&e.jsx(y,{invalid:!0,children:n.start.message}),e.jsx(g,{type:"text",placeholder:"Time",readOnly:!0,...p("end"),invalid:!!n.end}),n.end&&e.jsx(y,{invalid:!0,children:n.end.message}),e.jsx(q,{content:"Set Time Slot",placement:"top",children:e.jsxs(Le,{children:[e.jsx(Oe,{color:"primary",children:"Time"}),e.jsx(_e,{children:w.map((s,a)=>e.jsxs(Ue,{onClick:()=>{z(s),F({timeslotId:s._id,start:f(s.start),end:f(s.end)})},disabled:w.length===0,children:[f(s.start)," -"," ",f(s.end)]},a))})]})})]})})]}),e.jsx(c,{children:e.jsx(h,{children:e.jsxs(v,{className:"mb-3",children:[e.jsx(E,{children:e.jsx(m,{icon:ae})}),e.jsx(g,{type:"text",placeholder:"Location",...p("location"),invalid:!!n.location}),n.location&&e.jsx(y,{invalid:!0,children:n.location.message})]})})}),e.jsx(c,{children:e.jsx(h,{children:e.jsxs(v,{className:"mb-3",children:[e.jsx(E,{children:e.jsx(m,{icon:Ne})}),e.jsx(g,{type:"number",placeholder:"capacity",...p("capacity"),invalid:!!n.capacity,defaultValue:1}),n.capacity&&e.jsx(y,{invalid:!0,children:n.capacity.message})]})})}),e.jsx(c,{children:e.jsx(h,{children:e.jsxs(v,{className:"mb-3",children:[e.jsx(E,{children:e.jsx(m,{icon:Fe})}),e.jsx(Ge,{type:"text",placeholder:"Additional Information",...p("additionalInfo"),invalid:!!n.additionalInfo}),n.additionalInfo&&e.jsx(y,{invalid:!0,children:n.additionalInfo.message})]})})}),e.jsx(c,{children:e.jsxs(h,{className:"d-flex justify-content-end",children:[e.jsx(ze,{type:"checkbox",id:"invalidCheck",label:"I confirm everything is correct.",checked:A,onChange:()=>se(!A)}),e.jsx(y,{invalid:!0,children:"You must agree before submitting."})]})}),e.jsxs(Be,{children:[e.jsx(D,{type:"submit",disabled:!A,className:"btn btn-primary",children:I?"Update":"Schedule"}),e.jsx(D,{color:"secondary",onClick:Y,children:"Cancel"})]})]})]})]}),e.jsx(Ae,{isVisible:G,onClose:Ce,handleTimeSubmit:X})]})};fe.propTypes={isVisible:$.bool.isRequired,onClose:$.func.isRequired,isDarkMode:$.bool.isRequired,interviewData:$.object};const Qe=({theme:_})=>{const B=_==="dark",{addToast:T}=t.useContext(de),[r,ee]=t.useState(!1),[u,x]=t.useState([new Date,new Date]),[C,A]=t.useState(Z(new Date));t.useState(new Date);const[se,I]=t.useState([]),[U,b]=t.useState(!1),[P,w]=t.useState(!1),[N,G]=t.useState(1),[H,ge]=t.useState(9),[z,J]=t.useState(1),[p,L]=t.useState([]),[F,n]=t.useState(null),K=l=>{l.length>1?x(l):A(l)},k=t.useCallback(async l=>{b(!0);try{const d=await me(`/interview/all?date=${l}&page=${N}&limit=${H}`);if(d.status===200){const R=`Successfully fetched interview schedules for ${V(l)}`;T("Success",R,"success"),L(d.data.data),I(d.data.slots),J(d.data.totalPages),b(!1)}else{const R=`Failed to fetch interview schedules for ${V(l)}`;T("Error",R,"error"),b(!1),L([]),I([])}}catch(d){console.error(d),b(!1)}}),X=async l=>{try{(await he(`/interview/schedule/${l}`)).status===200?(T("Success","Successfully deleted interview schedule","success"),k(C)):T("Error","Failed to delete interview schedule","error")}catch(d){console.error(d),T("Error","Failed to delete interview schedule","error")}};return t.useEffect(()=>{const l=setTimeout(()=>{k(C)},1e3);return()=>clearTimeout(l)},[C]),t.useEffect(()=>{P&&F&&w(!1)},[N]),e.jsx(e.Fragment,{children:e.jsxs(W,{className:"d-flex flex-column gap-3",children:[e.jsx(c,{children:e.jsx(W,{children:e.jsx(oe,{children:e.jsxs(ce,{children:[e.jsx("div",{children:e.jsx(je,{onChange:K,selectRange:r,className:B?"calendar dark-mode":"calendar",defaultValue:r?[new Date(u[0]),new Date(u[1])]:new Date(C)})}),e.jsx("br",{}),e.jsx("div",{children:e.jsxs(v,{children:[e.jsx(g,{type:"text",placeholder:"start",value:V(C),readOnly:!0}),e.jsx(q,{content:"Create interview",placement:"top",children:e.jsx(D,{onClick:()=>w(!0),className:"btn btn-primary",children:e.jsx(m,{icon:xe})})})]})})]})})})}),e.jsx(c,{children:e.jsx(W,{children:e.jsx(oe,{children:e.jsxs(ce,{children:[e.jsx(pe,{children:e.jsxs(v,{children:[e.jsx(g,{type:"text",placeholder:"Search"}),e.jsx(D,{color:"primary",children:e.jsx(m,{icon:ke})})]})}),e.jsxs(Je,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[e.jsx(Ke,{children:e.jsxs(O,{children:[e.jsx(M,{children:e.jsx(m,{icon:Ee})}),e.jsx(M,{children:"Date"}),e.jsx(M,{children:"Time"}),e.jsx(M,{children:"Location"}),e.jsx(M,{children:"Capacity"}),e.jsx(M,{children:"Action"})]})}),e.jsx(Xe,{children:U?e.jsx(O,{children:e.jsx(S,{colSpan:"6",className:"text-center",children:e.jsx(ve,{color:"primary",variant:"grow"})})}):p.length===0?e.jsx(O,{children:e.jsx(S,{colSpan:"6",className:"text-center",children:"No data available"})}):p.map((l,d)=>e.jsxs(O,{children:[e.jsx(S,{children:l.title}),e.jsx(S,{children:V(l.date)}),e.jsxs(S,{children:[f(l.timeslot.start)," -"," ",f(l.timeslot.end)]}),e.jsx(S,{children:l.location?re(l.location,20):"N/A"}),e.jsx(S,{children:l.capacity?re(l.capacity,20):"N/A"}),e.jsx(S,{children:e.jsxs(Ye,{children:[e.jsx(D,{onClick:()=>{console.log("Interview Data:",l),n(l),w(!0)},className:"btn btn-primary",children:e.jsx(m,{icon:Me})}),e.jsx(D,{onClick:()=>X(l._id),className:"btn btn-danger",children:e.jsx(m,{icon:ue})})]})})]},d))})]})]})})})}),e.jsx(c,{children:e.jsx(h,{children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(De,{currentPage:N,totalPages:z,onPageChange:G})})})}),e.jsx(c,{children:e.jsx(fe,{isVisible:P,onClose:()=>w(!1),isDarkMode:B,interviewData:F})})]})})};Qe.propTypes={theme:$.string};export{Qe as default};
