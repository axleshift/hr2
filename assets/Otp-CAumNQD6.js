import{f as e,r as t}from"./react-router-dom-BnDDw25P.js";import{u as r}from"./react-hook-form-DB8hWBdy.js";import{z as s}from"./zod-B0zZW6rS.js";import{s as a}from"./@hookform/resolvers/zod-1wp20Skh.js";import{A as o,a as n,j as i,g as m,w as l}from"./index-DiLnYbjC.js";import{C as c}from"./CContainer-DzOuZpEx.js";import{C as d,a as u}from"./CRow-BNc0QFWW.js";import{C as p}from"./CAlert-Dv5Ag3lJ.js";import{C as h,b as f,a as y}from"./CFormLabel-DwEY-V3u.js";import{C as b}from"./CFormInput-uT5SP9Ht.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";const g=s.object({otp:s.string().min(6,"OTP must be 6 digits").max(6,"OTP must be 6 digits").regex(/^\d+$/,"OTP must only contain numbers")}),j=()=>{const{register:s,handleSubmit:j,formState:{errors:v},reset:P}=r({resolver:a(g)}),C=e(),{userInformation:O}=t.useContext(o),[T,x]=t.useState(0),[N,w]=t.useState(""),[S,F]=t.useState(""),[k,I]=t.useState("");return t.useEffect((()=>{if(0===T)return;const e=setInterval((()=>{x((e=>e-1))}),1e3);return()=>clearInterval(e)}),[T]),n(c,{className:"mt-5",children:n(d,{className:"justify-content-center",children:i(u,{md:6,lg:5,children:[n("h2",{className:"mb-4 text-center",children:"Verify One-Time Password"}),k&&n(p,{color:"success",children:k}),S&&n(p,{color:"danger",children:S}),n("small",{children:i("p",{className:"text-muted",children:["Welcome back ",O.username,"! We sent an OTP to your email to confirm your information."]})}),i(h,{onSubmit:j((async e=>{var t,r;try{const t=new FormData;t.append("username",O.username),t.append("otp",e.otp);200===(await l("/auth/verify-otp",t)).status&&(I("OTP Verified Successfully!"),F(""),setTimeout((()=>C("/dashboard")),1500))}catch(s){F((null==(r=null==(t=null==s?void 0:s.response)?void 0:t.data)?void 0:r.message)||"Verification failed. Please try again.")}})),children:[i("div",{className:"mb-3",children:[n(f,{htmlFor:"otp",children:"Enter OTP"}),n(b,{id:"otp",type:"text",placeholder:"Enter 6-digit code",maxLength:6,...s("otp"),invalid:!!v.otp}),v.otp&&n(y,{className:"d-block",children:n("small",{children:v.otp.message})})]}),n("div",{className:"d-grid mb-3",children:n(m,{color:"primary",type:"submit",children:"Verify OTP"})})]}),i("div",{className:"text-center",children:[n(m,{color:"secondary",variant:"outline",size:"sm",disabled:T>0,onClick:async()=>{try{const e=new FormData;e.append("username",O.username);200===(await l("/auth/send-otp",e)).status&&(w("A new OTP has been sent to your email."),x(60),P())}catch(e){w("Failed to resend OTP. Please try again later.")}},children:T>0?`Resend OTP in ${T}s`:"Resend OTP"}),N&&n(p,{color:"info",className:"mt-3",children:N})]})]})})})};export{j as default};
