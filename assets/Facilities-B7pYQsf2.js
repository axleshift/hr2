import{r as e,R as t}from"./react-router-dom-BnDDw25P.js";import{l as a,k as l,f as n,w as r,r as s,P as i,v as c,x as m,i as o}from"./index-B7GOa2VM.js";import{F as d,J as u}from"./index.es-DuBIM0a-.js";import{z as E}from"./zod-B0zZW6rS.js";import{u as p}from"./react-hook-form-DGCwHb0C.js";import{s as f}from"./@hookform/resolvers/zod-B5rlnuQ9.js";import{C as y,a as g,b as C}from"./CModalHeader-Bl2A0-Cm.js";import{C as v}from"./CModalTitle-C6T0xl3w.js";import{C as b,a as h}from"./CFormInput-XbKHKQ6a.js";import{C as S,a as j}from"./CRow-Br3xIw5l.js";import{C as N}from"./CFormTextarea-Bna0WiLq.js";import{C as w}from"./CModalFooter-DuOhiGdB.js";import{C as D}from"./Calendar-OipaX6s0.js";import{f as F}from"./index-BxAblS3e.js";import{C as T,a as k,b as x,c as A}from"./CTabList-CI9fyTum.js";import{a as I}from"./DefaultLayout-ChKxIIMN.js";import{C as V}from"./CContainer-Cm5KmpuN.js";import{C as $,a as q}from"./CCardBody-BBjnVtJK.js";import{C as z,a as R,b as M,c as _,d as L,e as O}from"./CTable-CkRzeAO8.js";import{C as K}from"./CAlert-DH7amEZ2.js";import{C as Z}from"./CFormCheck-CsZnQWUH.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";import"./getTransitionDurationFromElement-2nBpLMKS.js";import"./index.esm-f6pRpclZ.js";import"./isRTL-D5ORmfro.js";const B=({isVisible:i,onClose:c,isEdit:m,facilityData:o})=>{const{addToast:d}=e.useContext(a),u=E.object({name:E.string().nonempty("Name is required"),type:E.string().nonempty("Type is required"),description:E.string().nonempty("Description is required"),location:E.string().nonempty("Location is required")}),{register:D,handleSubmit:F,reset:T,formState:{errors:k}}=p({resolver:f(u)});return e.useEffect((()=>{i||T(),m&&T({name:null==o?void 0:o.name,type:null==o?void 0:o.type,description:null==o?void 0:o.description,location:null==o?void 0:o.location})}),[i,m]),t.createElement(y,{visible:i,onClose:()=>{T(),c()}},t.createElement(g,null,m?t.createElement(v,null,"Edit Facility"):t.createElement(v,null,"Add Facility")),t.createElement(C,null,t.createElement(b,{onSubmit:F((async e=>{try{const t=new FormData;t.append("name",e.name),t.append("type",e.type),t.append("description",e.description),t.append("location",e.location);const a=m?await r(`/facilities/update/${o._id}`,t):await s("/facilities/create",e);200!==a.status&&201!==a.status||d("Success","Facility Added Successfully","success"),T(),c()}catch(t){d("Error","An Error Occurred","danger")}}))},t.createElement(S,{className:"mb-3"},t.createElement(j,null,t.createElement(h,{type:"text",label:"Facility Name",placeholder:"Facility Name",...D("name"),defaultValue:null==o?void 0:o.name,invalid:!!(null==k?void 0:k.name)}),k.name&&t.createElement("div",{className:"invalid-feedback"},k.name.message))),t.createElement(S,{className:"mb-3"},t.createElement(j,null,t.createElement(h,{type:"text",label:"Type",placeholder:"Type",...D("type"),defaultValue:null==o?void 0:o.type,invalid:!!(null==k?void 0:k.type)}),k.type&&t.createElement("div",{className:"invalid-feedback"},k.type.message))),t.createElement(S,{className:"mb-3"},t.createElement(j,null,t.createElement(N,{type:"text",rows:5,label:"Description",placeholder:"Description",...D("description"),defaultValue:null==o?void 0:o.description,invalid:!!(null==k?void 0:k.description)}),k.description&&t.createElement("div",{className:"invalid-feedback"},k.description.message))),t.createElement(S,{className:"mb-3"},t.createElement(j,null,t.createElement(h,{type:"text",label:"Location",placeholder:"Location",...D("location"),defaultValue:null==o?void 0:o.location,invalid:!!(null==k?void 0:k.location)}),k.location&&t.createElement("div",{className:"invalid-feedback"},k.location.message))),t.createElement(w,null,"development"===l.env,t.createElement(n,{color:"primary",type:"submit"},m?"Update":"Create")))))};B.propTypes={isVisible:i.bool.isRequired,onClose:i.func.isRequired,isEdit:i.bool.isRequired,facilityData:i.object};const H=({isVisible:l,onClose:r,facilityData:i={},onChange:o})=>{const{addToast:d}=e.useContext(a),[u,N]=e.useState(!1),[w,K]=e.useState(new Date),[Z,B]=e.useState(!1),[H,J]=e.useState([]),[P,W]=e.useState([]),[G,U]=e.useState([]),[X,Y]=e.useState(!1),[Q,ee]=e.useState(5e3),[te,ae]=e.useState(0),le=(e,t="12h")=>{const[a,l]=e.split(":");return`${a%12||12}:${l} ${a<12?"AM":"PM"}`},ne=async()=>{try{const e=await c(`/facilities/timeslot/${i._id}/${new Date(w)}`);if(200===e.status)return W(e.data.data)}catch(e){d("error","An error occurred while fetching timeslots","danger")}},re=E.object({start:E.string().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,"Invalid time format"),end:E.string().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,"Invalid time format")}).superRefine(((e,t)=>{e.start>=e.end&&t.addIssue({code:E.ZodIssueCode.custom,message:"Start time must be before end time",path:["start"]});P.find((t=>e.start<t.end&&e.end>t.start))&&t.addIssue({code:E.ZodIssueCode.custom,message:"Timeslot overlaps with an existing one",path:["start"]})})),{register:se,handleSubmit:ie,reset:ce,formState:{errors:me}}=p({resolver:f(re)});return e.useEffect((()=>{l&&(o(),(()=>{const e=i.timeslots.map((e=>new Date(e.date))).map((e=>new Date(e.getTime()-6e4*e.getTimezoneOffset())));J(e)})(),ne())}),[w,l]),t.createElement(y,{visible:l,onClose:()=>{J([]),o(),r(),ce()},size:"lg",backdrop:"static"},t.createElement(g,null,t.createElement(v,null,"Manage ",i.name||"Facility")),t.createElement(C,null,t.createElement(T,{activeItemKey:0},t.createElement(k,{variant:"underline-border"},t.createElement(x,{itemKey:0},"Timeslots"),t.createElement(x,{itemKey:1},"Events")),t.createElement(I,null,t.createElement(A,{itemKey:0},t.createElement(V,null,t.createElement(S,{className:"mb-3"},t.createElement(j,null,t.createElement(D,{onChange:e=>{const t=new Date(e.getTime()-6e4*e.getTimezoneOffset());K(t)},className:u?"calendar dark-mode":"calendar",defaultValue:w,tileClassName:({date:e})=>{if(H.find((t=>t.toDateString()===e.toDateString())))return"has-timeslots"}}))),t.createElement(S,{className:"mb-3"},t.createElement(j,null,t.createElement("strong",null,"Timeslots for ",F(w)))),t.createElement(S,{className:"mb-3"},t.createElement(j,null,t.createElement(b,{onSubmit:ie((async e=>{try{const t=new FormData;t.append("date",new Date(w)),t.append("start",e.start),t.append("end",e.end);const a=await s(`/facilities/timeslot/create/${i._id}`,t);return 404===a.status||400===a.status?d("error",JSON.stringify(a.message.message),"danger"):(ne(),d("success","Timeslot added successfully","success"))}catch(t){d("error","An error occurred while adding timeslot","danger")}}))},t.createElement(S,{className:"d-flex gap-2"},t.createElement(j,null,t.createElement(h,{type:"time",...se("start"),placeholder:"Start time",invalid:!!me.start}),me.start&&t.createElement("div",{className:"invalid-feedback"},me.start.message)),t.createElement(j,null,t.createElement(h,{type:"time",...se("end"),placeholder:"End time",invalid:!!me.end}),me.end&&t.createElement("div",{className:"invalid-feedback"},me.end.message)),t.createElement(j,null,t.createElement("div",{className:"d-flex justify-content-end"},t.createElement(n,{type:"submit",color:"success"},"Add"))))))),t.createElement(S,null,t.createElement(j,null,t.createElement($,null,t.createElement(q,null,t.createElement(z,{small:!0,striped:!0,responsive:!0},t.createElement(R,null,t.createElement(M,null,t.createElement(_,null,"Date"),t.createElement(_,null,"Start"),t.createElement(_,null,"End"),t.createElement(_,null,"Action"))),t.createElement(L,null,0===P.length?t.createElement(M,null,t.createElement(O,{colSpan:"4",className:"text-center"},"No timeslots found for ",F(w))):P.map((e=>t.createElement(M,{key:e._id},t.createElement(O,null,F(new Date(e.date))),t.createElement(O,null,le(e.start,"12h")),t.createElement(O,null,le(e.end,"12h")),t.createElement(O,null,t.createElement(n,{color:"danger",size:"sm",onClick:()=>(async e=>{try{200===(await m(`/facilities/timeslot/delete/${e._id}`)).status&&(d("success","Timeslot removed successfully","success"),ne())}catch(t){d("error","An error occurred while removing timeslot","danger")}})(e)},"Delete"))))))))))))),t.createElement(A,{itemKey:1},"events")))))};H.propTypes={isVisible:i.bool.isRequired,onClose:i.func.isRequired,facilityData:i.object,onChange:i.func};const J=()=>{const{addToast:l}=e.useContext(a),[r,s]=t.useState([]),[i,E]=t.useState(!0),[p,f]=t.useState(""),[h,N]=t.useState(!1),[D,F]=t.useState({}),[T,k]=t.useState(!1),[x,A]=t.useState(!1),[I,J]=t.useState({}),[P,W]=t.useState(!1),[G,U]=t.useState(!1),X=async()=>{try{const e=await c("/facilities/all");if(404===e.status)return E(!1),l("Error","Facilities not found","danger");s(e.data.data),E(!1)}catch(e){l("Error","An Error Occurred","danger"),E(!1)}};return e.useEffect((()=>{X()}),[]),t.createElement(t.Fragment,null,t.createElement(V,null,t.createElement(S,{className:"mb-3"},t.createElement(j,null,t.createElement("h2",null,"Facilities"),t.createElement("small",null,"In this page you can create, remove, update, and delete all the facilities available in the system."))),t.createElement(S,{className:"mb-3"},t.createElement(j,null,t.createElement("div",{className:"d-flex justify-content-end"},t.createElement(n,{color:"primary",onClick:()=>{k(!1),N(!0)}},"Create Facility"),t.createElement(n,{color:"info",className:"ms-2",onClick:()=>{X()}},t.createElement(d,{icon:u}))))),t.createElement(S,null,t.createElement(j,null,i?t.createElement("div",{className:"d-flex justify-content-center align-items-center"},t.createElement(o,null)):t.createElement($,null,t.createElement(q,null,t.createElement(z,{align:"middle",hover:!0,responsive:!0,striped:!0},t.createElement(R,null,t.createElement(M,null,t.createElement(_,null,"Facility Name"),t.createElement(_,null,"Facility Type"),t.createElement(_,null,"Facility Description"),t.createElement(_,null,"Actions"))),t.createElement(L,null,r.map((e=>t.createElement(M,{key:e._id},t.createElement(O,null,e.name),t.createElement(O,null,e.type),t.createElement(O,null,e.description),t.createElement(O,null,t.createElement(n,{color:"info",size:"sm",onClick:()=>{k(!0),F(e),N(!0)}},"Edit"),t.createElement(n,{color:"danger",size:"sm",className:"ms-2",onClick:()=>{J(e),A(!0)}},"Delete"),t.createElement(n,{color:"primary",size:"sm",className:"ms-2",onClick:()=>{F(e),U(!0)}},"Manage"))))))))))),t.createElement(S,null,t.createElement(j,null,t.createElement(y,{visible:x,onClose:()=>{A(!1),J({}),W(!1)}},t.createElement(g,null,t.createElement(v,null,"Confirm Deletion")),t.createElement(C,null,t.createElement("p",null,"Are you sure you want to delete this facility?"),t.createElement("br",null),t.createElement("p",null,t.createElement("strong",null,"Facility Name: ")," ",t.createElement("small",null,I.name)),t.createElement("p",null,t.createElement("strong",null,"Facility Type: ")," ",t.createElement("small",null,I.type)),t.createElement(K,{color:"danger"},t.createElement("p",null,t.createElement("strong",null,"Warning: "),t.createElement("small",null,"Be aware that this action is irreversible. Once you delete this facility, you will not be able to recover it. This actions will also delete all the associated information with this facility such as events, timeslots, reservations, etc.")))),t.createElement(w,null,t.createElement(b,null,t.createElement(Z,{type:"checkbox",label:t.createElement("span",{onClick:()=>W(!P)},"I understand the consequences of this action"),onChange:()=>W(!P),defaultChecked:P})),t.createElement(n,{color:"danger",onClick:()=>{(async e=>{try{if(404===(await m(`/facilities/delete/${e}`)).status)return E(!1),l("Error","Facility not found","danger");l("Success","Facility deleted successfully","success"),E(!1),X()}catch(t){l("Error","An Error Occurred","danger"),E(!1)}})(I._id),A(!1)},disabled:!P},"Delete"))))),t.createElement(S,null,t.createElement(j,null,t.createElement(B,{isVisible:h,onClose:()=>{N(!1),F({}),X()},isEdit:T,facilityData:D}))),t.createElement(S,null,t.createElement(j,null,t.createElement(H,{isVisible:G,onClose:()=>U(!1),facilityData:D,onChange:()=>X()})))))};export{J as default};
