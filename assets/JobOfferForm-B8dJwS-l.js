import{r as e}from"./react-router-dom-BnDDw25P.js";import{m as a,A as s,j as t,a as i,k as r,g as n,F as o,v as l,x as d,p as c}from"./index-idxjfpO7.js";import{z as p}from"./zod-B0zZW6rS.js";import{u as m}from"./react-hook-form-DB8hWBdy.js";import{s as f}from"./@hookform/resolvers/zod-1wp20Skh.js";import{F as u,U as h}from"./index.es-CQWNrdDz.js";import{C as v,a as b,b as y}from"./CModalHeader-CdUpBEI3.js";import{C as g}from"./CModalTitle-Ccg3gLsQ.js";import{C,a as j}from"./CRow-DEvZ4-I-.js";import{C as D,a as S,b as w}from"./CFormLabel-DfytgIE9.js";import{C as N}from"./CFormInput-DlBYdvLv.js";import{C as O}from"./CTooltip-BYrF9prw.js";import{C as B}from"./CFormSelect-FCYyv5dO.js";import{C as x}from"./CFormTextarea-DTox_qbu.js";import{C as I}from"./CFormCheck-ClI9EWhj.js";const k=["Pending","Accepted","Declined"],z=p.object({position:p.string().min(1).max(30),salary:p.coerce.number().min(1).default(1),startDate:p.string().refine((e=>!isNaN(Date.parse(e))),{message:"Invalid date"}),benefits:p.string().min(1,{message:"Benefits is required"}),status:p.enum(["Pending","Accepted","Declined"]),notes:p.string().optional(),approvedBy:p.string().optional(),approvedDate:p.string().optional().refine((e=>!isNaN(Date.parse(e))),{message:"Invalid date"})}),A=({isVisible:c,onClose:p,state:A,interview:F,joboffer:T})=>{const{addToast:J}=e.useContext(a),{userInformation:R}=e.useContext(s),[$,q]=e.useState(!1),[E,L]=e.useState({}),[P,_]=e.useState({}),[M,U]=e.useState(!1),[V,H]=e.useState(!1),[K,Q]=e.useState(!1),[W,X]=e.useState("view"),[Y,Z]=e.useState(!1),[G,ee]=e.useState(!1),{register:ae,handleSubmit:se,reset:te,setValue:ie,watch:re,formState:{errors:ne}}=m({resolver:async(e,a,s)=>await f(z)(e,a,s)});return e.useEffect((()=>{c&&(Z(c),F&&(_(F),te({position:F.job??"No Data",startDate:new Date(F.date).toISOString().split("T")[0],salary:F.salaryExpectation,status:"Pending"})),T&&(L(T),te({position:T.position??"No Data",startDate:new Date(T.startDate).toISOString().split("T")[0],salary:T.salary,status:T.status,benefits:T.benefits,notes:T.notes,approvedBy:T.approvedBy?`${T.approvedBy.lastname}, ${T.approvedBy.firstname}`:"",approvedDate:T.approvedDate?new Date(T.approvedDate).toISOString().split("T")[0]:new Date})))}),[c,F,T,W]),m((()=>{W&&("edit"!==W&&"create"!==W||setIsReadOnly(!1))})),e.useEffect((()=>{A&&X(A)}),[A]),t(v,{visible:Y,size:"lg",onClose:()=>{p(),Z(!1)},backdrop:"static",children:[i(b,{children:i(g,{className:"text-capitalize",children:"edit"===W?"Update Job Offer":"Create Job Offer"})}),i(y,{children:i(C,K?{children:t(j,{children:[i(r,{size:"sm"})," Loading.."]})}:{children:i(j,{children:t(D,{onSubmit:se((async e=>{var a;try{U(!0);const s=null==(a=P.applicant)?void 0:a._id,t="edit"===W?await d(`/applicant/joboffer/${E._id}?isApproved=${G}`,e):await l(`/applicant/joboffer/${s}`,e);switch(t.status){case 201:case 200:J("Success",t.data.message,"success"),L(t.data.data);break;default:J("Error",t.message.message,"danger")}p()}catch(s){}finally{U(!1)}})),children:[t(C,{className:"mb-3",children:[t(j,{children:[i(N,{label:"Position / job Applied For?",...ae("position"),invalid:!!ne.position,readOnly:["view","edit","create"].includes(W)}),ne.position&&i(S,{invalid:!0,children:ne.position.message})]}),t(j,{children:[i(N,{type:"number",label:"Salary",...ae("salary",{valueAsNumber:!0}),invalid:!!ne.salary,readOnly:["view"].includes(W)}),ne.salary&&i(S,{invalid:!0,children:ne.salary.message})]})]}),t(C,{className:"mb-3",children:[t(j,{children:[i(O,{placement:"top",content:"When the new hire is expected to start.",children:i(w,{children:"Start Date"})}),i(N,{type:"date",...ae("startDate"),readOnly:["view"].includes(W)}),ne.startDate&&i(S,{invalid:!0,children:ne.startDate.message})]}),i(j,{children:i(B,{label:"Job Offer Status",...ae("status"),invalid:!!ne.status,disabled:["view"].includes(W),children:k.map(((e,a)=>i("option",{value:e,children:e},a)))})})]}),(null==E?void 0:E.approvedBy)&&t(C,{className:"mb-3",children:[t(j,{children:[i(N,{label:"Approved By",...ae("approvedBy"),invalid:!!ne.approvedBy,readOnly:!0}),ne.approvedBy&&i(S,{invalid:!0,children:ne.approvedBy.message})]}),t(j,{children:[i(N,{type:"date",label:"Approved Date",...ae("approvedDate"),readOnly:!0}),ne.approvedDate&&i(S,{invalid:!0,children:ne.approvedDate.message})]})]}),i(C,{className:"mb-3",children:t(j,{children:[i(x,{label:"Benefits",rows:6,...ae("benefits"),readOnly:["view"].includes(W),invalid:!!ne.benefits}),ne.benefits&&i(S,{invalid:!0,children:ne.benefits.message})]})}),i(C,{className:"mb-3",children:t(j,{children:[i(x,{label:"Notes",rows:6,...ae("notes"),readOnly:["view"].includes(W)}),ne.notes&&i(S,{invalid:!0,children:ne.notes.message})]})}),!T.approvedBy&&i(C,{children:i(j,{children:i(n,{color:G?"primary":"secondary",size:"sm",onClick:()=>ee(!G),children:G?"Approve":"Disapproved"})})}),i(C,{children:i(j,{className:"d-flex justify-content-end",children:i(I,{label:"I confirm that details above are correct and true.",defaultChecked:!$,onChange:()=>q(!$)})})}),i(C,{children:t(j,{className:"d-flex justify-content-end gap-2",children:[!T.emailSent&&T.approvedBy&&t(n,{color:"info",size:"sm",disabled:$||M||V,onClick:()=>(async e=>{try{H(!0);const a=await l(`/applicant/joboffer/send-email/${e}`);200===a.status&&J("Success",a.data.message,"success")}catch(a){}finally{H(!1)}})(T._id),children:[i(u,{icon:h,className:"me-2"}),V?"Loading... ":"Send Job offer Mail"]}),i(n,{type:"submit",color:"primary",size:"sm",disabled:$||M,children:M?t(o,{children:[i(r,{size:"sm"})," Loading..."]}):"create"===W?"Issue Job Offer":"Update Job Offer"})]})})]})})})})]})};A.propTypes={isVisible:c.bool.isRequired,onClose:c.func.isRequired,state:c.string.isRequired,interview:c.object,joboffer:c.object};export{A as J};
