import{F as e,A as a,B as i}from"./index.es-C7rQvpfu.js";import{r as t}from"./react-router-dom-BnDDw25P.js";import{m as r,A as s,j as n,a as l,l as c,F as o,k as d,g as m,w as h,x as p,v as u,p as f}from"./index-BJT4fTiC.js";import{t as b}from"./index-DCO1bnrX.js";import{A as g}from"./AppPagination-DMq9VxDB.js";import{z as y}from"./zod-B0zZW6rS.js";import{u as j}from"./react-hook-form-DB8hWBdy.js";import{s as C}from"./@hookform/resolvers/zod-1wp20Skh.js";import{C as x,a as v,b as N}from"./CModalHeader-BU-RWpvT.js";import{C as w}from"./CModalTitle-C_idPema.js";import{C as S}from"./CContainer-DbpNrOOa.js";import{C as q,a as k}from"./CRow-CBvILoJo.js";import{C as z,a as T,b as $}from"./CFormLabel-6XxpHli6.js";import{C as F}from"./CFormInput-ChuQ9HWE.js";import{C as P}from"./CFormTextarea-D6rjc7Fq.js";import{C as A}from"./CFormSelect-DMCzRg7Z.js";import{C as E}from"./CInputGroup-DtzeIo2t.js";import{C as I,a as O}from"./CCardBody--50oArVU.js";import{C as L,a as V,b as _,c as J,d as R,e as M}from"./CTable-ByJVcr_J.js";import{C as U}from"./CTooltip-DaMyn26V.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";import"./DefaultLayout-D2tYzXUY.js";import"./index.esm-DSBubaFD.js";import"./isRTL-D5ORmfro.js";import"./getTransitionDurationFromElement-2nBpLMKS.js";const B=["internship","full-time","part-time","contract","temporary","freelance"],D=y.object({title:y.string().min(3).max(50),responsibilities:y.string().min(3).max(250),requirements:y.string().min(3).max(250),qualifications:y.string().min(3).max(250),benefits:y.string().min(3).max(250),category:y.enum(B),capacity:y.number().min(1).default(1)}),G=({isVisible:e,onClose:a,state:i,job:f})=>{const{addToast:b}=t.useContext(r),{userInformation:g}=t.useContext(s),[y,E]=t.useState(!1),[I,O]=t.useState(!1),[L,V]=t.useState(!1),{register:_,watch:J,handleSubmit:R,reset:M,formState:{errors:U},setValue:G}=j({resolver:async(e,a,i)=>await C(D)(e,a,i)});return t.useEffect((()=>{e&&f&&"edit"===i?(async()=>{try{V(!0);const e=await h(`/job/${f._id}`);200===e.status&&(V(!1),M(e.data.data))}catch(e){}})():V(!1)}),[f,e,i]),t.useEffect((()=>{O("edit"!==i&&"create"!==i)}),[i]),n(x,{visible:e,onClose:()=>{a(),(async()=>{M({title:"",responsibilities:"",requirements:"",qualifications:"",benefits:"",category:"temporary",capacity:1})})()},size:"lg",children:[l(v,{children:l(w,{children:"create"===i?"Create job":"Manage Job"})}),l(N,{children:n(S,{children:["development"===c.env,l(q,{children:l(k,{children:L?n(o,{children:[l(d,{size:"sm"}),l("span",{children:"Loading..."})]}):n(z,{onSubmit:R((async e=>{var t,r;try{const t=new FormData;let r;switch(t.append("title",e.title),t.append("responsibilities",e.responsibilities),t.append("requirements",e.requirements),t.append("qualifications",e.qualifications),t.append("benefits",e.benefits),t.append("category",e.category),t.append("capacity",e.capacity),i){case"create":r=await u("/job/",t);break;case"edit":r=await p(`/job/${f._id}`,t);break;default:throw new Error("Invalid form state")}200!==r.status&&201!==r.status||(b("Success",r.data.message,"success"),"create"===i&&a())}catch(s){b("Error",(null==(r=null==(t=null==s?void 0:s.response)?void 0:t.data)?void 0:r.message)||"Something went wrong","danger")}})),children:[l(q,{className:"mb-3",children:n(k,{children:[l(F,{type:"text",label:"Title",placeholder:"",readOnly:I,..._("title"),invalid:U.title}),U.title&&l(T,{invalid:!0,className:"text-danger",children:U.title.message})]})}),l(q,{className:"mb-3",children:n(k,{children:[l(P,{type:"text",label:"Responsibilities",placeholder:"",readOnly:I,..._("responsibilities"),invalid:U.responsibilities}),U.responsibilities&&l(T,{invalid:!0,className:"text-danger",children:U.responsibilities.message})]})}),l(q,{className:"mb-3",children:n(k,{children:[l(P,{type:"text",label:"Requirements",placeholder:"",readOnly:I,..._("requirements"),invalid:U.requirements}),U.requirements&&l(T,{invalid:!0,className:"text-danger",children:U.requirements.message})]})}),l(q,{className:"mb-3",children:n(k,{children:[l(P,{type:"text",label:"Qualifications",placeholder:"",readOnly:I,..._("qualifications"),invalid:U.qualifications}),U.qualifications&&l(T,{invalid:!0,className:"text-danger",children:U.qualifications.message})]})}),l(q,{className:"mb-3",children:n(k,{children:[l(P,{type:"text",label:"Benefits",placeholder:"",readOnly:I,..._("benefits"),invalid:U.benefits}),U.benefits&&l(T,{invalid:!0,className:"text-danger",children:U.benefits.message})]})}),l(q,{className:"mb-3",children:n(k,{children:[l($,{htmlFor:"category",children:"Category"}),n(A,{id:"category",readOnly:I,..._("category",{required:"Please select a category"}),invalid:!!U.category,children:[l("option",{value:"",children:"Select a category"}),B.map((e=>l("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))]}),U.category&&l(T,{invalid:!0,className:"text-danger",children:U.category.message})]})}),l(q,{className:"mb-3",children:n(k,{children:[l(F,{type:"number",label:"Capacity",defaultValue:1,placeholder:"",readOnly:I,..._("capacity",{valueAsNumber:!0}),invalid:U.capacity}),U.capacity&&l(T,{invalid:!0,className:"text-danger",children:U.capacity.message})]})}),"view"!==i&&l(q,{className:"mb-3",children:l(k,{className:"d-flex justify-content-end",children:l(m,{type:"submit",color:"primary",size:"sm",children:"edit"===i?"Update":"Create"})})}),["admin","manager","recruiter"].includes(g.role)&&l(q,{children:l(k,{className:"d-flex justify-content-end",children:l(m,{color:"info",size:"sm",children:"Create Jobposting from this job?"})})})]})})})]})})]})};G.propTypes={isVisible:f.bool,onClose:f.func,state:f.string,job:f.object};const H=()=>{const{userInformation:r}=t.useContext(s),[c,p]=t.useState([]),[u,f]=t.useState(!1),[y,j]=t.useState(!1),[C,x]=t.useState({}),[v,N]=t.useState("view"),[w,T]=t.useState(""),[$,P]=t.useState(1),[A,B]=t.useState(9),[D,H]=t.useState(0),[Q,Y]=t.useState(0),K=async e=>{try{f(!0);const a=e?await h(`/job/all?query=${e}&page=${$}&limit=${A}&sort=desc`):await h(`/job/all?page=${$}&limit=${A}&sort=desc`);switch(a.status){case 200:f(!1),p(a.data.data),P(a.data.currentPage),B(a.data.itemsPerPage),H(a.data.totalPages);break;case 404:f(!1),p([]),P(0),B(0),H(0);break;default:throw new Error(`Unexpected status code: ${a.status}`)}}catch(a){}};return t.useEffect((()=>{const e=setTimeout((()=>{w?K(w):K()}),500);return()=>clearTimeout(e)}),[w,$,D,Q]),l(o,{children:n(S,{children:[l(q,{className:"mb-3",children:n(k,{children:[l("h2",{children:"Jobs"}),l("small",{children:"You can management job request in this page or make your own that can be used as base for jobposting."})]})}),l(q,{children:l(k,{className:"mb-3 d-flex justify-content-end",children:l(m,{color:"primary",size:"sm",onClick:()=>{j(!0),N("create")},children:"Create"})})}),l(q,{className:"mb-3",children:l(k,{children:l(z,{children:n(E,{type:"text",id:"searchInput",name:"searchInput",placeholder:"Search...",children:[l(F,{}),l(m,{color:"primary",size:"sm",children:l(e,{icon:a})}),l(m,{color:"primary",size:"sm",onClick:()=>K(),children:l(e,{icon:i})})]})})})}),l(q,{className:"mb-3",children:l(k,{children:l(I,{children:l(O,{children:n(L,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[l(V,{children:n(_,{children:[l(J,{children:"#"}),l(J,{children:"Title"}),l(J,{children:"Capacity"}),l(J,{children:"Author"}),l(J,{children:"Actions"})]})}),l(R,{children:u?l(_,{children:l(M,{colSpan:"12",children:n("div",{className:"d-flex justify-content-center",children:[l(d,{size:"sm"})," ",l("span",{children:"Loading..."})]})})}):0===c.length?l(_,{children:l(M,{colSpan:"12",children:l("div",{className:"d-flex justify-content-center",children:"No Jobs found."})})}):c.map((e=>n(_,{children:[l(U,{position:"top",content:e._id,children:l(M,{children:b(e._id,10)})}),l(M,{children:e.title}),l(M,{children:e.capacity}),n(M,{children:["string"==typeof e.author?e.author:e.author&&e.author.firstname?`${e.author.firstname} ${e.author.lastname}`:"Unknown"," "]}),l(M,{children:n("div",{className:"d-flex flex-row gap-2",children:[l(m,{color:"primary",size:"sm",onClick:()=>{x(e),j(!0),N("edit")},children:"Edit"}),l(m,{color:"primary",size:"sm",onClick:()=>{x(e),j(!0),N("view")},children:"View"}),["admin","manager","recruiter"].includes(r.role)&&l(m,{color:"warning",size:"sm",onClick:()=>{x(e),j(!0),N("edit")},children:"Manage"})]})})]},e._id)))})]})})})})}),l(q,{children:l(k,{children:l("div",{className:"d-flex flex-row gap-2 justify-content-center align-items-center",children:l(g,{currentPage:$,totalPages:D,onPageChange:P})})})}),l(q,{children:l(k,{children:l(G,{isVisible:y,onClose:()=>{j(!1),K()},state:v,job:C})})})]})})};export{H as default};
