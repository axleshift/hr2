import{R as e}from"./react-router-dom-BnDDw25P.js";import{F as t,I as a,J as l,_ as r,a2 as n}from"./index.es-DFhey9wz.js";import{f as s,t as m}from"./index-BxAblS3e.js";import{A as c}from"./AppPagination-vWC6_7LU.js";import{l as i,f as o,i as u,v as E,w as d,r as p}from"./index-DXFVtbD_.js";import{z as f}from"./zod-B0zZW6rS.js";import{u as y}from"./react-hook-form-DGCwHb0C.js";import{s as g}from"./@hookform/resolvers/zod-B5rlnuQ9.js";import{C as b}from"./CContainer-CzB7k1pT.js";import{C as N,a as v}from"./CRow-DSqRsHFr.js";import{C,a as S,c as j}from"./CFormInput-BzSWZSHN.js";import{C as x}from"./CInputGroup-8Ah49MHR.js";import{C as h,a as A}from"./CCardBody-D4Qo47mg.js";import{C as w,a as V,b as _,c as U,d as Y,e as k}from"./CTable-CpB37DUJ.js";import{C as D}from"./CButtonGroup-BpxNmVVV.js";import{C as M}from"./CTooltip-BHXnOH2f.js";import{C as F,a as I,b as P}from"./CModalHeader-CKCWLB_J.js";import{C as R}from"./CInputGroupText-B_3Av2bq.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";import"./isRTL-D5ORmfro.js";import"./getTransitionDurationFromElement-2nBpLMKS.js";import"./DefaultLayout-k-e4BEYF.js";import"./index.esm-JaDbXk68.js";const z=()=>{const{addToast:z}=e.useContext(i),[T,L]=e.useState([]),[G,O]=e.useState(null),[$,q]=e.useState(!1),[B,H]=e.useState([]),[J,K]=e.useState(!1),[Q,W]=e.useState(!1),[X,Z]=e.useState(!1),[ee,te]=e.useState(!1),[ae,le]=e.useState(""),[re,ne]=e.useState(!1),[se,me]=e.useState(!1),[ce,ie]=e.useState(!1),[oe,ue]=e.useState(!1),[Ee,de]=e.useState(1),[pe,fe]=e.useState(9),[ye,ge]=e.useState(0),[be,Ne]=e.useState(0),ve=f.object({_id:f.string().optional(),firstname:f.string().min(3,{message:"Firstname must be at least 3 characters"}),lastname:f.string().min(3,{message:"Lastname must be at least 3 characters"}),email:f.string().email("Invalid email address"),username:f.string().min(3,{message:"Username must be at least 3 characters"}),password:f.string().min(8,{message:"Password must be at least 8 characters"}),role:f.string().min(3,{message:"Role must be at least 3 characters"}),status:f.string().optional(),emailVerifiedAt:f.string().optional().transform((e=>{if(e)return"not verified";const t=new Date(e);return s(t,"MMM DD, YYYY")}))}),{register:Ce,reset:Se,handleSubmit:je,formState:{errors:xe}}=y({resolver:g(ve)}),he=async(e="",t,a)=>{try{const e=await E(`/account/all?page=${t}&limit=${a}`);200===e.status?(L(e.data.data),H((()=>{const t={};return e.data.data.forEach((e=>{t[e._id]=!1})),t})),Ne(e.data.totalItems),ge(e.data.totalPages),de(e.data.currentPage),q(!1)):z("Accounts | Users",e.message.message,"danger")}catch(l){z("Error","An error occurred","error")}};return e.useEffect((()=>{he("",Ee,pe)}),[Ee,pe]),e.createElement(e.Fragment,null,e.createElement(b,null,e.createElement(N,{className:"mb-3"},e.createElement(v,null,e.createElement("h2",null,"Users"),e.createElement("small",null,"In this page, you can view all the users in the system. You can also add, edit users, and as well as verify their accounts."))),e.createElement(N,{className:"mb-3"},e.createElement(v,null,e.createElement("div",{className:"d-flex justify-content-end"},e.createElement(o,{color:"primary",onClick:()=>{Se({_id:"",firstname:"",lastname:"",email:"",username:"",password:"",role:"",status:"inactive",emailVerifiedAt:null}),O(null),te(!1),K(!0)}},"Create")))),e.createElement(N,{className:"mb-3"},e.createElement(v,null,e.createElement(C,null,e.createElement(x,null,e.createElement(S,{type:"search",placeholder:"Search...","aria-label":"Search"}),e.createElement(o,{type:"button",color:"primary"},e.createElement(t,{icon:a})),e.createElement(o,{type:"button",color:"primary"},e.createElement(t,{icon:l,onClick:he})))))),e.createElement(N,{className:"mb-3"},e.createElement(v,null,e.createElement(h,null,e.createElement(A,null,e.createElement(w,{align:"middle",hover:!0,responsive:!0,striped:!0},e.createElement(V,null,e.createElement(_,null,e.createElement(U,null,"#"),e.createElement(U,null,"Firstname"),e.createElement(U,null,"Lastname"),e.createElement(U,null,"Email"),e.createElement(U,null,"Username"),e.createElement(U,null,"Role"),e.createElement(U,null,"Verified"),e.createElement(U,null,"View"))),e.createElement(Y,null,$?e.createElement(_,null,e.createElement(k,{colSpan:"8",className:"text-center"},e.createElement(u,null))):0===T.length?e.createElement(_,null,e.createElement(k,{colSpan:"8",className:"text-center"},"No users found.")):T.map(((t,a)=>e.createElement(_,{key:t._id},e.createElement(k,null,m(t._id,10)),e.createElement(k,null,m(t.firstname,25)),e.createElement(k,null,m(t.lastname,25)),e.createElement(k,null,t.email),e.createElement(k,null,t.username),e.createElement(k,null,t.role),e.createElement(k,null,t.emailVerifiedAt?s(t.emailVerifiedAt,"MMM DD, YYYY"):e.createElement("span",{className:"text-danger"},"Not verified")),e.createElement(k,null,e.createElement(D,null,e.createElement(M,{content:"View"},e.createElement(o,{color:"info",size:"sm",onClick:()=>{(async e=>{H((t=>({...t,[e._id]:!0})));try{const t=await E(`/account/${e._id}`);200===t.status?(O(t.data.data),Se({...t.data.data,password:""}),te(!0),K(!0),z("Success","User fetched successfully","success"),H((t=>({...t,[e._id]:!1})))):(z("Error","An error occurred","error"),H((t=>({...t,[e._id]:!1}))))}catch(t){z("Error","An error occurred","error"),H((t=>({...t,[e._id]:!1})))}})(t)},disabled:B[t._id]},B[t._id]?e.createElement(u,{color:"white",size:"sm"}):"View"))))))))))))),!$&&e.createElement(N,null,e.createElement(v,{className:"d-flex justify-content-center"},e.createElement(c,{currentPage:Ee,totalPages:ye,onPageChange:e=>de(e)}))),e.createElement(N,null,e.createElement(v,null,e.createElement(F,{visible:J,backdrop:"static",onClose:()=>{K(!1),ie(!1)},size:"lg"},e.createElement(I,null,e.createElement("strong",null,ee?"Edit":"Create"," User")),e.createElement(P,null,e.createElement(C,{onSubmit:je((async e=>{try{const t=ee?await d(`/account/${e._id}`,e):await p("/account",e);200===t.status||201===t.status?(z("Success",ee?"User updated successfully":"User created successfully","success"),K(!1)):z("Error",t.message.message,"error")}catch(t){z("Error","An error occurred"," error")}}))},e.createElement(N,{className:"mb-3 visually-hidden"},e.createElement(v,null,e.createElement(j,null,"Id"),e.createElement(S,{type:"text",...Ce("_id"),readOnly:!0}))),e.createElement(N,{className:"mb-3",xs:{cols:1,gutter:2},md:{cols:2,gutter:2}},e.createElement(v,null,e.createElement(j,null,"Firstname"),e.createElement(S,{type:"text",...Ce("firstname")})),e.createElement(v,null,e.createElement(j,null,"Lastname"),e.createElement(S,{type:"text",...Ce("lastname")}))),e.createElement(N,{className:"mb-3",xs:{cols:1,gutter:2},md:{cols:3,gutter:2}},e.createElement(v,null,e.createElement(j,null,"Email"),e.createElement(S,{type:"email",...Ce("email")})),e.createElement(v,null,e.createElement(j,null,"Username"),e.createElement(S,{type:"text",...Ce("username")})),e.createElement(v,null,e.createElement(j,null,"Password"),e.createElement(x,null,e.createElement(S,{type:"text",...Ce("password")})))),ee&&e.createElement(N,{className:"mb-3"},e.createElement(v,null,e.createElement(j,null,"Role"),e.createElement(S,{type:"text",...Ce("role")})),e.createElement(v,null,e.createElement(j,null,"Account Status"),e.createElement("br",null),e.createElement(S,{type:"text",...Ce("status"),readOnly:!0})),e.createElement(v,null,e.createElement(j,null,"Email Verified At"),e.createElement(x,null,e.createElement(S,{type:"text",defaultValue:(null==G?void 0:G.emailVerifiedAt)?s(null==G?void 0:G.emailVerifiedAt,"MMM DD, YYYY"):"Not verified",readOnly:!0}),e.createElement(R,null,(null==G?void 0:G.emailVerifiedAt)?e.createElement(t,{icon:r,color:"green"}):e.createElement(M,{content:"Verify?"},e.createElement(t,{icon:n,color:"red"})))))),e.createElement(N,{className:"mb-3"},e.createElement(v,null,e.createElement("div",{className:"d-flex justify-content-end"},ee?e.createElement(e.Fragment,null,e.createElement(o,{type:"submit",color:"primary",className:"me-2"},"Update"),"active"===(null==G?void 0:G.status)?e.createElement(o,{color:"danger",className:"me-2",onClick:()=>{W(!0),K(!1)}},"Suspend"):e.createElement(o,{color:"success",className:"me-2",onClick:()=>{Z(!0),K(!1)},disabled:!(null==G?void 0:G.emailVerifiedAt)},"Activate")):e.createElement(o,{type:"submit",color:"primary",className:"me-2"},re?e.createElement(u,{color:"white",size:"sm"}):"Add")))),!(null==G?void 0:G.emailVerifiedAt)&&e.createElement(N,{className:"mb-3"},e.createElement(v,null,e.createElement("div",{className:"d-flex justify-content-end"},e.createElement(o,{color:"success",className:"me-2",onClick:()=>{me(!0),setTimeout((()=>{ie(!0),me(!1)}),2e3)},disabled:ce||se},se?e.createElement(u,{color:"white",size:"sm"}):ce?e.createElement("span",null,"Verification Sent",e.createElement(t,{icon:r,className:"ms-2"})):"Send Verification")),!(null==G?void 0:G.emailVerifiedAt)&&e.createElement("div",{className:"d-flex justify-content-end mt-3"},e.createElement("small",null,e.createElement("span",{className:"text-danger"},"Note"),": User cannot be activated until email is verified."))))))))),e.createElement(N,null,e.createElement(v,null,e.createElement(F,{visible:Q,backdrop:"static",onClose:()=>{W(!1),K(!0)}},e.createElement(I,null,e.createElement("strong",null,"Suspend / Deactivate User")),e.createElement(P,null,e.createElement(C,null,e.createElement(N,{className:"mb-3"},e.createElement(v,null,e.createElement(j,null,"Reason (required)"),e.createElement(S,{type:"text"}))),e.createElement(N,{className:"mb-3"},e.createElement(v,null,e.createElement("div",{className:"d-flex justify-content-end"},e.createElement(o,{color:"primary",className:"me-2"},"Suspend"))))))))),e.createElement(N,null,e.createElement(v,null,e.createElement(F,{visible:X,onClose:()=>{Z(!1),K(!0)}},e.createElement(I,null,e.createElement("strong",null,"Activate User")),e.createElement(P,null,e.createElement(C,null,e.createElement(N,{className:"mb-3"},e.createElement(v,null,e.createElement(j,null,"Reason (required)"),e.createElement(S,{type:"text"}))),e.createElement(N,{className:"mb-3"},e.createElement(v,null,e.createElement("div",{className:"d-flex justify-content-end"},e.createElement(o,{color:"primary",className:"me-2"},"Activate")))))))))))};export{z as default};
