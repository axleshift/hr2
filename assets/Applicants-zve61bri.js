import{m as e,j as a,a as t,g as i,k as n,w as r,p as c,F as l}from"./index-D-GnuKZU.js";import{F as s,B as d,C as o,V as h,f as m,U as p}from"./index.es-BR7Rjtum.js";import{R as u,r as f}from"./react-router-dom-BnDDw25P.js";import{A as g}from"./AppPagination-CNyQjqz2.js";import{z as N}from"./zod-B0zZW6rS.js";import{u as v}from"./react-hook-form-DB8hWBdy.js";import{s as y}from"./@hookform/resolvers/zod-1wp20Skh.js";import{C as x}from"./Calendar-CzCejKxu.js";import{U as C,f as S,t as b,c as j}from"./index-DCO1bnrX.js";import{C as w,a as _,b as T}from"./CModalHeader-DQJDo40N.js";import{C as k}from"./CModalTitle-HFeZ3kaT.js";import{C as A}from"./CContainer-m_k2ePgi.js";import{C as D,a as P}from"./CRow-Cw4eeKIx.js";import{C as F}from"./CFormInput-Dn-iE12k.js";import{C as E,a as I,b as R,c as M}from"./CTabList-B5K2uO10.js";import{a as $,C as z}from"./DefaultLayout-DhgmFM8H.js";import{C as L,a as K}from"./CFormLabel-CNa7kd_d.js";import{C as V}from"./CInputGroup-CgKedWGZ.js";import{C as q}from"./CTooltip-BDYXaFVj.js";import{C as H,a as Y,b as O,c as B,d as G,e as U}from"./CTable-Dt26rGib.js";import{C as W,a as J}from"./CCardBody-BNtC-I3D.js";import"./react-dom-DgB6LS8R.js";import"./react-BF1r7_8g.js";import"./index.esm-Bak_xBZl.js";import"./isRTL-D5ORmfro.js";const Q=({isVisible:c,onClose:l,isDarkMode:o,applicantData:h})=>{const{addToast:m}=u.useContext(e),[p,N]=f.useState({}),[v,y]=f.useState(!1),[z,K]=f.useState(C(new Date)),[W,J]=f.useState([]),[Q,X]=f.useState([]),[Z,ee]=f.useState([]),[ae,te]=f.useState([]),[ie,ne]=f.useState(1),[re,ce]=f.useState(10),[le,se]=f.useState(1),de=e=>e.sort(((e,a)=>{const t=new Date(e.date)-new Date(a.date);if(0!==t)return t;const i=e.timeslot.start.split(":").map(Number),n=a.timeslot.start.split(":").map(Number);return 60*i[0]+i[1]-(60*n[0]+n[1])})),oe=e=>{ee((a=>({...a,[e]:!a[e]})))};return f.useEffect((()=>{(async e=>{y(!0);try{const a=await r(`/interview/all?date=${e}&page=${ie}&limit=${re}`);if(200===a.status){const e=de(a.data.data);J(e),ee(new Array(a.data.data.length).fill(!1)),ne(a.data.currentPage),se(a.data.totalPages),y(!1)}else y(!1),m("Calendar | Scheduling Form",a.message.message,"danger")}catch(a){y(!1)}})(z)}),[z,ie,re]),f.useEffect((()=>{h&&N(h)}),[h]),a(w,{visible:c,onClose:()=>{l(),K(C(new Date)),te([])},size:"xl",children:[t(_,{children:t(k,{children:a("div",{children:["Schedule Interview for"," ",a("span",{className:"fw-bold",children:[null==h?void 0:h.lastname,", ",null==h?void 0:h.firstname]})]})})}),t(T,{children:a(A,{children:[t(D,{className:"mb-3",children:t(P,{children:t("div",{children:t(x,{onChange:e=>{K(e)},defaultValue:z,className:o?"calendar dark-mode":"calendar"})})})}),t(D,{className:"mb-3",children:t(P,{children:t(F,{type:"text",id:"date",name:"date",placeholder:"Date",value:S(z),readOnly:!0})})}),t(D,{className:"mb-3",children:a(P,{children:[t("h2",{children:"Events"}),a("small",{children:["Pick an event to schedule an interview for"," ",a("span",{className:"text-info",children:[null==h?void 0:h.lastname,", ",null==h?void 0:h.firstname]})]})]})}),t(D,{className:"mb-3",children:t(P,{children:a(E,{activeItemKey:"events",children:[a(I,{variant:"underline-border",children:[t(R,{itemKey:"events",children:"Events"}),t(R,{itemKey:"applicant",children:"Applicantâ€˜s Events"})]}),a($,{children:[a(M,{itemKey:"events",children:[t("div",{className:"my-3",children:t(L,{children:a(V,{children:[t(F,{type:"text",id:"search",name:"search",placeholder:"Search"}),t(q,{content:"Search for events",placement:"top",children:t(i,{color:"primary",children:t(s,{icon:d})})})]})})}),a(H,{align:"middle",responsive:!0,children:[t(Y,{children:a(O,{children:[t(B,{className:"text-center",children:"#"}),t(B,{className:"text-center",children:"Title"}),t(B,{className:"text-center",children:"Capacity"}),t(B,{className:"text-center",children:"Participants"}),t(B,{className:"text-center",children:"Timeslot"}),t(B,{className:"text-center",children:"Actions"})]})}),t(G,{children:v?t(O,{children:t(U,{colSpan:"7",className:"text-center",children:t(n,{color:"primary",variant:"grow"})})}):0===W.length?t(O,{children:t(U,{colSpan:"7",className:"text-center",children:"No data found"})}):W.map(((e,n)=>e.participants.includes(h._id)?null:a(u.Fragment,{children:[a(O,{children:[t(U,{className:"text-center",children:b(e._id,3)}),t(U,{className:"text-center",children:e.title}),t(U,{className:"text-center",children:e.capacity}),t(U,{className:"text-center",children:e.participants.length}),t(U,{className:"text-center",children:a("small",{children:[j(e.timeslot.start)," -"," ",j(e.timeslot.end)]})}),t(U,{className:"text-center",children:a(V,{children:[t(i,{color:"primary",size:"sm",disabled:e.participants.length>=e.capacity||e.participants.includes(h._id)||!!ae.find((a=>a._id===e._id)),onClick:()=>(async e=>{try{if(ae.find((a=>a._id===e._id)))return;const a=de([...ae,e]);te(a)}catch(a){}})(e),children:e.participants.length>=e.capacity?"Full":e.participants.includes(h._id)||ae.find((a=>a._id===e._id))?"Added":"Add"}),t(i,{color:"info",size:"sm",onClick:()=>oe(n),children:Z[n]?"Hide":"Show"})]})})]}),Z[n]&&t(O,{children:a(U,{colSpan:"7",children:[t("h6",{children:"Addditional Information"}),t("p",{children:e.additionalInfo}),t("h6",{children:"Location"}),t("p",{children:e.location})]})})]},e._id)))})]}),t("div",{className:"d-flex align-items-center justify-content-center",children:t(g,{currentPage:ie,totalPages:le,onPageChange:ne})})]}),a(M,{itemKey:"applicant",children:[a(H,{align:"middle",responsive:!0,children:[t(Y,{children:a(O,{children:[t(B,{className:"text-center",children:"#"}),t(B,{className:"text-center",children:"Title"}),t(B,{className:"text-center",children:"Date"}),t(B,{className:"text-center",children:"Timeslot"}),t(B,{className:"text-center",children:"Actions"})]})}),t(G,{children:v?t(O,{children:t(U,{colSpan:"7",className:"text-center",children:t(n,{color:"primary",variant:"grow"})})}):0===ae.length?t(O,{children:t(U,{colSpan:"7",className:"text-center",children:"No data found"})}):ae.map(((e,n)=>e.participants.includes(h._id)?null:a(u.Fragment,{children:[a(O,{children:[t(U,{className:"text-center",children:b(e._id,3)}),t(U,{className:"text-center",children:e.title}),t(U,{className:"text-center",children:S(e.date,"MMMM DD, YYYY")}),t(U,{className:"text-center",children:a("small",{children:[j(e.timeslot.start)," -"," ",j(e.timeslot.end)]})}),t(U,{className:"text-center",children:a(V,{children:[t(i,{color:"danger",size:"sm",disabled:e.participants.length>=e.capacity,onClick:()=>(async e=>{try{te((a=>a.filter((a=>a._id!==e._id))))}catch(a){}})(e),children:"Remove"}),t(i,{color:"info",size:"sm",onClick:()=>oe(n),children:Z[n]?"Hide":"Show"})]})})]}),Z[n]&&t(O,{children:a(U,{colSpan:"7",children:[t("h6",{children:"Addditional Information"}),t("p",{children:e.additionalInfo}),t("h6",{children:"Location"}),t("p",{children:e.location})]})})]},e._id)))})]}),a("div",{children:[a("small",{children:[t("span",{className:"text-danger",children:"Note:"})," Events added here will be scheduled for the applicant once the form is submitted."]}),t("br",{}),a("small",{children:[t("span",{className:"text-danger",children:"Warning:"})," Once closed, the events will be resetted. Make sure to submit the form before closing."]})]}),t("div",{className:"d-flex justify-content-end",children:t(i,{className:"btn btn-primary",children:"Submit"})})]})]})]})})})]})})]})};Q.propTypes={isVisible:c.bool.isRequired,onClose:c.func.isRequired,isDarkMode:c.bool.isRequired,applicantData:c.object};const X=({theme:c})=>{const u="dark"===c,{addToast:x}=f.useContext(e),[C,S]=f.useState(!1),[b,j]=f.useState([]),[w,_]=f.useState(!1),[T,k]=f.useState([]),[E,I]=f.useState({}),[R,M]=f.useState(!1),[$,X]=f.useState([]),[Z,ee]=f.useState(!1),[ae,te]=f.useState(""),[ie,ne]=f.useState(1),[re,ce]=f.useState(9),[le,se]=f.useState(1),de=async(e,a,t)=>{try{_(!0);let i="";$.length>0&&(i=$.map((e=>`${e}`)).join(","));const n=Z?await r(`/applicant/search?query=${t}&page=${e}&limit=${a}&tags=${i}`):await r("/applicant/all");200===n.status?(k(n.data.data),se(n.data.totalPages),_(!1)):(x("Error","Failed to fetch data","danger"),_(!1))}catch(i){x("Error","Failed to fetch data","danger")}},oe=N.object({searchTerm:N.string().min(1,"Search term is required")}),{register:he,handleSubmit:me,formState:{errors:pe}}=v({resolver:async(e,a,t)=>await y(oe)(e,a,t)});return f.useEffect((()=>{(async()=>{try{S(!0);const e="applicant",a=await r(`/tags/category/${e}`);200===a.status?(j(a.data.data),S(!1)):(x("Calendar | Applicants",a.message.message,"danger"),S(!1))}catch(e){x("Calendar | Applicants","Failed to fetch data","danger")}})();const e=setTimeout((()=>{de(ie,re,ae)}),300);return()=>clearTimeout(e)}),[ie,re,Z,ae]),t(l,{children:a(A,{className:"d-flex flex-column gap-3",children:[t(D,{children:a(P,{children:[t("h2",{children:"Applicants"}),t("small",{children:"In this page, you can view and edit the list of applicants which are waiting for the HR to schedule an interview or any event they need to attend."})]})}),t(D,{children:a(A,{className:"d-flex flex-column gap-3",children:[a(L,{onSubmit:me((e=>{const{searchTerm:a}=e;k([]),te(a),ee(!0),ne(1),de(ie,re,a)})),children:[a(V,{children:[t(F,{type:"text",placeholder:"Search",...he("searchTerm"),invalid:!!pe.searchTerm}),t(q,{placement:"top",content:"Search",children:t(i,{type:"submit",color:"primary",children:t(s,{icon:d})})}),t(q,{placement:"top",content:"Refresh",children:t(i,{color:"primary",onClick:()=>(te(""),ee(!1),ne(1),void de(ie,re)),children:t(s,{icon:o})})})]}),pe.searchTerm&&t(K,{invalid:!0,children:pe.searchTerm.message})]}),t("div",{className:"d-flex flex-wrap gap-2",children:b.map((e=>t(q,{content:$.includes(e._id)?"Remove":"Add",children:a(z,{onClick:()=>(e=>{if($.includes(e)){const a=$.filter((a=>a!==e));X(a)}else X([...$,e])})(e._id),color:$.includes(e._id)?"success":"danger",className:"d-flex align-items-center justify-content-between",children:[e.name,$.includes(e._id)&&t(s,{icon:h,className:"ms-2"})]})},e._id)))})]})}),t(D,{children:t(A,{children:t(W,{children:t(J,{children:a(H,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[t(Y,{children:a(O,{children:[t(B,{children:t(s,{icon:m})}),t(B,{children:"Email"}),t(B,{children:"Phone"}),t(B,{children:"Tags"}),t(B,{children:"Action"})]})}),t(G,{children:w?t(O,{children:t(U,{colSpan:5,children:t("div",{className:"pt-3 text-center",children:t(n,{color:"primary",variant:"grow"})})})}):T.length>0?T.map((e=>a(O,{children:[t(U,{children:a("div",{children:[e.lastname,", ",e.firstname]})}),t(U,{children:t("div",{children:e.email})}),t(U,{children:t("div",{children:e.phone})}),t(U,{children:t("div",{className:"d-flex gap-2",children:e.tags.map(((e,a)=>t(z,{color:"primary",children:b.find((a=>a._id===e))&&b.find((a=>a._id===e)).name},a)))})}),t(U,{children:t(q,{placement:"top",content:"Schedule Interview for this applicant",children:t(i,{onClick:()=>(async e=>{try{M(!0);const a=T.find((a=>a._id===e));I(a)}catch(a){x("Error","Failed to fetch data","danger")}})(e._id),className:"btn btn-primary",size:"sm",children:t(s,{icon:p})})})})]},e._id))):t(O,{children:t(U,{colSpan:5,children:"No data available"})})})]})})})})}),t(D,{children:t(P,{children:t("div",{className:"d-flex justify-content-center align-items-center",children:t(g,{currentPage:ie,totalPages:le,onPageChange:ne})})})}),t(D,{children:t(P,{children:t(Q,{isVisible:R,onClose:()=>M(!1),isDarkMode:u,applicantData:E})})})]})})};X.propTypes={theme:c.string};export{X as default};
