import{r as e}from"./react-router-dom-BnDDw25P.js";import{m as a,A as t,j as i,a as s,k as r,g as o,F as n,w as l,y as d,p as c}from"./index-qHb5tAdx.js";import{z as m}from"./zod-B0zZW6rS.js";import{u as p}from"./react-hook-form-DB8hWBdy.js";import{s as u}from"./@hookform/resolvers/zod-1wp20Skh.js";import{F as f,U as b}from"./index.es-DYre-5ez.js";import{f as h}from"./index-BOi-5bX2.js";import{C as y,a as v,b as j}from"./CModalHeader-beeSvsCt.js";import{C as g}from"./CModalTitle-IUT3VrW5.js";import{C,a as D}from"./CRow-DYavEpjv.js";import{C as S,a as w,b as T}from"./CFormLabel-UDpH3Qx3.js";import{C as N}from"./CFormInput-DF5LQCIp.js";import{C as x}from"./CTooltip-CljDTM0A.js";import{C as O}from"./CFormSelect-4-wAhThw.js";import{C as F}from"./CFormTextarea-DP8Q6-6q.js";import{C as k}from"./CFormCheck-Didiv9Pq.js";const z=["Pending","Accepted","Declined"],A=["Contractual","Regular","Temporary","Freelance"],B=m.object({position:m.string().min(1).max(30),salary:m.coerce.number().min(1).default(1),startDate:m.string().refine((e=>!isNaN(Date.parse(e))),{message:"Invalid date"}),benefits:m.string().min(1,{message:"Benefits are required"}),jobType:m.enum(A),contractDuration:m.string().optional(),location:m.string().min(1,{message:"Location is required"}),status:m.enum(z),notes:m.string().optional()}),L=({isVisible:c,onClose:m,state:L,joboffer:J,applicantData:R})=>{const{addToast:I}=e.useContext(a),{userInformation:$}=e.useContext(t),[q,_]=e.useState([]),[E,M]=e.useState(!1),[P,U]=e.useState({}),[V,W]=e.useState(!1),[H,G]=e.useState(!1),[K,Q]=e.useState(!1),[X,Y]=e.useState("view"),[Z,ee]=e.useState(!1),[ae,te]=e.useState(!1),{register:ie,handleSubmit:se,reset:re,setValue:oe,formState:{errors:ne}}=p({resolver:async(e,a,t)=>await u(B)(e,a,t)});return e.useEffect((()=>{c&&(ee(c),q&&_(R),J?(U(J),_(J.applicant),re({position:J.position??"No Data",startDate:J.startDate?new Date(J.startDate).toISOString().split("T")[0]:"No Data",salary:J.salary,status:J.status??"Pending",benefits:J.benefits,notes:J.notes,jobType:J.jobType??"Regular",contractDuration:J.contractDuration??"",location:J.location??""})):re({position:q.jobAppliedFor,location:q.preferredWorkLocation}))}),[c,J,X]),e.useEffect((()=>{L&&Y(L)}),[L]),i(y,{visible:Z,size:"lg",onClose:()=>{m(),ee(!1)},backdrop:"static",children:[s(v,{children:s(g,{className:"text-capitalize",children:"edit"===X?"Update Job Offer":"Create Job Offer"})}),s(j,{children:s(C,K?{children:i(D,{children:[s(r,{size:"sm"})," Loading.."]})}:{children:s(D,{children:i(S,{onSubmit:se((async e=>{try{W(!0);const a={position:e.position,salary:e.salary,startDate:e.startDate,benefits:e.benefits,notes:e.notes,jobType:e.jobType,contractDuration:e.contractDuration,location:e.location,status:e.status},t=q._id,i="edit"===X?await d(`/applicant/joboffer/${P._id}?isApproved=${ae}`,a):await l(`/applicant/joboffer/${t}`,a);200===i.status||201===i.status?(I("Success",i.data.message,"success"),Y("edit"),U(i.data.data),re(i.data.data)):I("Error",i.message.message,"danger"),m()}catch(a){}finally{W(!1)}})),children:[s(C,{children:s(D,{children:i("h4",{children:[q.lastname,", ",q.firstname," ",q.middlename," ",q.suffix&&q.suffix]})})}),i(C,{className:"mb-3",children:[i(D,{children:[s(N,{label:"Position / Job Applied For",...ie("position"),invalid:!!ne.position,readOnly:["view","edit","create"].includes(X)}),ne.position&&s(w,{invalid:!0,children:ne.position.message})]}),i(D,{children:[s(N,{type:"number",label:"Salary per month",...ie("salary",{valueAsNumber:!0}),invalid:!!ne.salary,readOnly:["view"].includes(X)}),ne.salary&&s(w,{invalid:!0,children:ne.salary.message})]})]}),i(C,{className:"mb-3",children:[i(D,{children:[s(x,{placement:"top",content:"When the new hire is expected to start.",children:s(T,{children:"Start Date"})}),s(N,{type:"date",...ie("startDate"),readOnly:["view"].includes(X)}),ne.startDate&&s(w,{invalid:!0,children:ne.startDate.message})]}),i(D,{children:[s(O,{label:"Job Type",...ie("jobType"),invalid:!!ne.jobType,disabled:["view"].includes(X),children:A.map(((e,a)=>s("option",{value:e,children:e},a)))}),ne.jobType&&s(w,{invalid:!0,children:ne.jobType.message})]})]}),i(C,{className:"mb-3",children:[i(D,{children:[s(O,{label:"Offer Status",...ie("status"),invalid:!!ne.status,disabled:["view"].includes(X),children:z.map(((e,a)=>s("option",{value:e,children:e},a)))}),ne.status&&s(w,{invalid:!0,children:ne.status.message})]}),i(D,{children:[s(N,{label:"Location",...ie("location"),invalid:!!ne.location,readOnly:["view"].includes(X)}),ne.location&&s(w,{invalid:!0,children:ne.location.message})]})]}),s(C,{className:"mb-3",children:i(D,{children:[s(F,{label:"Benefits",rows:6,...ie("benefits"),readOnly:["view"].includes(X),invalid:!!ne.benefits}),ne.benefits&&s(w,{invalid:!0,children:ne.benefits.message})]})}),s(C,{className:"mb-3",children:i(D,{children:[s(F,{label:"Notes",rows:6,...ie("notes"),readOnly:["view"].includes(X)}),ne.notes&&s(w,{invalid:!0,children:ne.notes.message})]})}),!(null==J?void 0:J.approvedBy)&&s(C,{children:s(D,{children:s(o,{color:ae?"primary":"secondary",size:"sm",onClick:()=>te(!ae),children:ae?"Approve":"Disapprove"})})}),s(C,{children:s(D,{className:"d-flex justify-content-end",children:s(k,{label:"I confirm that details above are correct and true.",defaultChecked:!E,onChange:()=>M(!E)})})}),i(C,{children:[(null==J?void 0:J.approvedBy)&&s(D,{children:i("p",{children:["Approved Date: ",h(P.approvedDate),s("br",{}),"Approved By:"," ",(P.approvedBy.lastname,P.approvedBy.firstname)]})}),i(D,{className:"d-flex justify-content-end gap-2",children:[!(null==J?void 0:J.emailSent)&&(null==J?void 0:J.approvedBy)&&i(o,{color:"info",size:"sm",disabled:E||V||H,onClick:()=>(async e=>{try{G(!0);const a=await l(`/applicant/joboffer/send-email/${e}`);200===a.status&&I("Success",a.data.message,"success")}catch(a){}finally{G(!1)}})(J._id),children:[s(f,{icon:b,className:"me-2"}),H?"Loading... ":"Send Job offer Mail"]}),s(o,{type:"submit",color:"primary",size:"sm",disabled:E||V,children:V?i(n,{children:[s(r,{size:"sm"})," Loading..."]}):"edit"===X?"Update":"Submit"})]})]})]})})})})]})};L.propTypes={isVisible:c.bool.isRequired,onClose:c.func.isRequired,state:c.string,joboffer:c.object,applicantData:c.object};export{L as J};
