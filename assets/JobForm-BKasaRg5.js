import{r as e}from"./react-router-dom-BnDDw25P.js";import{m as a,A as i,j as t,a as s,l as r,F as n,k as l,g as o,x as c,y as d,w as m,p}from"./index-DiLnYbjC.js";import{z as h}from"./zod-B0zZW6rS.js";import{u}from"./react-hook-form-DB8hWBdy.js";import{s as b}from"./@hookform/resolvers/zod-1wp20Skh.js";import"./index-BOi-5bX2.js";import{C as f,a as y,b as g}from"./CModalHeader-BDpLr51j.js";import{C as v}from"./CModalTitle-Cp-5Mm7J.js";import{C}from"./CContainer-DzOuZpEx.js";import{C as j,a as x}from"./CRow-BNc0QFWW.js";import{C as q,a as N,b as w}from"./CFormLabel-DwEY-V3u.js";import{C as S}from"./CFormInput-uT5SP9Ht.js";import{C as O}from"./CFormTextarea-D1VEMpzQ.js";import{C as F}from"./CFormSelect-C1vm9vYc.js";const z=["internship","full-time","part-time","contract","temporary","freelance"],k=h.object({title:h.string().min(3).max(50),responsibilities:h.string().min(3).max(250),requirements:h.string().min(3).max(250),qualifications:h.string().min(3).max(250),benefits:h.string().min(3).max(250),category:h.enum(z),capacity:h.number().min(1).default(1)}),T=({isVisible:p,onClose:h,state:T,job:E})=>{const{addToast:R}=e.useContext(a),{userInformation:V}=e.useContext(i),[A,I]=e.useState(!1),[J,L]=e.useState(!1),[M,$]=e.useState(!1),{register:_,watch:H,handleSubmit:U,reset:B,formState:{errors:D},setValue:P}=u({resolver:async(e,a,i)=>await b(k)(e,a,i)});return e.useEffect((()=>{p&&E&&"edit"===T?(async()=>{try{$(!0);const e=await c(`/job/${E._id}`);200===e.status&&($(!1),B(e.data.data))}catch(e){}})():$(!1)}),[E,p,T]),e.useEffect((()=>{L("edit"!==T&&"create"!==T)}),[T]),t(f,{visible:p,onClose:()=>{h(),(async()=>{B({title:"",responsibilities:"",requirements:"",qualifications:"",benefits:"",category:"temporary",capacity:1})})()},size:"lg",children:[s(y,{children:s(v,{children:"create"===T?"Create job":"Manage Job"})}),s(g,{children:t(C,{children:["development"===r.env,s(j,{children:s(x,{children:M?t(n,{children:[s(l,{size:"sm"}),s("span",{children:"Loading..."})]}):t(q,{onSubmit:U((async e=>{var a,i;try{const a=new FormData;let i;switch(a.append("title",e.title),a.append("responsibilities",e.responsibilities),a.append("requirements",e.requirements),a.append("qualifications",e.qualifications),a.append("benefits",e.benefits),a.append("category",e.category),a.append("capacity",e.capacity),T){case"create":i=await m("/job/",a);break;case"edit":i=await d(`/job/${E._id}`,a);break;default:throw new Error("Invalid form state")}200!==i.status&&201!==i.status||(R("Success",i.data.message,"success"),"create"===T&&h())}catch(t){R("Error",(null==(i=null==(a=null==t?void 0:t.response)?void 0:a.data)?void 0:i.message)||"Something went wrong","danger")}})),children:[s(j,{className:"mb-3",children:t(x,{children:[s(S,{type:"text",label:"Title",placeholder:"",readOnly:J,..._("title"),invalid:D.title}),D.title&&s(N,{invalid:!0,className:"text-danger",children:D.title.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(O,{type:"text",label:"Responsibilities",placeholder:"",readOnly:J,..._("responsibilities"),invalid:D.responsibilities}),D.responsibilities&&s(N,{invalid:!0,className:"text-danger",children:D.responsibilities.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(O,{type:"text",label:"Requirements",placeholder:"",readOnly:J,..._("requirements"),invalid:D.requirements}),D.requirements&&s(N,{invalid:!0,className:"text-danger",children:D.requirements.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(O,{type:"text",label:"Qualifications",placeholder:"",readOnly:J,..._("qualifications"),invalid:D.qualifications}),D.qualifications&&s(N,{invalid:!0,className:"text-danger",children:D.qualifications.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(O,{type:"text",label:"Benefits",placeholder:"",readOnly:J,..._("benefits"),invalid:D.benefits}),D.benefits&&s(N,{invalid:!0,className:"text-danger",children:D.benefits.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(w,{htmlFor:"category",children:"Category"}),t(F,{id:"category",readOnly:J,..._("category",{required:"Please select a category"}),invalid:!!D.category,children:[s("option",{value:"",children:"Select a category"}),z.map((e=>s("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))]}),D.category&&s(N,{invalid:!0,className:"text-danger",children:D.category.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(S,{type:"number",label:"Capacity",defaultValue:1,placeholder:"",readOnly:J,..._("capacity",{valueAsNumber:!0}),invalid:D.capacity}),D.capacity&&s(N,{invalid:!0,className:"text-danger",children:D.capacity.message})]})}),"view"!==T&&s(j,{className:"mb-3",children:s(x,{className:"d-flex justify-content-end",children:s(o,{type:"submit",color:"primary",size:"sm",children:"edit"===T?"Update":"Create"})})}),["admin","manager","recruiter"].includes(V.role)&&s(j,{children:s(x,{className:"d-flex justify-content-end",children:s(o,{color:"info",size:"sm",children:"Create Jobposting from this job?"})})})]})})})]})})]})};T.propTypes={isVisible:p.bool,onClose:p.func,state:p.string,job:p.object};export{T as J};
