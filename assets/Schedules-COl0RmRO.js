import{p as w,R as me,r as t,k as e,g as C,l as ge,o as Ce,G as be,F as he,I as Se,E as Pe}from"./index-Do00Xf1q.js";import{A as Le}from"./AppPagination-BPy9TJBn.js";import{F as p,f as Ve,W as He,V as Oe,O as ve,s as ye,X as $e,Y as Be,G as Ye,Z as _e,L as Ge,A as Ue}from"./index.es-BzpiLWIz.js";import{C as De}from"./Calendar-Uwm7ssAj.js";import{z as d,u as ne,t as le}from"./zod-aoyOoU2S.js";import{C as we,a as Te,b as Ne}from"./CModalHeader-H-yCRVKn.js";import{C as Ie}from"./CModalTitle-Dg08qJqD.js";import{C as re,a as g,c as S,b as xe}from"./CFormInput-CecjJPAh.js";import{C as o,a as m}from"./CRow-D1hWq1zB.js";import{C as y}from"./CInputGroup-DAPCj5pk.js";import{C as I}from"./CInputGroupText-BObEEOUX.js";import{C as Ee}from"./CModalFooter-DFlCFFUR.js";import{U as ie,c as v,f as L,t as ue}from"./index-VIXCwCyV.js";import{a as Ae,c as ze,d as Xe,e as We,f as Ze}from"./DefaultLayout-CxZzcknF.js";import{C as E}from"./CTooltip-Dl4soOsb.js";import{C as Je}from"./CFormTextarea-7B_CSPV1.js";import{C as Ke}from"./CFormCheck-CPuiwYTA.js";import{C as je}from"./CContainer-d0ABidlq.js";import{C as pe,a as fe}from"./CCardBody-BYA-vFkB.js";import{C as Qe,a as es,b as z,c as P,d as ss,e as N}from"./CTable-OnVTJ65J.js";import{C as ts}from"./CButtonGroup-s4pxcX5S.js";import"./clsx-B-dksMZM.js";import"./index.esm-Dbg3Sr3c.js";const Fe=({isVisible:A,onClose:F,handleTimeSubmit:T,isLoading:c})=>{const[X,x]=me.useState(!1),[j,f]=me.useState(!1),k=d.object({start:d.string().min(1,{message:"Start time is required"}),end:d.string().min(1,{message:"End time is required"})}),Y=()=>{F(),x(!1)},{register:D,handleSubmit:V,formState:{errors:h}}=ne({resolver:le(k)});return t.useEffect(()=>{x(A),f(c)},[A,c]),e.jsxs(we,{visible:A,onClose:Y,size:"sm",children:[e.jsx(Te,{children:e.jsx(Ie,{children:"Add Timeslot"})}),e.jsx(Ne,{children:e.jsxs(re,{onSubmit:V(T),children:[e.jsx(o,{children:e.jsx(m,{children:e.jsxs(y,{className:"mb-3",children:[e.jsx(I,{children:"Start Time"}),e.jsx(g,{type:"time",...D("start"),invalid:!!h.start}),h.start&&e.jsx(S,{invalid:!0,children:h.start.message})]})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsxs(y,{className:"mb-3",children:[e.jsx(I,{children:"End Time"}),e.jsx(g,{type:"time",...D("end"),invalid:!!h.end}),h.end&&e.jsx(S,{invalid:!0,children:h.end.message})]})})}),e.jsxs(Ee,{children:[e.jsx(C,{type:"submit",className:"btn btn-primary",children:j?e.jsx(ge,{color:"primary"}):"Add Time"}),e.jsx(C,{color:"secondary",onClick:F,children:"Cancel"})]})]})})]})};Fe.propTypes={isVisible:w.bool.isRequired,onClose:w.func.isRequired,handleTimeSubmit:w.func.isRequired,isLoading:w.bool.isRequired};const ke=({isVisible:A,onClose:F,isDarkMode:T,interviewData:c})=>{const X=new Date(new Date().setDate(new Date().getDate()-1)),{addToast:x}=t.useContext(Ce),[j,f]=t.useState(ie(new Date)),[k,Y]=t.useState(!1),[D,V]=t.useState(!1);t.useState({}),t.useState({}),t.useState("");const[h,_]=t.useState([]),[W,G]=t.useState([]),[oe,H]=t.useState(!1),[O,$]=t.useState(null),[Z,R]=t.useState(!1),[ce,de]=t.useState([new Date(2024,10,15),new Date(2024,10,20)]),[J,K]=t.useState([new Date(2024,10,1),new Date(2024,10,5)]);t.useState(1),t.useState(9),t.useState(1);const U=d.object({title:d.string().min(1,{message:"Title is required"}),date:d.preprocess(s=>new Date(s),d.date().min(X,{message:"Date should be today or later"})),timeslotId:d.string().optional(),start:d.string().min(1,{message:"Start time is required"}),end:d.string().min(1,{message:"End time is required"}),location:d.string().optional(),capacity:d.preprocess(s=>parseInt(s),d.number().min(1,{message:"Capacity should be at least 1"})),additionalInfo:d.string().optional()}),{register:b,handleSubmit:Q,reset:B,formState:{errors:l}}=ne({resolver:async(s,a,r)=>{const u=await le(U)(s,a,r);return console.log("Validation result:",u),u}}),ee=d.object({start:d.string().min(1,{message:"Start time is required"}),end:d.string().min(1,{message:"End time is required"})}).refine(async s=>{const[a,r]=s.start.split(":").map(Number),[u,ae]=s.end.split(":").map(Number),Re=a*60+r,qe=u*60+ae;return Re<qe},{message:"Start time should be before end time",path:["start"]});ne({resolver:async(s,a,r)=>{const u=await le(ee)(s,a,r);return console.log("Validation result:",u),u}});const q=async s=>{try{const a=await be(`/interview/slots?date=${s}`);if(a.status===200){const r=a.data;_(r.data);const u=r.data.filter(ae=>ae.isAvailable);G(u)}else x("Error","Failed to fetch time slots","danger")}catch(a){console.error(a),_([]),G([])}},se=async s=>{R(!0);try{const a=j;console.log(a,s);const r={date:a,timeslot:{start:s.start,end:s.end}},u=await he("/interview/slots/",r);console.log("res",u),u.status===200||u.status===201?(x("Success","Time slot added successfully","success"),q(j),R(!1)):(x("Error",u.message.message,"danger"),R(!1))}catch(a){console.error(a),R(!1)}},n=async s=>{try{const a=await Se(`/interview/slot/${s}`);console.log("handleDeleteTimeslot -> Result",a),a.status===200?(x("Success","Time slot deleted successfully","success"),q(j)):x("Error","Something went wrong. Unable to delete time slot.","danger")}catch(a){console.error(a)}},i=async s=>{try{const a={date:j,title:s.title,timeslotRef_id:s.timeslotId,additionalInfo:s.additionalInfo,location:s.location,capacity:s.capacity};console.log(a);const r=D?await Pe(`/interview/schedule/${c._id}`,a):await he("/interview/schedule",a);console.log("handleFormSubmit -> res",r),r.status===200||r.status===201?(x("Success","Interview scheduled successfully","success"),te()):x("Error","Failed to schedule interview","danger")}catch(a){x("Error","Failed to schedule interview","danger"),console.error(a)}},M=s=>{f(new Date(s))},te=()=>{B({applicantId:"",applicantName:"",date:new Date,start:null,end:null}),F()},Me=()=>{H(!1)};return t.useEffect(()=>{q(ie(j))},[j]),t.useEffect(()=>{c&&(console.log("Scheduled Interview",c),V(!0),f(new Date(c.date)),B({title:c.title,timeslotId:c.timeslot._id,start:v(c.timeslot.start),end:v(c.timeslot.end),location:c.location,additionalInfo:c.additionalInfo}))},[c]),e.jsxs(e.Fragment,{children:[e.jsxs(we,{visible:A,onClose:te,size:"lg",children:[e.jsx(Te,{children:e.jsx(Ie,{children:D?"Edit Interview":"Schedule Interview"})}),e.jsxs(Ne,{children:[e.jsx("div",{className:"mb-5",children:e.jsx(De,{onChange:M,defaultValue:j,className:T?"calendar dark-mode":"calendar",tileClassName:({date:s,view:a})=>a==="month"&&ce.find(r=>r.getDate()===s.getDate())?"not-available":J.find(r=>r.getDate()===s.getDate())?"has-events":""})}),e.jsxs(re,{onSubmit:Q(i),children:[e.jsx(o,{children:e.jsxs(m,{children:[e.jsxs(y,{className:"mb-3",children:[e.jsx(I,{children:e.jsx(p,{icon:Ve})}),e.jsx(g,{type:"text",placeholder:"Title",...b("title"),invalid:!!l.title})]}),l.title&&e.jsx(S,{invalid:!0,children:l.title.message})]})}),!h||h.length===0?e.jsx(o,{className:"text-danger",children:e.jsx(m,{children:e.jsx(xe,{children:"Click a Date to view its timeslot, if none.. add one."})})}):e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(m,{children:e.jsx(xe,{children:"Time Slots"})})}),e.jsx(o,{children:e.jsx(m,{className:"d-flex flex-wrap gap-2 justify-content-start",children:h.map((s,a)=>e.jsx("div",{className:"mb-3",children:e.jsxs(Ae,{color:s.isAvailable?"success":"danger",children:[v(s.start)," -"," ",v(s.end)," ",e.jsx(E,{content:s.isAvailable?"Available":"Not Available",placement:"top",children:e.jsx(p,{icon:s.isAvailable?He:Oe})}),e.jsx(E,{content:"Delete Time Slot",placement:"top",children:e.jsx(C,{onClick:()=>n(s._id),className:"btn",children:e.jsx(p,{icon:ve})})})]})},a))})})]}),e.jsx(o,{children:e.jsx(m,{className:"d-flex justify-content-end align-items-center",children:e.jsx(E,{content:"Add Time Slot",placement:"top",children:e.jsx(C,{onClick:()=>H(!0),className:"btn btn-success mb-3",children:e.jsx(p,{icon:ye})})})})}),e.jsxs(o,{children:[e.jsx(m,{md:4,children:e.jsxs(y,{className:"mb-3",children:[e.jsx(I,{children:"Date"}),e.jsx(g,{type:"text",...b("date"),invalid:!!l.date,value:L(j),readOnly:!0,className:"visually-hidden"}),e.jsx(g,{type:"text",invalid:!!l.date,value:L(j),readOnly:!0}),l.date&&e.jsx(S,{invalid:!0,children:l.date.message})]})}),e.jsx(m,{md:8,children:e.jsxs(y,{className:"mb-3",children:[e.jsx(I,{children:e.jsx(p,{icon:$e})}),e.jsx(g,{type:"text",placeholder:"Start Time",readOnly:!0,...b("start"),invalid:!!l.start}),l.start&&e.jsx(S,{invalid:!0,children:l.start.message}),e.jsx(g,{type:"text",placeholder:"End Time",readOnly:!0,...b("end"),invalid:!!l.end}),l.end&&e.jsx(S,{invalid:!0,children:l.end.message}),e.jsx(E,{content:"Set Time Slot",placement:"top",children:e.jsxs(ze,{children:[e.jsx(Xe,{color:"primary",children:"Time"}),e.jsx(We,{children:W.map((s,a)=>e.jsxs(Ze,{onClick:()=>{$(s),B({timeslotId:s._id,start:v(s.start),end:v(s.end)})},disabled:W.length===0,children:[v(s.start)," -"," ",v(s.end)]},a))})]})})]})})]}),e.jsx(o,{children:e.jsx(m,{children:e.jsxs(y,{className:"mb-3",children:[e.jsx(I,{children:"Location"}),e.jsx(g,{type:"text",placeholder:"Location",...b("location"),invalid:!!l.location}),l.location&&e.jsx(S,{invalid:!0,children:l.location.message})]})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsxs(y,{className:"mb-3",children:[e.jsx(I,{children:"Capacity"}),e.jsx(g,{type:"number",placeholder:"capacity ",...b("capacity"),invalid:!!l.capacity,defaultValue:1}),l.capacity&&e.jsx(S,{invalid:!0,children:l.capacity.message})]})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsxs(y,{className:"mb-3",children:[e.jsx(I,{children:e.jsx(p,{icon:Be})}),e.jsx(Je,{type:"text",placeholder:"Additional Information",...b("additionalInfo"),invalid:!!l.additionalInfo}),l.additionalInfo&&e.jsx(S,{invalid:!0,children:l.additionalInfo.message})]})})}),e.jsx(o,{children:e.jsxs(m,{className:"d-flex justify-content-end",children:[e.jsx(Ke,{type:"checkbox",id:"invalidCheck",label:"I confirm everything is correct.",checked:k,onChange:()=>Y(!k)}),e.jsx(S,{invalid:!0,children:"You must agree before submitting."})]})}),e.jsxs(Ee,{children:[e.jsx(C,{type:"submit",disabled:!k,className:"btn btn-primary",children:D?"Update":"Schedule"}),e.jsx(C,{color:"secondary",onClick:te,children:"Cancel"})]})]})]})]}),e.jsx(Fe,{isVisible:oe,onClose:Me,handleTimeSubmit:se,isLoading:Z})]})};ke.propTypes={isVisible:w.bool.isRequired,onClose:w.func.isRequired,isDarkMode:w.bool.isRequired,interviewData:w.object};const as=({theme:A})=>{const F=A==="dark",{addToast:T}=t.useContext(Ce),[c,X]=t.useState(!1),[x,j]=t.useState([new Date,new Date]),[f,k]=t.useState(ie(new Date));t.useState(new Date);const[Y,D]=t.useState([]),[V,h]=t.useState(!1),[_,W]=t.useState([new Date(2024,10,15),new Date(2024,10,20)]),[G,oe]=t.useState([new Date(2024,10,1),new Date(2024,10,5)]),[H,O]=t.useState(!1),[$,Z]=t.useState(1),[R,ce]=t.useState(9),[de,J]=t.useState(1),[K,U]=t.useState([]),[b,Q]=t.useState(null),[B,l]=t.useState([{color:"danger",text:"Not Available"},{color:"warning",text:"Has Events"},{color:"primary",text:"Selected Date"}]),ee=n=>{n.length>1?j(n):k(n)},q=async n=>{h(!0);try{const i=await be(`/interview/all?date=${n}&page=${$}&limit=${R}`);i.status===200||i.status===201?(U(i.data.data),D(i.data.slots),J(i.data.totalPages),h(!1)):(h(!1),U([]),D([]))}catch(i){const M=`Failed to fetch interview schedules for ${L(n)}`;T("Error",M,"error"),console.error(i),h(!1)}},se=async n=>{try{(await Se(`/interview/schedule/${n}`)).status===200?(T("Success","Successfully deleted interview schedule","success"),q(f)):T("Error","Failed to delete interview schedule","error")}catch(i){console.error(i),T("Error","Failed to delete interview schedule","error")}};return t.useEffect(()=>{const n=setTimeout(()=>{q(f)},1e3);return()=>clearTimeout(n)},[f]),t.useEffect(()=>{H&&b&&O(!1)},[$]),e.jsx(e.Fragment,{children:e.jsxs(je,{className:"d-flex flex-column gap-3",children:[e.jsx(o,{children:e.jsxs(m,{children:[e.jsx("h2",{children:"Schedules"}),e.jsx("small",{children:"In this page, you can create and edit schedules for interviews, task, or any other events."})]})}),e.jsx(o,{children:e.jsx(je,{children:e.jsx(pe,{children:e.jsxs(fe,{children:[e.jsx("div",{children:B.map((n,i)=>e.jsx(Ae,{color:n.color,className:"me-2",children:n.text},i))}),e.jsx("div",{children:e.jsx(De,{onChange:ee,selectRange:c,className:F?"calendar dark-mode":"calendar",tileClassName:({date:n,view:i})=>i==="month"&&_.find(M=>M.getDate()===n.getDate())?"not-available":G.find(M=>M.getDate()===n.getDate())?"has-events":"",defaultValue:c?[new Date(x[0]),new Date(x[1])]:new Date(f)})}),e.jsx("br",{}),e.jsx("div",{children:e.jsxs(y,{children:[e.jsx(g,{type:"text",placeholder:"start",value:L(f),readOnly:!0}),e.jsx(E,{content:"Create interview",placement:"top",children:e.jsx(C,{onClick:()=>O(!0),className:"btn btn-primary",children:e.jsx(p,{icon:ye})})})]})})]})})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsx(re,{children:e.jsxs(y,{children:[e.jsx(g,{type:"text",placeholder:"Search"}),e.jsx(C,{color:"primary",children:e.jsx(p,{icon:Ye})})]})})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsx(pe,{children:e.jsx(fe,{children:e.jsxs(Qe,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[e.jsx(es,{children:e.jsxs(z,{children:[e.jsx(P,{className:"text-center",children:e.jsx(p,{icon:_e})}),e.jsx(P,{className:"text-center",children:"Date"}),e.jsx(P,{className:"text-center",children:"Time"}),e.jsx(P,{className:"text-center",children:"Location"}),e.jsx(P,{className:"text-center",children:"Capacity"}),e.jsx(P,{className:"text-center",children:"Action"})]})}),e.jsx(ss,{children:V?e.jsx(z,{children:e.jsx(N,{colSpan:"6",className:"text-center",children:e.jsx(ge,{color:"primary",variant:"grow"})})}):K.length===0?e.jsx(z,{children:e.jsxs(N,{colSpan:"6",className:"text-center",children:["No data available for"," ",e.jsx("span",{className:"text-info",children:L(f,"MMM d, YYYY")})]})}):K.map((n,i)=>e.jsxs(z,{children:[e.jsx(N,{className:"text-center",children:n.title}),e.jsx(N,{className:"text-center",children:L(n.date)}),e.jsxs(N,{className:"text-center",children:[v(n.timeslot.start)," -"," ",v(n.timeslot.end)]}),e.jsx(N,{className:"text-center",children:n.location?ue(n.location,20):"N/A"}),e.jsx(N,{className:"text-center",children:n.capacity?ue(n.capacity,20):"N/A"}),e.jsx(N,{className:"text-center",children:e.jsxs(ts,{children:[e.jsxs(C,{onClick:()=>{console.log("Interview Data:",n),Q(n),O(!0)},className:"btn btn-primary",children:[e.jsx(E,{content:"Edit",placement:"top",children:e.jsx(p,{icon:Ge})})," "]}),e.jsxs(C,{onClick:()=>se(n._id),className:"btn btn-danger",children:[e.jsx(E,{content:"Delete",placement:"top",children:e.jsx(p,{icon:ve})})," "]}),e.jsx(C,{className:"btn btn-warning",children:e.jsx(E,{content:"Cancel",placement:"top",children:e.jsx(p,{icon:Ue})})})]})})]},i))})]})})})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(Le,{currentPage:$,totalPages:de,onPageChange:Z})})})}),e.jsx(o,{children:e.jsx(ke,{isVisible:H,onClose:()=>O(!1),isDarkMode:F,interviewData:b})})]})})};as.propTypes={theme:w.string};export{as as default};
