import{r as e,R as a}from"./react-router-dom-BnDDw25P.js";import{_ as i,j as s,a as r,c as t,b as n,p as l,m as o,A as d,k as c,F as m,g as p,w as h,v,x as u,y as f}from"./index-CopbqkEz.js";import{z as y}from"./zod-B0zZW6rS.js";import{u as b}from"./react-hook-form-DGCwHb0C.js";import{s as C}from"./@hookform/resolvers/zod-B5rlnuQ9.js";import{b as g}from"./index-BVfmz2P_.js";import{C as N}from"./CContainer-NNqe3VRY.js";import{C as j,a as x}from"./CRow-aiLILlFw.js";import{C as w,a as A,b as S}from"./CModalHeader-CCMLCb0K.js";import{C as F}from"./CModalTitle-DhyCw6CW.js";import{b as E,C as k,a as z}from"./CFormLabel-BzT4prGI.js";import{C as I}from"./CFormInput-z6oSFf3U.js";import{C as T}from"./CFormTextarea-D3bAwSqD.js";import{C as M}from"./CFormSelect-n7Zj0_cl.js";import{C as _,a as D}from"./CCardBody-DJryQPgH.js";import{C as O}from"./CCardHeader-RSDD0g3x.js";import{C as $,a as V,b as L,c as R,d as P,e as H}from"./CTable-D5m-OWv3.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";import"./DefaultLayout-CA98i8wf.js";import"./index.esm-t9-9Td7j.js";import"./index.es-Bu1yrmVS.js";import"./isRTL-D5ORmfro.js";var B=e.forwardRef((function(e,a){var l,o=e.className,d=e.id,c=e.invalid,m=e.label,p=e.reverse,h=e.size,v=e.type,u=void 0===v?"checkbox":v,f=e.valid,y=i(e,["className","id","invalid","label","reverse","size","type","valid"]);return s("div",{className:t("form-check form-switch",(l={"form-check-reverse":p},l["form-switch-".concat(h)]=h,l["is-invalid"]=c,l["is-valid"]=f,l),o),children:[r("input",{...n({type:u,className:t("form-check-input",{"is-invalid":c,"is-valid":f}),id:d},y,{ref:a})}),m&&r(E,{...n({customClassName:"form-check-label"},d&&{htmlFor:d}),children:m})]})}));B.propTypes={className:l.string,id:l.string,invalid:l.bool,label:l.oneOfType([l.string,l.node]),reverse:l.bool,size:l.oneOf(["lg","xl"]),type:l.oneOf(["checkbox","radio"]),valid:l.bool},B.displayName="CFormSwitch";const U=({isVisible:i,onClose:t,slot:n,state:l})=>{var U,G;const{addToast:K}=e.useContext(o),{userInformation:Q}=e.useContext(d),[W,X]=a.useState({}),[Y,Z]=a.useState(!1),[q,J]=a.useState("view"),[ee,ae]=a.useState(!0),[ie,se]=a.useState(["Initial Interview","Final Interview","Other"]),[re,te]=a.useState(!1),[ne,le]=a.useState(!1),oe=async()=>{try{Z(!0);const e=await h(`/facilities/event/${n.event}`);if(200===e.status)return X(e.data.data),he(e.data.data),Z(!1),K("Success","Event Fetched","success")}catch(e){K("error","failed to load event data","danger")}},de=y.object({name:y.string().min(3).max(50),description:y.string().optional(),capacity:y.number().int().positive(),type:y.enum(ie,{errorMap:()=>({message:"Invalid Event Type"})}),isApproved:y.union([y.boolean(),y.object({status:y.boolean()})]).transform((e=>"boolean"==typeof e?e:e.status)).default(!1)}),{register:ce,watch:me,handleSubmit:pe,reset:he,formState:{errors:ve},setValue:ue}=b({resolver:async(e,a,i)=>await C(de)(e,a,i),defaultValues:(null==(U=W.isApproved)?void 0:U.status)??!1}),fe=me("isApproved",null==(G=W.isApproved)?void 0:G.status);return e.useEffect((()=>{i&&(J(l),"view"!==l&&"edit"!==l||oe())}),[i,l]),e.useEffect((()=>{ae("edit"!==q)}),[q]),r(N,{children:r(j,{children:r(x,{children:s(w,{visible:i,onClose:()=>{he({name:"",description:"",capacity:1,type:"",isApproved:!1}),t(),X({}),J("view"),ae(!1)},size:"xl",children:[r(A,{children:r(F,{children:"edit"===q?"Manage Event":"View Event"})}),r(S,{children:s(N,{children:[r(j,{className:"mb-3",children:s(x,{className:"d-flex flex-column",children:[s("strong",{children:[g(n.start)," - ",g(n.end)]}),s("small",{className:"text-muted",children:[" Timeslot ID: ",n._id]}),W&&s("small",{className:"text-muted",children:[" Event ID: ",W._id]})]})}),Y?r(j,{children:r(x,{children:r(c,{size:"sm"})})}):s(m,{children:[r(j,{children:r(x,{children:s(k,{onSubmit:pe((async e=>{try{te(!0);const a=new FormData;let i;if(a.append("name",e.name),a.append("description",e.description),a.append("capacity",e.capacity),a.append("type",e.type),a.append("isApproved",e.isApproved),"edit"===q)i=await u(`facilities/event/timeslot/${n._id}`,e);else await v(`facilities/event/timeslot/${n._id}`,e);return 201===i.status?(te(!1),t(),K("success","Event created!","success")):200===i.status?(te(!1),t(),K("success","Event Updated!","success")):(te(!1),t(),K("Error","Failed to create event","error"))}catch(a){}})),children:[r(j,{className:"mb-3",children:s(x,{children:[r(I,{type:"text",label:"Name",placeholder:"Applicant Interview",...ce("name"),readOnly:ee,invalid:ve.name}),ve.name&&r(z,{invalid:!0,className:"text-danger",children:ve.name.message})]})}),r(j,{className:"mb-3",children:s(x,{children:[r(T,{type:"text",label:"Description",placeholder:"Lorem ipsum...",rows:6,...ce("description"),invalid:ve.description,readOnly:ee}),ve.description&&r(z,{invalid:!0,className:"text-danger",children:ve.description.message})]})}),r(j,{className:"mb-3",children:s(x,{children:[r(I,{type:"number",label:"Capacity",placeholder:"1",defaultValue:1,...ce("capacity",{valueAsNumber:!0}),readOnly:ee,invalid:ve.capacity}),ve.capacity&&r(z,{invalid:!0,className:"text-danger",children:ve.capacity.message})]})}),r(j,{className:"mb-3",children:s(x,{children:[r(E,{htmlFor:"type",children:"Event Type"}),s(M,{id:"type",...ce("type"),invalid:!!ve.type,disabled:ee,children:[r("option",{value:"",children:"Select an event type"}),ie.map((e=>r("option",{value:e,children:e},e)))]}),ve.type&&r(z,{invalid:!0,className:"text-danger",children:ve.type.message})]})}),r(j,{className:"mb-3",children:s(x,{children:[s(E,{htmlFor:"isApproved",children:["Current approval status:"," ",W.isApproved?r("span",{className:"text-success",children:"Approved"}):r("span",{className:"text-danger",children:"Not approved"})]}),r(B,{id:"isApproved",label:""+(fe?"Approved":"Not Approved"),...ce("isApproved",{valueAsBoolean:!0}),disabled:("admin"===Q.role||"manager"===Q.role)&&ee})]})}),r(j,{className:"mb-3",children:r(x,{children:("edit"===q||"create"===q)&&s("div",{className:"d-flex justify-content-end gap-2",children:[r(p,{type:"button",color:"warning",size:"sm",onClick:()=>{const e=Math.floor(100*Math.random()),a={name:`Event ${e}`,description:`This is a mock description for event #${e}`,capacity:Math.floor(100*Math.random())+1};he(a)},children:"Fill Mock Data"}),r(p,{type:"submit",color:"danger",size:"sm",children:"Delete"}),r(p,{type:"submit",color:"primary",size:"sm",children:re?r(c,{}):"Submit"})]})})})]})})}),W.participants&&r(m,{children:r(j,{children:r(x,{children:s(_,{children:[r(O,{children:s("div",{className:"d-flex justify-content-between",children:[r("div",{children:"Participants"}),("admin"===Q.role||"recruiter"===Q.role)&&"edit"===q&&W.participants.length>0&&r("div",{children:r(p,{size:"sm",color:"info",children:"Send Mail to Participants"})})]})}),r(D,{children:s($,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[r(V,{children:s(L,{children:[r(R,{children:"Name"}),r(R,{children:"Email"}),r(R,{children:"Phone"}),r(R,{children:"Action"})]})}),r(P,{children:W.participants.map((e=>s(L,{children:[s(H,{children:[e.lastname,", ",e.firstname]}),r(H,{children:e.email}),r(H,{children:e.phone}),r(H,{children:r(p,"edit"===q||"create"===q?{size:"sm",color:"danger",onClick:()=>(async e=>{try{le(!0),(new FormData).append("applicantId",e._id);const a=await f(`/facilities/events/${W._id}/unbook?applicantId=${e._id}`);return 200===a.status?(oe(),le(!1),K("Success","Applicant removed from the event","success")):(le(!1),K("Error",a.message,"danger"))}catch(a){K("Error","An error occured","danger")}})(e),disabled:ne,children:ne?r(c,{size:"sm"}):"Remove"}:{size:"sm",color:"danger",disabled:!0,children:"No Permissions"})})]},e._id)))})]})})]})})})})]})]})})]})})})})};U.propTypes={isVisible:l.bool,onClose:l.func,state:l.string,slot:l.object};export{U as default};
