import{r as e}from"./react-router-dom-BnDDw25P.js";import{m as a,A as i,j as t,a as s,l as r,F as n,k as l,g as o,w as c,x as d,v as m,p}from"./index-DVAAnj-9.js";import{z as h}from"./zod-B0zZW6rS.js";import{u}from"./react-hook-form-DB8hWBdy.js";import{s as b}from"./@hookform/resolvers/zod-1wp20Skh.js";import"./index-DCO1bnrX.js";import{C as f,a as y,b as g}from"./CModalHeader-D3Pijq-f.js";import{C as v}from"./CModalTitle-DWg7cv10.js";import{C}from"./CContainer-C-7WEMUq.js";import{C as j,a as x}from"./CRow-Dujfgc-X.js";import{C as N,a as q,b as w}from"./CFormLabel-C3ZNjviW.js";import{C as S}from"./CFormInput-DlNfdHmF.js";import{C as F}from"./CFormTextarea-R1STRuei.js";import{C as O}from"./CFormSelect-CvPrxnA6.js";const z=["internship","full-time","part-time","contract","temporary","freelance"],k=h.object({title:h.string().min(3).max(50),responsibilities:h.string().min(3).max(250),requirements:h.string().min(3).max(250),qualifications:h.string().min(3).max(250),benefits:h.string().min(3).max(250),category:h.enum(z),capacity:h.number().min(1).default(1)}),T=({isVisible:p,onClose:h,state:T,job:E})=>{const{addToast:V}=e.useContext(a),{userInformation:A}=e.useContext(i),[I,J]=e.useState(!1),[M,R]=e.useState(!1),[L,Q]=e.useState(!1),{register:U,watch:$,handleSubmit:_,reset:B,formState:{errors:D},setValue:G}=u({resolver:async(e,a,i)=>await b(k)(e,a,i)});return e.useEffect((()=>{p&&E&&"edit"===T?(async()=>{try{Q(!0);const e=await c(`/job/${E._id}`);200===e.status&&(Q(!1),B(e.data.data))}catch(e){}})():Q(!1)}),[E,p,T]),e.useEffect((()=>{R("edit"!==T&&"create"!==T)}),[T]),t(f,{visible:p,onClose:()=>{h(),(async()=>{B({title:"",responsibilities:"",requirements:"",qualifications:"",benefits:"",category:"temporary",capacity:1})})()},size:"lg",children:[s(y,{children:s(v,{children:"create"===T?"Create job":"Manage Job"})}),s(g,{children:t(C,{children:["development"===r.env,s(j,{children:s(x,{children:L?t(n,{children:[s(l,{size:"sm"}),s("span",{children:"Loading..."})]}):t(N,{onSubmit:_((async e=>{var a,i;try{const a=new FormData;let i;switch(a.append("title",e.title),a.append("responsibilities",e.responsibilities),a.append("requirements",e.requirements),a.append("qualifications",e.qualifications),a.append("benefits",e.benefits),a.append("category",e.category),a.append("capacity",e.capacity),T){case"create":i=await m("/job/",a);break;case"edit":i=await d(`/job/${E._id}`,a);break;default:throw new Error("Invalid form state")}200!==i.status&&201!==i.status||(V("Success",i.data.message,"success"),"create"===T&&h())}catch(t){V("Error",(null==(i=null==(a=null==t?void 0:t.response)?void 0:a.data)?void 0:i.message)||"Something went wrong","danger")}})),children:[s(j,{className:"mb-3",children:t(x,{children:[s(S,{type:"text",label:"Title",placeholder:"",readOnly:M,...U("title"),invalid:D.title}),D.title&&s(q,{invalid:!0,className:"text-danger",children:D.title.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(F,{type:"text",label:"Responsibilities",placeholder:"",readOnly:M,...U("responsibilities"),invalid:D.responsibilities}),D.responsibilities&&s(q,{invalid:!0,className:"text-danger",children:D.responsibilities.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(F,{type:"text",label:"Requirements",placeholder:"",readOnly:M,...U("requirements"),invalid:D.requirements}),D.requirements&&s(q,{invalid:!0,className:"text-danger",children:D.requirements.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(F,{type:"text",label:"Qualifications",placeholder:"",readOnly:M,...U("qualifications"),invalid:D.qualifications}),D.qualifications&&s(q,{invalid:!0,className:"text-danger",children:D.qualifications.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(F,{type:"text",label:"Benefits",placeholder:"",readOnly:M,...U("benefits"),invalid:D.benefits}),D.benefits&&s(q,{invalid:!0,className:"text-danger",children:D.benefits.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(w,{htmlFor:"category",children:"Category"}),t(O,{id:"category",readOnly:M,...U("category",{required:"Please select a category"}),invalid:!!D.category,children:[s("option",{value:"",children:"Select a category"}),z.map((e=>s("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))]}),D.category&&s(q,{invalid:!0,className:"text-danger",children:D.category.message})]})}),s(j,{className:"mb-3",children:t(x,{children:[s(S,{type:"number",label:"Capacity",defaultValue:1,placeholder:"",readOnly:M,...U("capacity",{valueAsNumber:!0}),invalid:D.capacity}),D.capacity&&s(q,{invalid:!0,className:"text-danger",children:D.capacity.message})]})}),"view"!==T&&s(j,{className:"mb-3",children:s(x,{className:"d-flex justify-content-end",children:s(o,{type:"submit",color:"primary",size:"sm",children:"edit"===T?"Update":"Create"})})}),["admin","manager","recruiter"].includes(A.role)&&s(j,{children:s(x,{className:"d-flex justify-content-end",children:s(o,{color:"info",size:"sm",children:"Create Jobposting from this job?"})})})]})})})]})})]})};T.propTypes={isVisible:p.bool,onClose:p.func,state:p.string,job:p.object};export{T as J};
