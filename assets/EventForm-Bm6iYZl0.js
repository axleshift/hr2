import{r as e}from"./react-router-dom-BnDDw25P.js";import{_ as a,j as i,a as t,c as n,b as r,p as s,m as l,A as c,l as d,g as o,k as m,w as p,x as u,v as h,F as v,y as f}from"./index-CcMoZ86M.js";import{z as y}from"./zod-B0zZW6rS.js";import{u as b,b as g}from"./react-hook-form-DB8hWBdy.js";import{s as w}from"./@hookform/resolvers/zod-1wp20Skh.js";import{f as C,b as N}from"./index-DCO1bnrX.js";import{A as x}from"./AppPagination-DKVbBTy2.js";import{C as S,a as j,b as k}from"./CModalHeader-_Q4P1NwJ.js";import{C as A}from"./CModalTitle-CUSi6tVS.js";import{C as E,a as F,b as I,c as q}from"./CTabList-Bk-_56XX.js";import{a as z}from"./DefaultLayout-f6fgnM5a.js";import{b as T,C as $,a as R}from"./CFormLabel-Cn49qeSD.js";import{C as D,a as P}from"./CRow-Bcopbwr-.js";import{C as _}from"./CFormInput-DqSYQ0H6.js";import{C as M}from"./CFormSelect-BOTOLPH_.js";import{C as V}from"./CFormRange-BfkygGOt.js";import{C as O}from"./CFormTextarea-BayWnFVt.js";import{C as L}from"./CContainer-CXw2kXtD.js";import{C as K,a as Y}from"./CCardBody-NXgyA15G.js";import{C as H,a as Q,c as B,d as G,b as U,e as W}from"./CTable-Cj8mkuZH.js";import"./ConfirmationDialog-K51Wozrj.js";import{C as Z}from"./CCardHeader-C6GIS5ko.js";import"./react-BF1r7_8g.js";import"./react-dom-DgB6LS8R.js";import"./index.es-bvOFjCBQ.js";import"./getTransitionDurationFromElement-2nBpLMKS.js";import"./index.esm-5D08hL8w.js";import"./isRTL-D5ORmfro.js";var J=e.forwardRef((function(e,s){var l,c=e.className,d=e.id,o=e.invalid,m=e.label,p=e.reverse,u=e.size,h=e.type,v=void 0===h?"checkbox":h,f=e.valid,y=a(e,["className","id","invalid","label","reverse","size","type","valid"]);return i("div",{className:n("form-check form-switch",(l={"form-check-reverse":p},l["form-switch-".concat(u)]=u,l["is-invalid"]=o,l["is-valid"]=f,l),c),children:[t("input",{...r({type:v,className:n("form-check-input",{"is-invalid":o,"is-valid":f}),id:d},y,{ref:s})}),m&&t(T,{...r({customClassName:"form-check-label"},d&&{htmlFor:d}),children:m})]})}));J.propTypes={className:s.string,id:s.string,invalid:s.bool,label:s.oneOfType([s.string,s.node]),reverse:s.bool,size:s.oneOf(["lg","xl"]),type:s.oneOf(["checkbox","radio"]),valid:s.bool},J.displayName="CFormSwitch";const X=y.object({date:y.string().nonempty("Date is required"),type:y.enum(["Phone","Video","In-Person"]),general:y.object({communication:y.number().min(1).max(5).default(1),technical:y.number().min(1).max(5).default(1),problemSolving:y.number().min(1).max(5).default(1),culturalFit:y.number().min(1).max(5).default(1),workExperienceRelevance:y.number().min(1).max(5).default(1),leadership:y.number().min(1).max(5).default(1)}),questions:y.array(y.object({question:y.string().min(1,{message:"A question is required."}),remark:y.string().optional()})).optional(),strength:y.string().optional(),weakness:y.string().optional(),recommendation:y.enum(["yes","no","need further review"]),finalComments:y.string().optional()}),ee=({isVisible:a,onClose:n,isEdit:r,state:s,eventData:v,applicantData:f})=>{const{addToast:y}=e.useContext(l),{userInformation:N}=e.useContext(c),[T,Z]=e.useState([]),[J,ee]=e.useState(!1),[ae,ie]=e.useState(""),[te,ne]=e.useState("view"),[re,se]=e.useState(1),[le,ce]=e.useState(9),[de,oe]=e.useState(0),[me,pe]=e.useState(0),{control:ue,register:he,handleSubmit:ve,reset:fe,setValue:ye,watch:be,formState:{errors:ge}}=b({resolver:w(X)}),{fields:we,append:Ce,remove:Ne}=g({control:ue,name:"questions"});return e.useEffect((()=>{a&&v&&setTimeout((()=>{fe({date:(null==v?void 0:v.date)?v.date.split("T")[0]:"",general:{communication:1,technical:1,problemSolving:1,culturalFit:1,workExperienceRelevance:1,leadership:1}})}),100)}),[a,v,fe]),e.useEffect((()=>{a&&(async()=>{try{ee(!0);const e=ae?await p(`/applicant/interview/all/${f._id}?query=${ae}&page=${re}&limit=${le}&sort=desc`):await p(`/applicant/interview/all/${f._id}?page=${re}&limit=${le}&sort=desc`);200===e.status?(Z(e.data.data),pe(e.data.totalItems),oe(e.data.totalPages),se(e.data.currentPage)):(Z([]),pe(0),oe(0),se(1)),ee(!1)}catch(e){ee(!1)}})()}),[a]),i(S,{visible:a,onClose:()=>{n(),fe({applicant:"",date:"",type:"Phone",general:{communication:1,technical:1,problemSolving:1,culturalFit:1,workExperienceRelevance:1,leadership:1},strength:"",weakness:"",recommendation:"yes",finalComments:""})},size:"xl",children:[t(j,{children:t(A,{children:r?"Edit Interview":"Interview Form"})}),t(k,{children:i(E,{activeItemKey:"form",children:[i(F,{variant:"tabs",children:[t(I,{itemKey:"form",children:"Form"}),t(I,{itemKey:"history",children:"History"})]}),i(z,{children:[t(q,{itemKey:"form",children:i($,{onSubmit:ve((async e=>{try{const a=r?await u(`/interviews/update/${v._id}`,e):await h("/interviews/create",e);200!==a.status&&201!==a.status||(y("Success","Interview saved successfully","success"),fe(),n())}catch(a){y("Error","An error occurred","danger")}})),className:"mt-3",children:["development"===d.env,f&&i(D,{className:"mb-3",children:[t(P,{children:t(_,{label:"Firstname",value:f.firstname,readOnly:!0})}),t(P,{children:t(_,{label:"Lastname",value:f.lastname,readOnly:!0})})]}),t(D,{className:"mb-3",children:i(P,{children:[t(_,{type:"date",label:"Date",...he("date"),invalid:!!ge.date,readOnly:!0}),ge.date&&t(R,{invalid:!0,children:ge.date.message})]})}),i(D,{className:"mb-3",children:[i(P,{children:[i(M,{label:"Interview Type",...he("type"),invalid:!!ge.type,children:[t("option",{value:"Phone",children:"Phone"}),t("option",{value:"Video",children:"Video"}),t("option",{value:"In-Person",children:"In-Person"})]}),ge.type&&t(R,{invalid:!0,children:ge.type.message})]}),t(P,{children:t(_,{label:"Event Type",value:v.type,readOnly:!0})})]}),t("h5",{children:"General Ratings"}),["communication","technical","problemSolving","culturalFit","workExperienceRelevance","leadership"].map((e=>{var a,n;return t(D,{className:"mb-3",children:i(P,{children:[i("label",{children:[e.replace(/([A-Z])/g," $1").trim()," (",be(`general.${e}`),")"]}),t(V,{min:1,max:5,step:1,default:1,...he(`general.${e}`),invalid:!!(null==(a=ge.general)?void 0:a[e])}),(null==(n=ge.general)?void 0:n[e])&&t(R,{invalid:!0,children:ge.general[e].message})]})},e)})),t(D,{children:t(P,{className:"d-flex justify-content-end",children:t(o,{type:"button",color:"info",size:"sm",onClick:()=>Ce({question:"",remark:""}),children:"Add Question"})})}),t(D,{children:t(P,{children:we.map(((e,a)=>{var n,r,s,l;return t(D,{className:"mb-3",children:i(P,{children:[t(D,{className:"mb-3",children:i(P,{children:[t(_,{label:`Question ${a+1}`,autoComplete:"question",...he(`questions.${a}.question`),invalid:!!(null==(r=null==(n=ge.questions)?void 0:n[a])?void 0:r.question)}),(null==(l=null==(s=ge.questions)?void 0:s[a])?void 0:l.question)&&t(R,{invalid:!0,children:ge.questions[a].question.message})]})}),t(D,{className:"mb-2",children:t(P,{children:t(O,{label:"Remarks",autoComplete:"remark",...he(`questions.${a}.remark`)})})}),t(D,{className:"mb-2",children:t(P,{children:t(P,{children:t("div",{className:"d-flex justify-content-end",children:t(o,{type:"button",color:"danger",size:"sm",onClick:()=>Ne(a),children:"Remove"})})})})})]})},e.id)}))})}),t(D,{className:"mb-3",children:i(P,{children:[i(M,{label:"Recommendation",...he("recommendation"),invalid:!!ge.recommendation,children:[t("option",{value:"yes",children:"Yes"}),t("option",{value:"no",children:"No"}),t("option",{value:"need further review",children:"Need Further Review"})]}),ge.recommendation&&t(R,{invalid:!0,children:ge.recommendation.message})]})}),t(D,{className:"mb-3",children:t(P,{children:t(O,{label:"Strength",...he("strength")})})}),t(D,{className:"mb-3",children:t(P,{children:t(O,{label:"Weakness",...he("weakness")})})}),t(D,{className:"mb-3",children:t(P,{children:t(O,{label:"Final Comments",...he("finalComments")})})}),t(D,{children:t(P,{className:"d-flex justify-content-end",children:["admin","interviewer","manager"].includes(N.role)?t(o,{type:"submit",color:"primary",size:"sm",children:r?"Update":"Create"}):t(o,{color:"danger",size:"sm",disabled:!0,children:"No Permission"})})})]})}),t(q,{itemKey:"history",children:i(L,{className:"mt-3",children:[t(D,{className:"mb-3",children:t(P,{children:t(K,{children:t(Y,{children:i(H,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[i(Q,{children:[t(B,{children:"Interviewer"}),t(B,{children:"Type"}),t(B,{children:"Event Type"}),t(B,{children:"Recommendation"}),t(B,{children:"Created"}),t(B,{children:"Actions"})]}),t(G,{children:J?t(U,{children:t(W,{colSpan:"12",children:t("div",{className:"pt-3 text-center",children:t(m,{color:"primary",variant:"grow"})})})}):0===T.length?t(U,{children:t(W,{colSpan:"12",children:t("div",{className:"text-center",children:"No Interviews History Found"})})}):T.map((e=>{var a;return i(U,{children:[t(W,{children:i("div",{children:[e.interviewer.lastname,", ",e.interviewer.firstname]})}),t(W,{children:e.type}),t(W,{children:null==(a=null==e?void 0:e.event)?void 0:a.type}),t(W,{className:"text-capitalize",children:e.recommendation}),t(W,{children:C(e.date,"MMM DD YYYY h:mm A")}),t(W,{children:t(o,{color:"primary",size:"sm",onClick:()=>(e=>{var a,i,t,n,r,s,l;fe({date:e.date?e.date.split("T")[0]:"",type:e.type||"Phone",general:{communication:(null==(a=e.general)?void 0:a.communication)||1,technical:(null==(i=e.general)?void 0:i.technical)||1,problemSolving:(null==(t=e.general)?void 0:t.problemSolving)||1,culturalFit:(null==(n=e.general)?void 0:n.culturalFit)||1,workExperienceRelevance:(null==(r=e.general)?void 0:r.workExperienceRelevance)||1,leadership:(null==(s=e.general)?void 0:s.leadership)||1},questions:(null==(l=e.questions)?void 0:l.length)?e.questions:[{question:"",remark:""}],strength:e.strength||"",weakness:e.weakness||"",recommendation:e.recommendation||"yes",finalComments:e.finalComments||""}),y("Success","Interview fetched. Please change to forms tab.","success")})(e),children:"View"})})]},e._id)}))})]})})})})}),t(D,{children:t(P,{children:t("div",{className:"d-flex flex-row gap-2 justify-content-center align-items-center",children:t(x,{currentPage:re,totalPages:de,onPageChange:se})})})})]})})]})]})})]})};ee.propTypes={isVisible:s.bool.isRequired,onClose:s.func.isRequired,isEdit:s.bool.isRequired,state:s.string,eventData:s.object,applicantData:s.object};const ae=({isVisible:a,onClose:n,slot:r,state:s})=>{var g,C,x;const{addToast:E}=e.useContext(l),{userInformation:F}=e.useContext(c),[I,q]=e.useState({}),[z,V]=e.useState(!1),[X,ae]=e.useState(!1),[ie,te]=e.useState("view"),[ne,re]=e.useState(!0),[se,le]=e.useState(["Initial Interview","Final Interview","Other"]),[ce,de]=e.useState(!1),[oe,me]=e.useState(!1),[pe,ue]=e.useState(!1),[he,ve]=e.useState([]),[fe,ye]=e.useState(!1),[be,ge]=e.useState(!1),[we,Ce]=e.useState({}),[Ne,xe]=e.useState({}),[Se,je]=e.useState([]),[ke,Ae]=e.useState(!1),[Ee,Fe]=e.useState(""),[Ie,qe]=e.useState(1),[ze,Te]=e.useState(9),[$e,Re]=e.useState(0),[De,Pe]=e.useState(0),_e=async()=>{var e;try{ae(!0);const a=await p(`/facilities/event/${r.event}`);if(200===a.status)return q(a.data.data),Ke({...a.data.data,isApproved:null==(e=a.data.data.isApproved)?void 0:e.status}),ae(!1),E("Success","Event Fetched","success")}catch(a){E("error","failed to load event data","danger")}},Me=y.object({name:y.string().min(3).max(50),description:y.string().optional(),capacity:y.number().int().positive(),type:y.enum(se,{errorMap:()=>({message:"Invalid Event Type"})}),isApproved:y.union([y.boolean(),y.object({status:y.boolean()})]).transform((e=>"boolean"==typeof e?e:e.status)).default(!1)}),{register:Ve,watch:Oe,handleSubmit:Le,reset:Ke,formState:{errors:Ye},setValue:He}=b({resolver:async(e,a,i)=>await w(Me)(e,a,i),defaultValues:(null==(g=I.isApproved)?void 0:g.status)??!1}),Qe=Oe("isApproved",null==(C=I.isApproved)?void 0:C.status),Be=()=>{Ke({name:"",description:"",capacity:1,type:"",isApproved:!1})};return e.useEffect((()=>{a&&V(a)}),[a]),e.useEffect((()=>{z&&(te(s),"view"!==s&&"edit"!==s||_e())}),[z,s]),e.useEffect((()=>{switch(ie){case"edit":case"create":re(!1);break;default:re(!0)}}),[ie]),i(L,{children:[t(D,{children:t(P,{children:i(S,{visible:z,onClose:()=>{Be(),n(),q({}),te("view"),re(!1),V(!1)},size:"xl",children:[t(j,{children:t(A,{children:"edit"===ie||"create"===ie?"Manage Event":"View Event"})}),t(k,{children:i(L,{children:[t(D,{className:"mb-3",children:i(P,{className:"d-flex flex-column",children:[i("strong",{children:[N(r.start)," - ",N(r.end)]}),i("small",{className:"text-muted",children:[" Timeslot ID: ",r._id]}),I&&i("small",{className:"text-muted",children:[" Event ID: ",I._id]}),"development"===d.env]})}),X?t(D,{children:t(P,{children:t(m,{size:"sm"})})}):i(v,{children:[t(D,{children:t(P,{children:i($,{onSubmit:Le((async e=>{try{de(!0);const a=new FormData;let i;if(a.append("name",e.name),a.append("description",e.description),a.append("capacity",e.capacity),a.append("type",e.type),a.append("isApproved",e.isApproved),"edit"===ie)i=await u(`/facilities/event/${r._id}`,e);else i=await h(`/facilities/event/${r._id}`,e);const t=i.data.data;switch(i.status){case 201:E("success","Event created!","success"),q(t),te("edit");break;case 200:E("success","Event updated!","success"),q(t);break;default:E("Error","Failed to create event","danger")}de(!1)}catch(a){de(!1),E("Error","An unexpected error occurred","danger")}})),children:[t(D,{className:"mb-3",children:i(P,{children:[t(_,{type:"text",label:"Name",placeholder:"Applicant Interview",...Ve("name"),readOnly:ne,invalid:Ye.name}),Ye.name&&t(R,{invalid:!0,className:"text-danger",children:Ye.name.message})]})}),t(D,{className:"mb-3",children:i(P,{children:[t(O,{type:"text",label:"Description",placeholder:"Lorem ipsum...",rows:6,...Ve("description"),invalid:Ye.description,readOnly:ne}),Ye.description&&t(R,{invalid:!0,className:"text-danger",children:Ye.description.message})]})}),t(D,{className:"mb-3",children:i(P,{children:[t(_,{type:"number",label:"Capacity",placeholder:"1",defaultValue:1,...Ve("capacity",{valueAsNumber:!0}),readOnly:ne,invalid:Ye.capacity}),Ye.capacity&&t(R,{invalid:!0,className:"text-danger",children:Ye.capacity.message})]})}),t(D,{className:"mb-3",children:i(P,{children:[t(T,{htmlFor:"type",children:"Event Type"}),i(M,{id:"type",...Ve("type"),invalid:!!Ye.type,disabled:ne,children:[t("option",{value:"",children:"Select an event type"}),se.map((e=>t("option",{value:e,children:e},e)))]}),Ye.type&&t(R,{invalid:!0,className:"text-danger",children:Ye.type.message})]})}),t(D,{className:"mb-3",children:i(P,{children:[i(T,{htmlFor:"isApproved",children:["Current approval status:"," ",(null==(x=I.isApproved)?void 0:x.status)?t("span",{className:"text-success",children:"Approved"}):t("span",{className:"text-danger",children:"Not approved"})]}),t(J,{id:"isApproved",label:""+(Qe?"Approved":"Not Approved"),...Ve("isApproved",{valueAsBoolean:!0}),disabled:("admin"===F.role||"manager"===F.role)&&ne})]})}),t(D,{className:"mb-3",children:t(P,{children:("edit"===ie||"create"===ie)&&i("div",{className:"d-flex justify-content-end gap-2",children:[t(o,{type:"button",color:"warning",size:"sm",onClick:()=>{const e=Math.floor(100*Math.random()),a={name:`Event ${e}`,description:`This is a mock description for event #${e}`,capacity:Math.floor(100*Math.random())+1};Ke(a)},children:"Fill Mock Data"}),"edit"===ie&&t(o,{color:"danger",size:"sm",onClick:()=>(async()=>{try{if(!confirm("Are you sure you want to delete this event?"))return;if(200===(await f(`/facilities/event/${r._id}`)).status)return Be(),n(),V(!1),E("Success","Event deleted!","success")}catch(e){E("Error",e,"danger")}})(),children:"Delete"}),t(o,{type:"submit",color:"primary",size:"sm",children:ce?t(m,{size:"sm"}):"edit"===ie?"Update":"Create"})]})})})]})})}),I.participants&&t(v,{children:t(D,{children:t(P,{children:i(K,{children:[t(Z,{children:i("div",{className:"d-flex justify-content-between",children:[t("div",{children:"Participants"}),["admin","recruiter"].includes(F.role)&&"edit"===ie&&I.participants.length>0&&(I.isApproved.status?t("div",{children:t(o,{size:"sm",color:"info",disabled:pe,onClick:()=>(async()=>{try{if(!confirm("Are you sure you want to send email?"))return;ue(!0);const e=await h(`/facilities/events/${I._id}/send-email`);return 200===e.status?(ue(!1),ve(e.data.failedMails),E("Success",`Email sent for participant for event ${I.name}`,"success")):(ue(!1),E("Info",e.message.message,"info"))}catch(e){E("Error","An error occured","danger")}})(),children:pe?i("span",{children:[t(m,{size:"sm"})," sending..."]}):I.emailSent.status?"Resend Mail to Participants":"Send Mail to Participants"})}):t(o,{size:"sm",color:"info",disabled:!0,children:"Needs Approval"}))]})}),t(Y,{children:i(H,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[t(Q,{children:i(U,{children:[t(B,{children:"Name"}),t(B,{children:"Email"}),t(B,{children:"Phone"}),t(B,{children:"Email Sent"}),t(B,{children:"Action"})]})}),t(G,{children:I.participants.map((e=>i(U,{children:[i(W,{children:[e.applicant.lastname,", ",e.applicant.firstname]}),t(W,{children:e.applicant.email}),t(W,{children:e.applicant.phone}),t(W,{children:e.mail.sent?t("span",{className:"text-success",children:"Sent"}):t("span",{className:"text-danger",children:"Failed"})}),t(W,{children:i("div",{className:"d-flex flex-row gap-2",children:[("edit"===ie||"create"===ie)&&t(o,{size:"sm",color:"danger",onClick:()=>(async e=>{try{if(!confirm("Are you sure you want to delete this applicant?"))return;me(!0),(new FormData).append("applicantId",e._id);const a=await f(`/facilities/events/${I._id}/unbook?applicantId=${e._id}`);return 200===a.status?(_e(),me(!1),E("Success","Applicant removed from the event","success")):(me(!1),E("Info",a.message.message,"info"))}catch(a){E("Error","An error occured","danger")}})(e.applicant),disabled:oe,children:oe?t(m,{size:"sm"}):"Remove"}),["admin","manager","recruiter"].includes(F.role)&&t(o,{color:"info",size:"sm",onClick:()=>{ye(!0),ge(!1),V(!1),xe(e.applicant),Ce({_id:I._id,name:I.name,date:I.date,type:I.type})},children:"Interview"})]})})]},e.applicant._id)))})]})})]})})})})]})]})})]})})}),t(D,{children:t(P,{children:t(ee,{isVisible:fe,onClose:()=>{ge(!1),ye(!1),V(!0)},isEdit:be,eventData:we,applicantData:Ne})})})]})};ae.propTypes={isVisible:s.bool,onClose:s.func,state:s.string,slot:s.object};export{ae as default};
