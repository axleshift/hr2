import{p as T,k as e,g as f,r as t,o as pe,G as fe,F as de,I as ge,E as ke,l as Me}from"./index-DN3Hgp2L.js";import{A as Re}from"./AppPagination-B6oKmU5X.js";import{F as u,f as Pe,W as qe,V as Ve,O as be,s as Ce,X as He,I as Le,Y as $e,Z as Be,G as Oe,_ as _e,L as Ye,A as Ge}from"./index.es-DqaM7nwW.js";import{C as ve}from"./Calendar-VPTvMz7f.js";import{z as d,u as se,t as te}from"./zod-Gg7m2xxn.js";import{C as Se,a as ye,b as De}from"./CModalHeader-BIemrrei.js";import{C as we}from"./CModalTitle-DytORmA_.js";import{C as ne,a as p,c as b,b as me}from"./CFormInput-Crvkftz_.js";import{C as o,a as m}from"./CRow-CKPmgian.js";import{C as v}from"./CInputGroup-DNb1gUpw.js";import{C as N}from"./CInputGroupText-BnbS2GBH.js";import{C as Ne}from"./CModalFooter-6iP-3Pan.js";import{U as ae,c as C,f as R,t as he}from"./index-Djw6EB11.js";import{a as Te,c as Ue,d as ze,e as Xe,f as We}from"./DefaultLayout-C0z569G2.js";import{C as I}from"./CTooltip-5MXlvsEs.js";import{C as Ze}from"./CFormTextarea-Cjx9_vC1.js";import{C as Je}from"./CFormCheck-qLJK12VK.js";import{C as xe}from"./CContainer-CDxSXJ6A.js";import{C as ue,a as je}from"./CCardBody-ZbKqYlGO.js";import{C as Ke,a as Qe,b as U,c as M,d as es,e as w}from"./CTable-B-laDQ4U.js";import{C as ss}from"./CButtonGroup-D79B-O9Y.js";import"./clsx-B-dksMZM.js";import"./index.esm-B3EpyKWa.js";const Ie=({isVisible:P,onClose:E,handleTimeSubmit:y})=>{const h=d.object({start:d.string().min(1,{message:"Start time is required"}),end:d.string().min(1,{message:"End time is required"})}),{register:q,handleSubmit:j,formState:{errors:i}}=se({resolver:te(h)});return e.jsxs(Se,{visible:P,onClose:E,size:"sm",children:[e.jsx(ye,{children:e.jsx(we,{children:"Add Time Range"})}),e.jsx(De,{children:e.jsxs(ne,{onSubmit:j(y),children:[e.jsx(o,{children:e.jsx(m,{children:e.jsxs(v,{className:"mb-3",children:[e.jsx(N,{children:"Start Time"}),e.jsx(p,{type:"time",...q("start"),invalid:!!i.start}),i.start&&e.jsx(b,{invalid:!0,children:i.start.message})]})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsxs(v,{className:"mb-3",children:[e.jsx(N,{children:"End Time"}),e.jsx(p,{type:"time",...q("end"),invalid:!!i.end}),i.end&&e.jsx(b,{invalid:!0,children:i.end.message})]})})}),e.jsxs(Ne,{children:[e.jsx(f,{type:"submit",className:"btn btn-primary",children:"Add"}),e.jsx(f,{color:"secondary",onClick:E,children:"Cancel"})]})]})})]})};Ie.propTypes={isVisible:T.bool.isRequired,onClose:T.func.isRequired,handleTimeSubmit:T.func.isRequired};const Ee=({isVisible:P,onClose:E,isDarkMode:y,interviewData:h})=>{const q=new Date(new Date().setDate(new Date().getDate()-1)),{addToast:j}=t.useContext(pe),[i,S]=t.useState(ae(new Date)),[V,le]=t.useState(!1),[F,z]=t.useState(!1);t.useState({}),t.useState({}),t.useState("");const[D,B]=t.useState([]),[X,O]=t.useState([]),[re,H]=t.useState(!1),[L,$]=t.useState(null),[W,ie]=t.useState([new Date(2024,10,15),new Date(2024,10,20)]),[ce,oe]=t.useState([new Date(2024,10,1),new Date(2024,10,5)]);t.useState(1),t.useState(9),t.useState(1);const Z=d.object({title:d.string().min(1,{message:"Title is required"}),date:d.preprocess(s=>new Date(s),d.date().min(q,{message:"Date should be today or later"})),timeslotId:d.string().optional(),start:d.string().min(1,{message:"Start time is required"}),end:d.string().min(1,{message:"End time is required"}),location:d.string().optional(),capacity:d.preprocess(s=>parseInt(s),d.number().min(1,{message:"Capacity should be at least 1"})),additionalInfo:d.string().optional()}),{register:g,handleSubmit:_,reset:k,formState:{errors:l}}=se({resolver:async(s,a,c)=>{const x=await te(Z)(s,a,c);return console.log("Validation result:",x),x}}),J=d.object({start:d.string().min(1,{message:"Start time is required"}),end:d.string().min(1,{message:"End time is required"})}).refine(async s=>{const[a,c]=s.start.split(":").map(Number),[x,ee]=s.end.split(":").map(Number),Ae=a*60+c,Fe=x*60+ee;return Ae<Fe},{message:"Start time should be before end time",path:["start"]});se({resolver:async(s,a,c)=>{const x=await te(J)(s,a,c);return console.log("Validation result:",x),x}});const Y=async s=>{try{const a=await fe(`/interview/slots?date=${s}`);if(a.status===200){const c=a.data;B(c.data);const x=c.data.filter(ee=>ee.isAvailable);O(x)}else j("Error","Failed to fetch time slots","danger")}catch(a){console.error(a),B([]),O([])}},K=async s=>{try{const a=i;console.log(a,s);const c={date:a,timeslot:{start:s.start,end:s.end}},x=await de("/interview/slots/",c);console.log("res",x),x.status===200||x.status===201?(j("Success","Time slot added successfully","success"),Y(i)):j("Error",x.message.message,"danger")}catch(a){console.error(a)}},G=async s=>{try{const a=await ge(`/interview/slot/${s}`);console.log("handleDeleteTimeslot -> Result",a),a.status===200?(j("Success","Time slot deleted successfully","success"),Y(i)):j("Error","Something went wrong. Unable to delete time slot.","danger")}catch(a){console.error(a)}},Q=async s=>{try{const a={date:i,title:s.title,timeslotRef_id:s.timeslotId,additionalInfo:s.additionalInfo,location:s.location,capacity:s.capacity};console.log(a);const c=F?await ke(`/interview/schedule/${h._id}`,a):await de("/interview/schedule",a);console.log("handleFormSubmit -> res",c),c.status===200||c.status===201?(j("Success","Interview scheduled successfully","success"),r()):j("Error","Failed to schedule interview","danger")}catch(a){j("Error","Failed to schedule interview","danger"),console.error(a)}},n=s=>{S(new Date(s))},r=()=>{k({applicantId:"",applicantName:"",date:new Date,start:null,end:null}),E()},A=()=>{H(!1)};return t.useEffect(()=>{Y(ae(i))},[i]),t.useEffect(()=>{h&&(console.log("Scheduled Interview",h),z(!0),S(new Date(h.date)),k({title:h.title,timeslotId:h.timeslot._id,start:C(h.timeslot.start),end:C(h.timeslot.end),location:h.location,additionalInfo:h.additionalInfo}))},[h]),e.jsxs(e.Fragment,{children:[e.jsxs(Se,{visible:P,onClose:r,size:"lg",children:[e.jsx(ye,{children:e.jsx(we,{children:F?"Edit Interview":"Schedule Interview"})}),e.jsxs(De,{children:[e.jsx("div",{className:"mb-5",children:e.jsx(ve,{onChange:n,defaultValue:i,className:y?"calendar dark-mode":"calendar",tileClassName:({date:s,view:a})=>a==="month"&&W.find(c=>c.getDate()===s.getDate())?"not-available":ce.find(c=>c.getDate()===s.getDate())?"has-events":""})}),e.jsxs(ne,{onSubmit:_(Q),children:[e.jsx(o,{children:e.jsxs(m,{children:[e.jsxs(v,{className:"mb-3",children:[e.jsx(N,{children:e.jsx(u,{icon:Pe})}),e.jsx(p,{type:"text",placeholder:"Title",...g("title"),invalid:!!l.title})]}),l.title&&e.jsx(b,{invalid:!0,children:l.title.message})]})}),!D||D.length===0?e.jsx(o,{className:"text-danger",children:e.jsx(m,{children:e.jsx(me,{children:"Click a Date to view its timeslot, if none.. add one."})})}):e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(m,{children:e.jsx(me,{children:"Time Slots"})})}),e.jsx(o,{children:e.jsx(m,{className:"d-flex flex-wrap gap-2 justify-content-start",children:D.map((s,a)=>e.jsx("div",{className:"mb-3",children:e.jsxs(Te,{color:s.isAvailable?"success":"danger",children:[C(s.start)," -"," ",C(s.end)," ",e.jsx(I,{content:s.isAvailable?"Available":"Not Available",placement:"top",children:e.jsx(u,{icon:s.isAvailable?qe:Ve})}),e.jsx(I,{content:"Delete Time Slot",placement:"top",children:e.jsx(f,{onClick:()=>G(s._id),className:"btn",children:e.jsx(u,{icon:be})})})]})},a))})})]}),e.jsx(o,{children:e.jsx(m,{className:"d-flex justify-content-end align-items-center",children:e.jsx(I,{content:"Add Time Slot",placement:"top",children:e.jsx(f,{onClick:()=>H(!0),className:"btn btn-success mb-3",children:e.jsx(u,{icon:Ce})})})})}),e.jsxs(o,{children:[e.jsx(m,{md:4,children:e.jsxs(v,{className:"mb-3",children:[e.jsx(N,{children:"Date"}),e.jsx(p,{type:"text",...g("date"),invalid:!!l.date,value:R(i),readOnly:!0,className:"visually-hidden"}),e.jsx(p,{type:"text",invalid:!!l.date,value:R(i),readOnly:!0}),l.date&&e.jsx(b,{invalid:!0,children:l.date.message})]})}),e.jsx(m,{md:8,children:e.jsxs(v,{className:"mb-3",children:[e.jsx(N,{children:e.jsx(u,{icon:He})}),e.jsx(p,{type:"text",placeholder:"Time",readOnly:!0,...g("start"),invalid:!!l.start}),l.start&&e.jsx(b,{invalid:!0,children:l.start.message}),e.jsx(p,{type:"text",placeholder:"Time",readOnly:!0,...g("end"),invalid:!!l.end}),l.end&&e.jsx(b,{invalid:!0,children:l.end.message}),e.jsx(I,{content:"Set Time Slot",placement:"top",children:e.jsxs(Ue,{children:[e.jsx(ze,{color:"primary",children:"Time"}),e.jsx(Xe,{children:X.map((s,a)=>e.jsxs(We,{onClick:()=>{$(s),k({timeslotId:s._id,start:C(s.start),end:C(s.end)})},disabled:X.length===0,children:[C(s.start)," -"," ",C(s.end)]},a))})]})})]})})]}),e.jsx(o,{children:e.jsx(m,{children:e.jsxs(v,{className:"mb-3",children:[e.jsx(N,{children:e.jsx(u,{icon:Le})}),e.jsx(p,{type:"text",placeholder:"Location",...g("location"),invalid:!!l.location}),l.location&&e.jsx(b,{invalid:!0,children:l.location.message})]})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsxs(v,{className:"mb-3",children:[e.jsx(N,{children:e.jsx(u,{icon:$e})}),e.jsx(p,{type:"number",placeholder:"capacity",...g("capacity"),invalid:!!l.capacity,defaultValue:1}),l.capacity&&e.jsx(b,{invalid:!0,children:l.capacity.message})]})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsxs(v,{className:"mb-3",children:[e.jsx(N,{children:e.jsx(u,{icon:Be})}),e.jsx(Ze,{type:"text",placeholder:"Additional Information",...g("additionalInfo"),invalid:!!l.additionalInfo}),l.additionalInfo&&e.jsx(b,{invalid:!0,children:l.additionalInfo.message})]})})}),e.jsx(o,{children:e.jsxs(m,{className:"d-flex justify-content-end",children:[e.jsx(Je,{type:"checkbox",id:"invalidCheck",label:"I confirm everything is correct.",checked:V,onChange:()=>le(!V)}),e.jsx(b,{invalid:!0,children:"You must agree before submitting."})]})}),e.jsxs(Ne,{children:[e.jsx(f,{type:"submit",disabled:!V,className:"btn btn-primary",children:F?"Update":"Schedule"}),e.jsx(f,{color:"secondary",onClick:r,children:"Cancel"})]})]})]})]}),e.jsx(Ie,{isVisible:re,onClose:A,handleTimeSubmit:K})]})};Ee.propTypes={isVisible:T.bool.isRequired,onClose:T.func.isRequired,isDarkMode:T.bool.isRequired,interviewData:T.object};const ts=({theme:P})=>{const E=P==="dark",{addToast:y}=t.useContext(pe),[h,q]=t.useState(!1),[j,i]=t.useState([new Date,new Date]),[S,V]=t.useState(ae(new Date));t.useState(new Date);const[le,F]=t.useState([]),[z,D]=t.useState(!1),[B,X]=t.useState([new Date(2024,10,15),new Date(2024,10,20)]),[O,re]=t.useState([new Date(2024,10,1),new Date(2024,10,5)]),[H,L]=t.useState(!1),[$,W]=t.useState(1),[ie,ce]=t.useState(9),[oe,Z]=t.useState(1),[g,_]=t.useState([]),[k,l]=t.useState(null),[J,Y]=t.useState([{color:"danger",text:"Not Available"},{color:"warning",text:"Has Events"},{color:"primary",text:"Selected Date"}]),K=n=>{n.length>1?i(n):V(n)},G=async n=>{D(!0);try{const r=await fe(`/interview/all?date=${n}&page=${$}&limit=${ie}`);r.status===200||r.status===201?(_(r.data.data),F(r.data.slots),Z(r.data.totalPages),D(!1)):(D(!1),_([]),F([]))}catch(r){const A=`Failed to fetch interview schedules for ${R(n)}`;y("Error",A,"error"),console.error(r),D(!1)}},Q=async n=>{try{(await ge(`/interview/schedule/${n}`)).status===200?(y("Success","Successfully deleted interview schedule","success"),G(S)):y("Error","Failed to delete interview schedule","error")}catch(r){console.error(r),y("Error","Failed to delete interview schedule","error")}};return t.useEffect(()=>{const n=setTimeout(()=>{G(S)},1e3);return()=>clearTimeout(n)},[S]),t.useEffect(()=>{H&&k&&L(!1)},[$]),e.jsx(e.Fragment,{children:e.jsxs(xe,{className:"d-flex flex-column gap-3",children:[e.jsx(o,{children:e.jsxs(m,{children:[e.jsx("h2",{children:"Schedules"}),e.jsx("small",{children:"In this page, you can create and edit schedules for interviews, task, or any other events."})]})}),e.jsx(o,{children:e.jsx(xe,{children:e.jsx(ue,{children:e.jsxs(je,{children:[e.jsx("div",{children:J.map((n,r)=>e.jsx(Te,{color:n.color,className:"me-2",children:n.text},r))}),e.jsx("div",{children:e.jsx(ve,{onChange:K,selectRange:h,className:E?"calendar dark-mode":"calendar",tileClassName:({date:n,view:r})=>r==="month"&&B.find(A=>A.getDate()===n.getDate())?"not-available":O.find(A=>A.getDate()===n.getDate())?"has-events":"",defaultValue:h?[new Date(j[0]),new Date(j[1])]:new Date(S)})}),e.jsx("br",{}),e.jsx("div",{children:e.jsxs(v,{children:[e.jsx(p,{type:"text",placeholder:"start",value:R(S),readOnly:!0}),e.jsx(I,{content:"Create interview",placement:"top",children:e.jsx(f,{onClick:()=>L(!0),className:"btn btn-primary",children:e.jsx(u,{icon:Ce})})})]})})]})})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsx(ne,{children:e.jsxs(v,{children:[e.jsx(p,{type:"text",placeholder:"Search"}),e.jsx(f,{color:"primary",children:e.jsx(u,{icon:Oe})})]})})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsx(ue,{children:e.jsx(je,{children:e.jsxs(Ke,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[e.jsx(Qe,{children:e.jsxs(U,{children:[e.jsx(M,{className:"text-center",children:e.jsx(u,{icon:_e})}),e.jsx(M,{className:"text-center",children:"Date"}),e.jsx(M,{className:"text-center",children:"Time"}),e.jsx(M,{className:"text-center",children:"Location"}),e.jsx(M,{className:"text-center",children:"Capacity"}),e.jsx(M,{className:"text-center",children:"Action"})]})}),e.jsx(es,{children:z?e.jsx(U,{children:e.jsx(w,{colSpan:"6",className:"text-center",children:e.jsx(Me,{color:"primary",variant:"grow"})})}):g.length===0?e.jsx(U,{children:e.jsxs(w,{colSpan:"6",className:"text-center",children:["No data available for"," ",e.jsx("span",{className:"text-info",children:R(S,"MMM d, YYYY")})]})}):g.map((n,r)=>e.jsxs(U,{children:[e.jsx(w,{className:"text-center",children:n.title}),e.jsx(w,{className:"text-center",children:R(n.date)}),e.jsxs(w,{className:"text-center",children:[C(n.timeslot.start)," -"," ",C(n.timeslot.end)]}),e.jsx(w,{className:"text-center",children:n.location?he(n.location,20):"N/A"}),e.jsx(w,{className:"text-center",children:n.capacity?he(n.capacity,20):"N/A"}),e.jsx(w,{className:"text-center",children:e.jsxs(ss,{children:[e.jsxs(f,{onClick:()=>{console.log("Interview Data:",n),l(n),L(!0)},className:"btn btn-primary",children:[e.jsx(I,{content:"Edit",placement:"top",children:e.jsx(u,{icon:Ye})})," "]}),e.jsxs(f,{onClick:()=>Q(n._id),className:"btn btn-danger",children:[e.jsx(I,{content:"Delete",placement:"top",children:e.jsx(u,{icon:be})})," "]}),e.jsx(f,{className:"btn btn-warning",children:e.jsx(I,{content:"Cancel",placement:"top",children:e.jsx(u,{icon:Ge})})})]})})]},r))})]})})})})}),e.jsx(o,{children:e.jsx(m,{children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(Re,{currentPage:$,totalPages:oe,onPageChange:W})})})}),e.jsx(o,{children:e.jsx(Ee,{isVisible:H,onClose:()=>L(!1),isDarkMode:E,interviewData:k})})]})})};ts.propTypes={theme:T.string};export{ts as default};
