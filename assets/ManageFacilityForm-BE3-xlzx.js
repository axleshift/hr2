const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-lZ1Wbwqx.js","./Calendar-CVmgXurr.js","./index-C66lSxRl.js","./react-router-dom-BnDDw25P.js","./react-BF1r7_8g.js","./react-dom-DgB6LS8R.js","./index-BR_Z4VyY.css","./EventForm-DSuBaNdx.js","./zod-B0zZW6rS.js","./react-hook-form-DGCwHb0C.js","./@hookform/resolvers/zod-B5rlnuQ9.js","./index-BVfmz2P_.js","./CContainer-DnAwT2KJ.js","./CRow-BC2jnXSR.js","./CModalHeader-17a_J2dP.js","./DefaultLayout-BlBcqPq3.js","./index.esm-CoSUUeCw.js","./index.es-DzFLx6Av.js","./isRTL-D5ORmfro.js","./DefaultLayout-C111EtUu.css","./CModalTitle-UbKkKgfG.js","./CFormLabel-CnrvBD9C.js","./CFormInput-7yAhRXCl.js","./CFormTextarea-CUvmDkxd.js","./CCardBody-oEpd84ML.js","./CCardHeader-QL0CeDVz.js","./CTable-C_OnMufT.js"])))=>i.map(i=>d[i]);
import{m as e,j as t,a as s,l as a,k as r,g as i,w as n,i as d,v as o,y as l,p as c}from"./index-C66lSxRl.js";import{r as m,R as h}from"./react-router-dom-BnDDw25P.js";import{z as u}from"./zod-B0zZW6rS.js";import{u as p}from"./react-hook-form-DGCwHb0C.js";import{s as f}from"./@hookform/resolvers/zod-B5rlnuQ9.js";import{f as g,t as C}from"./index-BVfmz2P_.js";import"./index.es-DzFLx6Av.js";import{C as b}from"./CContainer-DnAwT2KJ.js";import{C as y,a as v}from"./CRow-BC2jnXSR.js";import{C as j,a as S,b as N}from"./CModalHeader-17a_J2dP.js";import{C as w}from"./CModalTitle-UbKkKgfG.js";import{C as x,a as T,b as _,c as D}from"./CTabList-B_ov72Hs.js";import{a as E}from"./DefaultLayout-BlBcqPq3.js";import{C as A}from"./CFormLabel-CnrvBD9C.js";import{C as k}from"./CFormInput-7yAhRXCl.js";import{C as z,a as I}from"./CCardBody-oEpd84ML.js";import{C as M}from"./CCardHeader-QL0CeDVz.js";import{C as R,a as $,b as F,c as L,d as H,e as K}from"./CTable-C_OnMufT.js";import{C as O}from"./CTooltip-C7pMgaBa.js";import{C as V}from"./CInputGroup-CRsaNImm.js";import"./react-dom-DgB6LS8R.js";import"./react-BF1r7_8g.js";import"./index.esm-CoSUUeCw.js";import"./isRTL-D5ORmfro.js";const P=h.lazy((()=>d((()=>import("./index-lZ1Wbwqx.js")),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url))),q=h.lazy((()=>d((()=>import("./EventForm-DSuBaNdx.js")),__vite__mapDeps([7,3,4,5,2,6,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url))),B=({isVisible:d,onClose:c,facility:h={}})=>{const{addToast:B}=m.useContext(e),[G,Z]=m.useState({}),[J,Q]=m.useState(!1),[U,W]=m.useState(!1),[X,Y]=m.useState(!1),[ee,te]=m.useState(new Date),[se,ae]=m.useState(!1),[re,ie]=m.useState([]),[ne,de]=m.useState([]),[oe,le]=m.useState(!1),[ce,me]=m.useState(!1),[he,ue]=m.useState(!1),[pe,fe]=m.useState({}),[ge,Ce]=m.useState([]),[be,ye]=m.useState(!1),[ve,je]=m.useState(!1),[Se,Ne]=m.useState(!1),[we,xe]=m.useState({}),[Te,_e]=m.useState(!1),[De,Ee]=m.useState(5e3),[Ae,ke]=m.useState(0),ze=(e,t="12h")=>{const[s,a]=e.split(":");return`${s%12||12}:${a} ${s<12?"AM":"PM"}`},Ie=()=>{if(G.timeslots){const e=G.timeslots.map((e=>new Date(e.date))).map((e=>new Date(e.getTime()-6e4*e.getTimezoneOffset())));ie(e)}},Me=async()=>{try{Q(!0);const e=await n(`/facilities/${G._id}`);200===e.status&&(Z(e.data.data),Ie(),Q(!1))}catch(e){B("Error","Failed to reload facility data","danger")}},Re=async()=>{try{le(!0);const e=await n(`/facilities/timeslot/${h._id}/${new Date(ee)}`);if(200===e.status)return le(!1),de(e.data.data)}catch(e){le(!1),B("error","An error occurred while fetching timeslots","danger")}},$e=u.object({start:u.string().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,"Invalid time format, must be HH:MM"),end:u.string().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,"Invalid time format, must be HH:MM")}).superRefine(((e,t)=>{e.start>=e.end&&t.addIssue({code:u.ZodIssueCode.custom,message:"Start time must be before end time",path:["start"]});ne.find((t=>e.start<t.end&&e.end>t.start))&&t.addIssue({code:u.ZodIssueCode.custom,message:"Timeslot overlaps with an existing one",path:["start"]})})),{register:Fe,handleSubmit:Le,reset:He,formState:{errors:Ke}}=p({resolver:f($e)});return m.useEffect((()=>{d&&(W(d),Ie(),Re())}),[ee,d]),m.useEffect((()=>{h&&h._id&&Z(h)}),[h]),t(b,{children:[s(y,{children:s(v,{children:t(j,{visible:U,onClose:()=>{W(!1),ie([]),c(),He()},size:"lg",backdrop:"static",children:[s(S,{children:t(w,{children:["Manage ",G.name||"Facility"]})}),s(N,{children:t(x,{activeItemKey:0,children:[t(T,{variant:"underline-border",children:[s(_,{itemKey:0,children:"Timeslots"}),s(_,{itemKey:1,children:"Events"})]}),t(E,{children:[s(D,{itemKey:0,children:t(b,{children:[s(y,{className:"mb-3",children:t(v,{children:["development"===a.env,J?s("div",{className:"d-flex justify-content-center",children:t("span",{children:[s(r,{size:"sm"})," Loading Calendar..."]})}):s(P,{onChange:e=>{const t=new Date(e.getTime()-6e4*e.getTimezoneOffset());te(t)},className:X?"calendar dark-mode":"calendar",defaultValue:ee,tileClassName:({date:e})=>{if(re.find((t=>t.toDateString()===e.toDateString())))return"has-timeslots"}})]})}),s(y,{className:"mb-3",children:t(v,{children:["Manage timeslots for"," ",s("span",{className:"text-info",children:g(ee)})]})}),s(y,{className:"mb-3",children:s(v,{children:s(A,{onSubmit:Le((async e=>{try{me(!0);const t=new FormData;t.append("date",new Date(ee)),t.append("start",e.start),t.append("end",e.end);const s=await o(`/facilities/timeslot/create/${G._id}`,t);return 404===s.status||400===s.status?(me(!1),Me(),B("error",JSON.stringify(s.message.message),"danger")):(Me(),Re(),me(!1),B("success","Timeslot added successfully","success"))}catch(t){me(!1),B("error","An error occurred while adding timeslot","danger")}})),children:t(y,{className:"d-flex gap-2",children:[t(v,{children:[s(k,{type:"time",...Fe("start"),placeholder:"Start time",invalid:!!Ke.start}),Ke.start&&s("div",{className:"invalid-feedback",children:Ke.start.message})]}),t(v,{children:[s(k,{type:"time",...Fe("end"),placeholder:"End time",invalid:!!Ke.end}),Ke.end&&s("div",{className:"invalid-feedback",children:Ke.end.message})]}),s(v,{children:t("div",{className:"d-flex justify-content-end gap-2",children:[ce?t(i,{color:"primary",disabled:!0,children:[s("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),"Â Adding..."]}):s(i,{color:"primary",type:"submit",children:"Add"}),s(i,{color:"primary",onClick:()=>Me(),children:"Refresh"})]})})]})})})}),s(y,{children:s(v,{children:t(z,{children:[s(M,{children:"Timeslots"}),s(I,{children:t(R,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[s($,{children:t(F,{children:[s(L,{children:"#"}),s(L,{children:"Date"}),s(L,{children:"Start"}),s(L,{children:"End"}),s(L,{children:"Availability"}),s(L,{children:"Action"})]})}),s(H,{children:0===ne.length?s(F,{children:t(K,{colSpan:"6",className:"text-center",children:["No timeslots found for ",g(ee)]})}):ne.map((e=>t(F,{children:[s(K,{children:s(O,{content:e._id,placement:"top",children:s("span",{className:"text-muted",children:C(e._id,10)})})}),s(K,{children:g(new Date(e.date))}),s(K,{children:ze(e.start,"12h")}),s(K,{children:ze(e.end,"12h")}),s(K,{children:e.isAvailable?s("span",{className:"text-success",children:"Available"}):s("span",{className:"text-danger",children:"Booked"})}),s(K,{children:t(V,{children:[s(i,{color:"danger",size:"sm",onClick:()=>(async e=>{try{return ue(!0),200===(await l(`/facilities/timeslot/delete/${e._id}`)).status?(ue(!1),Re(),B("success","Timeslot removed successfully","success")):(ue(!1),Re(),B("error","Failed to remove timeslot","danger"))}catch(t){B("error","An error occurred while removing timeslot","danger")}})(e),children:he?s(r,{size:"sm"}):"Delete"}),e.isAvailable?s(i,{color:"info",size:"sm",onClick:()=>{fe(e),je(!0),W(!1),Ne(!1)},children:"Set Event"}):s(i,{color:"info",size:"sm",onClick:()=>{fe(e),je(!0),W(!1),Ne(!0)},children:"Manage Event"})]})})]},e._id)))})]})})]})})})]})}),s(D,{itemKey:1,children:"events"})]})]})})]})})}),s(y,{children:s(v,{children:s(q,{isVisible:ve,onClose:()=>{je(!1),W(!0),Me(),Ne(!1)},isEdit:Se,slot:pe})})})]})};B.propTypes={isVisible:c.bool.isRequired,onClose:c.func.isRequired,facility:c.object};export{B as default};
