const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-Cd8wgqG1.js","./Calendar-n-lI7UgF.js","./index-CcMoZ86M.js","./react-router-dom-BnDDw25P.js","./react-BF1r7_8g.js","./react-dom-DgB6LS8R.js","./index-C7lYjtMO.css","./EventForm-Bm6iYZl0.js","./zod-B0zZW6rS.js","./react-hook-form-DB8hWBdy.js","./@hookform/resolvers/zod-1wp20Skh.js","./index-DCO1bnrX.js","./AppPagination-DKVbBTy2.js","./index.es-bvOFjCBQ.js","./CModalHeader-_Q4P1NwJ.js","./DefaultLayout-f6fgnM5a.js","./CContainer-CXw2kXtD.js","./index.esm-5D08hL8w.js","./isRTL-D5ORmfro.js","./DefaultLayout-C111EtUu.css","./CModalTitle-CUSi6tVS.js","./CTabList-Bk-_56XX.js","./getTransitionDurationFromElement-2nBpLMKS.js","./CFormLabel-Cn49qeSD.js","./CRow-Bcopbwr-.js","./CFormInput-DqSYQ0H6.js","./CFormSelect-BOTOLPH_.js","./CFormRange-BfkygGOt.js","./CFormTextarea-BayWnFVt.js","./CCardBody-NXgyA15G.js","./CTable-Cj8mkuZH.js","./ConfirmationDialog-K51Wozrj.js","./CCardHeader-C6GIS5ko.js"])))=>i.map(i=>d[i]);
import{m as e,j as t,a as s,l as a,k as r,g as i,w as n,i as d,v as o,y as l,p as c}from"./index-CcMoZ86M.js";import{r as m,R as h}from"./react-router-dom-BnDDw25P.js";import{z as u}from"./zod-B0zZW6rS.js";import{u as p}from"./react-hook-form-DB8hWBdy.js";import{s as f}from"./@hookform/resolvers/zod-1wp20Skh.js";import{f as g,t as C}from"./index-DCO1bnrX.js";import"./index.es-bvOFjCBQ.js";import"./ConfirmationDialog-K51Wozrj.js";import{C as y}from"./CContainer-CXw2kXtD.js";import{C as b,a as v}from"./CRow-Bcopbwr-.js";import{C as S,a as j,b as w}from"./CModalHeader-_Q4P1NwJ.js";import{C as x}from"./CModalTitle-CUSi6tVS.js";import{C as N,a as T,b as _,c as D}from"./CTabList-Bk-_56XX.js";import{a as E}from"./DefaultLayout-f6fgnM5a.js";import{C as A}from"./CFormLabel-Cn49qeSD.js";import{C as k}from"./CFormInput-DqSYQ0H6.js";import{C as z,a as I}from"./CCardBody-NXgyA15G.js";import{C as M}from"./CCardHeader-C6GIS5ko.js";import{C as R,a as $,b as L,c as F,d as H,e as V}from"./CTable-Cj8mkuZH.js";import{C as K}from"./CTooltip-DPwsLnsN.js";import"./react-dom-DgB6LS8R.js";import"./react-BF1r7_8g.js";import"./getTransitionDurationFromElement-2nBpLMKS.js";import"./index.esm-5D08hL8w.js";import"./isRTL-D5ORmfro.js";const O=h.lazy((()=>d((()=>import("./index-Cd8wgqG1.js")),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url))),P=h.lazy((()=>d((()=>import("./EventForm-Bm6iYZl0.js")),__vite__mapDeps([7,3,4,5,2,6,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]),import.meta.url))),Z=({isVisible:d,onClose:c,facility:h={}})=>{const{addToast:Z}=m.useContext(e),[q,B]=m.useState({}),[J,G]=m.useState(!1),[Q,X]=m.useState(!1),[Y,U]=m.useState(!1),[W,ee]=m.useState(new Date),[te,se]=m.useState(!1),[ae,re]=m.useState([]),[ie,ne]=m.useState([]),[de,oe]=m.useState(!1),[le,ce]=m.useState(!1),[me,he]=m.useState(!1),[ue,pe]=m.useState({}),[fe,ge]=m.useState([]),[Ce,ye]=m.useState(!1),[be,ve]=m.useState(!1),[Se,je]=m.useState(!1),[we,xe]=m.useState({}),[Ne,Te]=m.useState(!1),[_e,De]=m.useState("edit"),[Ee,Ae]=m.useState(!1),[ke,ze]=m.useState(5e3),[Ie,Me]=m.useState(0),Re=(e,t="12h")=>{const[s,a]=e.split(":");return`${s%12||12}:${a} ${s<12?"AM":"PM"}`},$e=()=>{if(q.timeslots){const e=q.timeslots.map((e=>new Date(e.date))).map((e=>new Date(e.getTime()-6e4*e.getTimezoneOffset())));re(e)}},Le=async()=>{try{G(!0);const e=await n(`/facilities/${q._id}`);200===e.status&&(B(e.data.data),$e(),G(!1))}catch(e){Z("Error","Failed to reload facility data","danger")}},Fe=async()=>{try{oe(!0);const e=await n(`/facilities/timeslot/${q._id}/${new Date(W)}`);if(200===e.status)return oe(!1),ne(e.data.data);if(404===e.status)return oe(!1),ne([])}catch(e){oe(!1),Z("error","An error occurred while fetching timeslots","danger")}},He=u.object({start:u.string().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,"Invalid time format, must be HH:MM"),end:u.string().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,"Invalid time format, must be HH:MM")}).superRefine(((e,t)=>{e.start>=e.end&&t.addIssue({code:u.ZodIssueCode.custom,message:"Start time must be before end time",path:["start"]});ie.find((t=>e.start<t.end&&e.end>t.start))&&t.addIssue({code:u.ZodIssueCode.custom,message:"Timeslot overlaps with an existing one",path:["start"]})})),{register:Ve,handleSubmit:Ke,reset:Oe,formState:{errors:Pe}}=p({resolver:f(He)});return m.useEffect((()=>{Q&&($e(),Fe())}),[W,Q]),m.useEffect((()=>{h&&h._id&&(B(h),Le())}),[h]),m.useEffect((()=>{d&&X(d)}),[d]),t(y,{children:[s(b,{children:s(v,{children:t(S,{visible:Q,onClose:()=>{X(!1),re([]),c(),Oe()},size:"lg",backdrop:"static",children:[s(j,{children:t(x,{children:["Manage ",q.name||"Facility"]})}),s(w,{children:t(N,{activeItemKey:0,children:[t(T,{variant:"underline-border",children:[s(_,{itemKey:0,children:"Timeslots"}),s(_,{itemKey:1,children:"Events"})]}),t(E,{children:[s(D,{itemKey:0,children:t(y,{children:[s(b,{className:"mb-3",children:t(v,{children:["development"===a.env,J?s("div",{className:"d-flex justify-content-center",children:t("span",{children:[s(r,{size:"sm"})," Loading Calendar..."]})}):s(O,{onChange:e=>{const t=new Date(e.getTime()-6e4*e.getTimezoneOffset());ee(t)},className:Y?"calendar dark-mode":"calendar",defaultValue:W,tileClassName:({date:e})=>{if(ae.find((t=>t.toDateString()===e.toDateString())))return"has-timeslots"}})]})}),s(b,{className:"mb-3",children:t(v,{children:["Manage timeslots for"," ",s("span",{className:"text-info",children:g(W)})]})}),s(b,{className:"mb-3",children:s(v,{children:s(A,{onSubmit:Ke((async e=>{try{ce(!0);const t=new FormData;t.append("date",new Date(W)),t.append("start",e.start),t.append("end",e.end);const s=await o(`/facilities/timeslot/create/${q._id}`,t);return 404===s.status||400===s.status?(ce(!1),Le(),Z("error",JSON.stringify(s.message.message),"danger")):(Le(),Fe(),ce(!1),Z("success","Timeslot added successfully","success"))}catch(t){ce(!1),Z("error","An error occurred while adding timeslot","danger")}})),children:t(b,{className:"d-flex gap-2",children:[t(v,{children:[s(k,{type:"time",...Ve("start"),placeholder:"Start time",invalid:!!Pe.start}),Pe.start&&s("div",{className:"invalid-feedback",children:Pe.start.message})]}),t(v,{children:[s(k,{type:"time",...Ve("end"),placeholder:"End time",invalid:!!Pe.end}),Pe.end&&s("div",{className:"invalid-feedback",children:Pe.end.message})]}),s(v,{children:t("div",{className:"d-flex justify-content-end gap-2",children:[le?t(i,{color:"primary",disabled:!0,children:[s("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),"Â Adding..."]}):s(i,{color:"primary",type:"submit",children:"Add"}),s(i,{color:"primary",onClick:()=>Le(),children:"Refresh"})]})})]})})})}),s(b,{children:s(v,{children:t(z,{children:[s(M,{children:"Timeslots"}),s(I,{children:t(R,{align:"middle",hover:!0,responsive:!0,striped:!0,children:[s($,{children:t(L,{children:[s(F,{children:"#"}),s(F,{children:"Date"}),s(F,{children:"Start"}),s(F,{children:"End"}),s(F,{children:"Availability"}),s(F,{children:"Action"})]})}),s(H,{children:0===ie.length?s(L,{children:t(V,{colSpan:"6",className:"text-center",children:["No timeslots found for ",g(W)]})}):ie.map((e=>t(L,{children:[s(V,{children:s(K,{content:e._id,placement:"top",children:s("span",{className:"text-muted",children:C(e._id,10)})})}),s(V,{children:g(new Date(e.date))}),s(V,{children:Re(e.start,"12h")}),s(V,{children:Re(e.end,"12h")}),s(V,{children:e.isAvailable?s("span",{className:"text-success",children:"Available"}):s("span",{className:"text-danger",children:"Booked"})}),s(V,{children:t("div",{className:"d-flex flex-wrap gap-2",children:[s(i,{color:"danger",size:"sm",onClick:()=>(async e=>{try{if(!confirm("Are you sure you want to delete this timeslot?"))return;he(!0);const t=await l(`/facilities/timeslot/delete/${e._id}`);return 200===t.status?(he(!1),Fe(),Z("success","Timeslot removed successfully","success")):(he(!1),Fe(),Z("error",t.data.message,"danger"))}catch(t){Z("error","An error occurred while removing timeslot","danger")}})(e),children:me?s(r,{size:"sm"}):"Delete"}),e.isAvailable?s(i,{color:"info",size:"sm",onClick:()=>{pe(e),ve(!0),X(!1),De("create")},children:"Set Event"}):s(i,{color:"info",size:"sm",onClick:()=>{pe(e),ve(!0),X(!1),De("edit")},children:"Manage Event"})]})})]},e._id)))})]})})]})})})]})}),s(D,{itemKey:1,children:"events"})]})]})})]})})}),s(b,{children:s(v,{children:s(P,{isVisible:be,onClose:()=>{ve(!1),X(!0),Le(),$e()},state:_e,slot:ue})})})]})};Z.propTypes={isVisible:c.bool.isRequired,onClose:c.func.isRequired,facility:c.object};export{Z as default};
